 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>decide</title>
    <meta name="description" content="Decision infrastructure for humans and agents. Get instant yes/no calls, run deterministic MCP notaries, and validate outputs in a live demo with audit trail.">
    <meta property="og:title" content="decide.fyi — Decision infrastructure for humans and agents">
    <meta property="og:description" content="Instant human decisions + deterministic MCP notaries for AI agents, with a live demo and audit trail.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://decide.fyi">
    <meta property="og:image" content="https://i.imgur.com/QwWDN7n.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="decide.fyi — Decision infrastructure for humans and agents">
    <meta name="twitter:description" content="Instant human decisions + deterministic MCP notaries for AI agents, with a live demo and audit trail.">
    <meta name="twitter:image" content="https://i.imgur.com/QwWDN7n.png">
    <meta name="theme-color" content="#f5f5f5">
    <link rel="icon" type="image/png" href="https://i.imgur.com/QwWDN7n.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet">
    <!-- Clerk Authentication -->
    <script 
        async 
        crossorigin="anonymous" 
        data-clerk-publishable-key="pk_live_Y2xlcmsuZGVjaWRlLmZ5aSQ" 
        src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js"
        type="text/javascript"
    ></script>
    <style>
        :root{--bg:#f5f5f5;--bg-dark:#111111;--fg:#111111;--fg-light:#f5f5f5;--gray:#666666;--gray-light:#999999;--g:#16a34a;--r:#dc2626;--select-chevron:#4b5563;--ease:cubic-bezier(0.16,1,0.3,1);--ease-out:cubic-bezier(0.34,1.56,0.64,1)}
        *{margin:0;padding:0;box-sizing:border-box}
        html{scroll-behavior:smooth}
        body{font-family:'Inter',-apple-system,sans-serif;background:var(--bg);color:var(--fg);overflow-x:hidden;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
        ::selection{background:rgba(17,17,17,0.15)}

        /* CANVAS BG */
        #canvas{display:none}

        /* GRAIN */
        .grain{display:none}

        /* GLOW CURSOR */
        .glow{display:none}

        /* NAV */
        nav{position:fixed;top:0;left:0;right:0;z-index:1000;padding:1rem}
        .nav-wrap{max-width:1100px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;padding:0.6rem 0.6rem 0.6rem 1.25rem;border-radius:100px;border:1px solid transparent;transition:all 0.5s var(--ease);position:relative}
        nav.scrolled .nav-wrap{background:rgba(245,245,245,0.92);border-color:rgba(17,17,17,0.06);backdrop-filter:none;-webkit-backdrop-filter:none;box-shadow:0 4px 30px rgba(0,0,0,0.05)}
        .logo{display:flex;align-items:center;gap:0.6rem;text-decoration:none;color:var(--fg)}
        .logo-mark{width:28px;height:28px;display:flex;align-items:center;justify-content:center;transition:all 0.4s var(--ease-out)}
        .logo-mark img{width:28px;height:28px;object-fit:contain}
        .logo:hover .logo-mark{transform:translateX(3px)}
        .logo span{font-weight:700;font-size:1rem;letter-spacing:-0.02em}
        .nav-links{display:flex;gap:0.25rem;align-items:center}
        .nav-links a{text-decoration:none;color:var(--gray);font-size:0.8rem;font-weight:500;padding:0.5rem 1rem;border-radius:100px;transition:all 0.3s}
        .nav-links a:hover{color:var(--fg);background:rgba(17,17,17,0.04)}
        .nav-links a.signed-in{display:flex;align-items:center;gap:0.5rem}
        .nav-links a.signed-in:hover{background:rgba(17,17,17,0.06)}
        .nav-links .sign-out-btn{color:var(--r);font-weight:500}
        .nav-links .sign-out-btn:hover{background:rgba(220,38,38,0.08);color:var(--r)}
        .nav-cta{background:var(--fg)!important;color:var(--bg)!important;font-weight:600!important}
        .nav-cta:hover{transform:scale(1.05);box-shadow:0 10px 40px rgba(17,17,17,0.2)}

        /* HERO */
        .hero{min-height:100vh;display:flex;flex-direction:column;justify-content:flex-start;align-items:center;padding:9.4rem 1.5rem 2rem;text-align:center;position:relative;z-index:2;background:var(--bg)}
        .hero-inner{max-width:900px}

        .badge{display:inline-flex;align-items:center;gap:0.6rem;background:rgba(17,17,17,0.03);border:1px solid rgba(17,17,17,0.08);padding:0.4rem 0.9rem 0.4rem 0.5rem;border-radius:100px;font-size:0.7rem;font-weight:600;color:var(--gray);margin-bottom:2.5rem;opacity:0;animation:fadeUp 1s var(--ease) 0.2s forwards}
        .badge-dot{width:8px;height:8px;background:var(--g);border-radius:50%;animation:pulse 2s ease-in-out infinite;box-shadow:0 0 12px rgba(22,163,74,0.4)}
        @keyframes pulse{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.4);opacity:0.6}}
        @keyframes fadeUp{to{opacity:1;transform:translateY(0)}}

        .hero h1{font-size:clamp(3rem,15vw,9rem);font-weight:800;letter-spacing:-0.06em;line-height:0.85;margin-bottom:1.5rem;color:var(--fg)}
        .hero h1 .word{display:inline-block;overflow:hidden;vertical-align:top}
        .hero h1 .word span{display:inline-block;transform:translateY(110%);animation:wordUp 1.2s var(--ease) forwards}
        .hero h1 .word:nth-child(1) span{animation-delay:0.3s}
        .hero h1 .word:nth-child(2) span{animation-delay:0.5s}
        @keyframes wordUp{to{transform:translateY(0)}}
        .hero h1 .serif{font-family:'DM Serif Display',serif;font-weight:700;font-style:italic}

        .sub{font-size:clamp(1rem,2.5vw,1.25rem);color:var(--gray);margin-bottom:2.5rem;opacity:0;transform:translateY(20px);animation:fadeUp 1s var(--ease) 0.7s forwards}

        /* INPUT */
        .input-wrap{width:100%;max-width:580px;margin:0 auto;opacity:0;transform:translateY(20px);animation:fadeUp 1s var(--ease) 0.85s forwards;position:relative;z-index:3}
        .input-row{display:flex;align-items:center;justify-content:center;height:64px;position:relative}
        .input-box{flex:1;position:relative;border-radius:22px;padding:2px;background:var(--fg);transition:all 0.4s}
        .input-box:focus-within{box-shadow:0 20px 60px rgba(17,17,17,0.15)}
        .input-inner{background:var(--bg);border-radius:20px;display:flex;align-items:center;padding:0.4rem}
        .input-field{flex:1;padding:1rem 1.25rem;font-size:1rem;font-family:inherit;border:none;outline:none;background:transparent;color:var(--fg)}
        .input-field::placeholder{color:#999}
        .input-field.retry-placeholder::placeholder{color:#bbb}
        .input-btn{background:var(--fg);color:var(--bg);border:none;padding:0.85rem 1.4rem;border-radius:16px;font-family:inherit;font-size:0.9rem;font-weight:600;cursor:pointer;transition:all 0.3s var(--ease-out);display:flex;align-items:center;gap:0.4rem}
        .input-btn svg{width:16px;height:16px;stroke:currentColor;stroke-width:2.5;transition:transform 0.3s}
        .input-btn:hover{transform:scale(1.05);box-shadow:0 10px 40px rgba(17,17,17,0.25)}
        .input-btn:hover svg{transform:translateX(3px)}
        .input-btn:active{transform:scale(0.97)}
        .input-btn:disabled{opacity:0.6;cursor:not-allowed;transform:none}
        .input-wrap,.input-row,.input-box,.input-inner,.input-field,.input-btn,.refresh-btn,.chips,.chip{pointer-events:auto}
        
        /* Refresh button - outside on the right */
        .refresh-btn{
            position:absolute;
            right:-75px;
            top:50%;
            transform:translateY(-50%);
            display:flex;
            align-items:center;
            justify-content:center;
            width:60px;
            height:60px;
            background:var(--bg);
            border:2px solid rgba(17,17,17,0.15);
            border-radius:16px;
            font-size:1.3rem;
            color:var(--gray);
            cursor:pointer;
            transition:all 0.3s var(--ease-out);
            flex-shrink:0;
            visibility:hidden;
            opacity:0;
        }
        .refresh-btn:hover{border-color:var(--fg);color:var(--fg);transform:translateY(-50%) scale(1.05)}
        .refresh-btn:active{transform:translateY(-50%) scale(0.95)}
        
        .input-box + .refresh-btn{visibility:visible;opacity:1}

        .char-count{font-size:0.7rem;color:var(--r);text-align:right;margin-top:0.5rem;opacity:0;transition:opacity 0.3s;font-weight:600}
        .char-count.show{opacity:1}
        .decision-status{min-height:1.1rem;margin-top:0.45rem;font-size:0.74rem;font-weight:600;letter-spacing:0.01em;opacity:0;transform:translateY(-2px);transition:opacity 0.2s var(--ease),transform 0.2s var(--ease)}
        .decision-status.show{opacity:1;transform:translateY(0)}
        .decision-status.warn{color:#b45309}
        .decision-status.error{color:#b91c1c}

        .chips{display:flex;justify-content:center;gap:0.5rem;margin-top:1.25rem;flex-wrap:wrap;opacity:0;animation:fadeUp 1s var(--ease) 1s forwards}
        .chip{background:transparent;border:1px solid rgba(17,17,17,0.1);padding:0.4rem 0.85rem;border-radius:100px;font-size:0.7rem;color:var(--gray);cursor:pointer;transition:all 0.3s}
        .chip:hover{border-color:var(--fg);color:var(--fg);background:rgba(17,17,17,0.03);transform:translateY(-2px)}

        .result{width:100%;display:flex;justify-content:center;margin-top:0.95rem}
        .ans{width:100%;max-width:1120px;min-height:186px;background:#f2f3f6;border:1px solid rgba(17,17,17,0.18);border-radius:16px;overflow:hidden;box-shadow:0 18px 44px rgba(0,0,0,0.15)}
        .decision-table-top{display:flex;align-items:center;justify-content:space-between;gap:0.8rem;padding:0.72rem 0.92rem;border-bottom:1px solid rgba(17,17,17,0.12);background:#eceff3}
        .decision-table-title{font-size:0.76rem;font-weight:700;letter-spacing:0.05em;text-transform:uppercase;color:var(--fg)}
        .decision-table-count{font-size:0.72rem;font-weight:600;color:var(--gray)}
        .decision-table-wrap{max-height:290px;overflow:auto}
        .decision-table{width:100%;min-width:0;border-collapse:collapse;table-layout:fixed}
        .decision-table .dt-col-time{width:162px}
        .decision-table .dt-col-set{width:74px}
        .decision-table .dt-col-option{width:74px}
        .decision-table .dt-col-mode{width:84px}
        .decision-table .dt-col-question{width:auto}
        .decision-table .dt-col-verdict{width:96px}
        .decision-table th{font-size:0.68rem;font-weight:700;text-transform:uppercase;letter-spacing:0.06em;color:var(--gray);text-align:left;padding:0.6rem 0.72rem;border-bottom:1px solid rgba(17,17,17,0.1);background:#e8ebef;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .decision-table td{font-size:0.76rem;line-height:1.45;color:var(--fg);text-align:left;padding:0.62rem 0.72rem;border-bottom:1px solid rgba(17,17,17,0.08);vertical-align:middle;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .decision-table td.col-mode{padding-left:0.45rem;padding-right:0.45rem;overflow:visible;text-overflow:clip}
        .decision-table tbody tr:last-child td{border-bottom:none}
        .decision-table tbody tr:nth-child(odd){background:rgba(17,17,17,0.015)}
        .decision-table tbody tr:hover{background:rgba(17,17,17,0.04)}
        .decision-table .col-question{text-align:left;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .decision-table .col-time{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-family:'SF Mono',Monaco,Consolas,monospace;font-size:0.72rem}
        .decision-table .col-mode{width:84px}
        .decision-table .col-set,.decision-table .col-option{text-align:center}
        .meta-pill{display:inline-flex;align-items:center;justify-content:center;min-width:42px;padding:0.18rem 0.45rem;border-radius:999px;border:1px solid rgba(17,17,17,0.18);font-size:0.64rem;font-weight:700;letter-spacing:0.03em;text-transform:uppercase;color:var(--gray)}
        .mode-pill{display:inline-flex;align-items:center;justify-content:center;padding:0.22rem 0.5rem;border-radius:999px;border:1px solid rgba(17,17,17,0.2);font-size:0.66rem;font-weight:700;letter-spacing:0.03em;text-transform:uppercase;color:var(--gray)}
        .pill{display:inline-flex;align-items:center;justify-content:center;padding:0.2rem 0.52rem;border-radius:999px;font-size:0.68rem;font-weight:700;letter-spacing:0.02em;text-transform:uppercase;border:1px solid transparent;white-space:nowrap}
        .pill.verdict-yes{background:rgba(22,163,74,0.16);border-color:rgba(22,163,74,0.36);color:#166534}
        .pill.verdict-no{background:rgba(220,38,38,0.14);border-color:rgba(220,38,38,0.34);color:#991b1b}
        .pill.verdict-tie{background:rgba(217,119,6,0.15);border-color:rgba(217,119,6,0.34);color:#92400e}
        .pill.verdict-pending,.pill.verdict-unknown{background:rgba(17,17,17,0.08);border-color:rgba(17,17,17,0.2);color:var(--gray)}
        .decision-empty{padding:1.35rem 1rem;color:var(--gray);font-size:0.82rem;text-align:center}

        /* LOGOS / MARQUEE */
        .bullet-strip{display:flex;gap:0.6rem;flex-wrap:wrap;justify-content:center;margin:1.25rem auto 0;max-width:900px}
        .bullet-pill{background:rgba(17,17,17,0.05);border:1px solid rgba(17,17,17,0.12);color:var(--fg);padding:0.55rem 0.85rem;border-radius:999px;font-size:0.85rem;font-weight:600}
        .code-slab{background:#0f0f0f;border:1px solid rgba(255,255,255,0.08);border-radius:14px;padding:1rem;margin:1.5rem auto 0;max-width:960px;box-shadow:0 10px 40px rgba(0,0,0,0.18)}
        .code-slab pre{margin:0;font-family:'SFMono-Regular',Consolas,Menlo,monospace;font-size:0.85rem;line-height:1.5;color:#e5e7eb;white-space:pre-wrap;word-break:break-word}
        .trust-note{margin-top:0.65rem;font-size:0.82rem;color:var(--gray);text-align:center}
        .decision-mode-switch{display:inline-flex;align-items:center;justify-content:center;gap:0.35rem;margin-top:0.78rem;padding:0.3rem;border:1px solid rgba(17,17,17,0.12);border-radius:999px;background:rgba(17,17,17,0.03)}
        .decision-mode-btn{border:none;background:transparent;color:var(--gray);border-radius:999px;padding:0.38rem 0.7rem;font-family:inherit;font-size:0.74rem;font-weight:600;cursor:pointer;transition:all 0.25s var(--ease)}
        .decision-mode-btn.active{background:var(--fg);color:var(--bg)}
        .decision-mode-btn:hover:not(.active){color:var(--fg);background:rgba(17,17,17,0.05)}
        .decision-mode-copy{margin-top:0.55rem;font-size:0.78rem;color:var(--gray);text-align:center}
        .logos{padding:2.5rem 1.5rem;border-top:1px solid rgba(17,17,17,0.06);position:relative;z-index:2;overflow:hidden;background:var(--bg)}
        .logos-track{display:flex;animation:scroll 25s linear infinite}
        .logos-track span{flex-shrink:0;padding:0 2.5rem;font-size:0.75rem;font-weight:600;color:rgba(17,17,17,0.5);text-transform:uppercase;letter-spacing:0.15em;display:flex;align-items:center;gap:2.5rem}
        .logos-track span::after{content:'◆';font-size:0.4rem;opacity:0.6}
        @keyframes scroll{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}

        /* SECTIONS */
        section{position:relative;z-index:2;background:var(--bg)}
        .sec-light{background:var(--bg)}
        .sec-dark{background:var(--bg-dark);color:var(--fg-light)}
        .sec-dark .sec-head h2{color:var(--fg-light)}
        .sec-dark .sec-head p{color:var(--gray-light)}
        .sec-dark .sec-tag{color:var(--fg-light)}
        .sec-dark .sec-tag::before,.sec-dark .sec-tag::after{border-color:var(--fg-light)}

        .sec-tag{display:inline-flex;align-items:center;gap:0.5rem;font-size:0.6rem;font-weight:700;color:var(--fg);text-transform:uppercase;letter-spacing:0.2em;margin-bottom:1.25rem}
        .sec-tag::before,.sec-tag::after{content:'';width:8px;height:8px;border:1.5px solid var(--fg);border-radius:50%}
        .sec-head{text-align:center;max-width:550px;margin:0 auto 5rem}
        .sec-head h2{font-size:clamp(2rem,5vw,3rem);font-weight:700;letter-spacing:-0.04em;margin-bottom:0.6rem;color:var(--fg)}
        .sec-head h2 .serif{font-family:'DM Serif Display',serif;font-style:italic}
        .sec-head p{color:var(--gray);font-size:0.95rem}

        /* FEATURES */
        .features{padding:8rem 1.5rem}
        .feat-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:1rem;max-width:1000px;margin:0 auto}
        .feat{background:rgba(17,17,17,0.03);border:1px solid rgba(17,17,17,0.08);border-radius:28px;padding:2rem;transition:all 0.5s var(--ease);position:relative;overflow:hidden}
        .feat::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:conic-gradient(from 0deg,transparent,rgba(17,17,17,0.03),transparent 30%);opacity:0;transition:opacity 0.5s;animation:rotate 6s linear infinite paused}
        @keyframes rotate{to{transform:rotate(360deg)}}
        .feat:hover::before{opacity:1;animation-play-state:running}
        .feat:hover{border-color:rgba(17,17,17,0.15);transform:translateY(-8px) scale(1.02);box-shadow:0 40px 80px rgba(0,0,0,0.08)}
        .feat.c4{grid-column:span 4}
        .feat.c3{grid-column:span 3}
        .feat.c2{grid-column:span 2}
        .feat-icon{width:52px;height:52px;background:var(--fg);border-radius:16px;display:flex;align-items:center;justify-content:center;margin-bottom:1.5rem;position:relative;z-index:1}
        .feat-icon svg{width:24px;height:24px;stroke:var(--bg)}
        .feat h3{font-size:1.1rem;font-weight:600;margin-bottom:0.4rem;position:relative;z-index:1;color:var(--fg)}
        .feat p{color:var(--gray);font-size:0.85rem;line-height:1.6;position:relative;z-index:1}

        /* HOW - LIGHT */
        .how{padding:8rem 1.5rem}
        .how-grid{display:flex;justify-content:center;gap:1.5rem;max-width:850px;margin:0 auto}
        .how-card{flex:1;background:var(--bg);border:1px solid rgba(17,17,17,0.08);border-radius:32px;padding:2.5rem 2rem;text-align:center;transition:all 0.4s var(--ease);position:relative}
        .how-card:hover{border-color:rgba(17,17,17,0.15);transform:translateY(-4px);box-shadow:0 20px 60px rgba(0,0,0,0.06)}
        .how-card::after{content:'→';position:absolute;right:-1.25rem;top:50%;transform:translateY(-50%);color:rgba(17,17,17,0.25);font-size:1.25rem}
        .how-card:last-child::after{display:none}
        .how-num{font-size:5rem;font-weight:900;line-height:1;color:rgba(17,17,17,0.15);margin-bottom:1rem}
        .how-card h3{font-size:1.1rem;font-weight:600;margin-bottom:0.3rem;color:var(--fg)}
        .how-card p{color:var(--gray);font-size:0.85rem}

        /* CTA - LIGHT */
        .cta{padding:14rem 1.5rem;text-align:center;position:relative;overflow:hidden}
        .cta::before{content:'';position:absolute;top:50%;left:50%;width:1000px;height:1000px;background:radial-gradient(circle,rgba(17,17,17,0.03) 0%,transparent 50%);transform:translate(-50%,-50%);animation:ctaGlow 5s ease-in-out infinite}
        @keyframes ctaGlow{0%,100%{transform:translate(-50%,-50%) scale(1);opacity:0.5}50%{transform:translate(-50%,-50%) scale(1.15);opacity:1}}
        .cta-inner{max-width:650px;margin:0 auto;position:relative;z-index:1}
        .cta h2{font-size:clamp(3rem,12vw,7rem);font-weight:900;letter-spacing:-0.05em;line-height:0.9;margin-bottom:1.25rem;color:var(--fg)}
        .cta h2 .serif{font-family:'DM Serif Display',serif;font-style:italic}
        .cta p{color:var(--gray);font-size:1.1rem;margin-bottom:2.5rem}
        .cta-btn{display:inline-flex;align-items:center;gap:0.6rem;background:var(--fg);color:var(--bg);padding:1.1rem 2.5rem;border-radius:100px;font-size:1rem;font-weight:600;text-decoration:none;transition:all 0.4s var(--ease-out)}
        .cta-btn:hover{transform:scale(1.08);box-shadow:0 20px 60px rgba(17,17,17,0.25)}
        .cta-btn svg{width:18px;height:18px;transition:transform 0.3s}
        .cta-btn:hover svg{transform:translateX(5px)}

        /* MODE TOGGLE */
        .mode-toggle{display:flex;background:rgba(17,17,17,0.06);border-radius:100px;padding:3px;gap:2px;position:absolute;left:50%;transform:translateX(-50%)}
        .mode-toggle button{background:none;border:none;padding:0.4rem 0.9rem;border-radius:100px;font-family:inherit;font-size:0.7rem;font-weight:600;color:var(--gray);cursor:pointer;transition:all 0.3s var(--ease);white-space:nowrap}
        .mode-toggle button.active{background:var(--fg);color:var(--bg);box-shadow:0 2px 8px rgba(0,0,0,0.15)}
        .mode-toggle button:not(.active):hover{color:var(--fg)}

        /* THEME TOGGLE - floating side button */
        .theme-toggle{position:fixed;right:1.25rem;bottom:1.25rem;z-index:999;width:42px;height:42px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s var(--ease);color:var(--gray);background:var(--bg);border:1px solid rgba(17,17,17,0.12);box-shadow:0 4px 20px rgba(0,0,0,0.08)}
        .theme-toggle:hover{border-color:var(--fg);color:var(--fg);transform:scale(1.1);box-shadow:0 6px 25px rgba(0,0,0,0.12)}
        .theme-toggle svg{width:16px;height:16px}
        .theme-toggle .icon-moon{display:none}
        body.dark .theme-toggle .icon-sun{display:none}
        body.dark .theme-toggle .icon-moon{display:block}
        body.dark .theme-toggle{border-color:rgba(245,245,245,0.12);box-shadow:0 4px 20px rgba(0,0,0,0.3)}
        body.dark .theme-toggle:hover{border-color:var(--fg);box-shadow:0 6px 25px rgba(0,0,0,0.4)}

        /* DARK MODE — single uniform shade */
        body.dark{--bg:#111111;--bg-dark:#111111;--fg:#e8e8e8;--fg-light:#e8e8e8;--gray:#888;--gray-light:#555;--select-chevron:#f5f5f5}
        body.dark{background:#111111;color:var(--fg)}
        body.dark::before{content:'';position:fixed;inset:0;background:var(--bg);z-index:0;pointer-events:none}
        /* Keep dark mode visually uniform and avoid GPU/compositing banding artifacts. */
        body.dark #canvas{display:none}
        body.dark .grain{display:none}
        body.dark .glow{display:none}
        body.dark .hero,
        body.dark .logos,
        body.dark section,
        body.dark footer{background:var(--bg)!important}
        body.dark .hero,
        body.dark .logos,
        body.dark .features,
        body.dark .how,
        body.dark .cta,
        body.dark .agent-hero,
        body.dark .agent-features,
        body.dark .connect{background:#111111!important}
        body.dark #human-mode,
        body.dark #agent-mode{transition:none}
        body.dark *{backdrop-filter:none!important;-webkit-backdrop-filter:none!important}
        /* Dark navbar in dark mode. */
        body.dark nav .nav-wrap{background:rgba(17,17,17,0.96);border-color:rgba(245,245,245,0.14);box-shadow:0 4px 30px rgba(0,0,0,0.35)}
        body.dark nav .logo,
        body.dark nav .logo span,
        body.dark nav .nav-links a{color:#f5f5f5}
        body.dark nav .logo-mark img{filter:brightness(0) invert(1)}
        body.dark nav .nav-links a:hover{background:rgba(245,245,245,0.1);color:#f5f5f5}
        body.dark nav .mode-toggle{background:rgba(245,245,245,0.1)}
        body.dark nav .mode-toggle button{color:#c7c7c7}
        body.dark nav .mode-toggle button.active{background:#f5f5f5;color:#111111}
        body.dark nav .nav-cta{background:#f5f5f5!important;color:#111111!important}
        body.dark nav .mob span{background:#f5f5f5}
        body.dark .decision-status.warn{color:#fbbf24}
        body.dark .decision-status.error{color:#fca5a5}
        body.dark ::selection{background:rgba(245,245,245,0.15)}
        body.dark .glow{background:radial-gradient(circle,rgba(245,245,245,0.03) 0%,transparent 60%)}
        body.dark nav.scrolled .nav-wrap{background:rgba(17,17,17,0.96);border-color:rgba(245,245,245,0.14);backdrop-filter:none;-webkit-backdrop-filter:none;box-shadow:0 4px 30px rgba(0,0,0,0.35)}
        body.dark .badge{background:rgba(245,245,245,0.05);border-color:rgba(245,245,245,0.1)}
        body.dark .mode-toggle{background:rgba(245,245,245,0.08)}
        body.dark .nav-links a:hover{background:rgba(245,245,245,0.06)}
        body.dark .nav-links a.signed-in:hover{background:rgba(245,245,245,0.08)}
        body.dark .nav-cta{background:var(--fg)!important;color:var(--bg)!important}
        body.dark .input-field::placeholder{color:#666}
        body.dark .chip{border-color:rgba(245,245,245,0.1)}
        body.dark .chip:hover{border-color:var(--fg);background:rgba(245,245,245,0.05)}
        body.dark .decision-mode-switch{border-color:rgba(245,245,245,0.2);background:rgba(245,245,245,0.08)}
        body.dark .decision-mode-btn{color:#c7c7c7}
        body.dark .decision-mode-btn.active{background:#f5f5f5;color:#111111}
        body.dark .decision-mode-btn:hover:not(.active){background:rgba(245,245,245,0.16);color:var(--fg)}
        body.dark .decision-mode-copy{color:var(--gray-light)}
        body.dark .ans{background:#15171b;border-color:rgba(245,245,245,0.16)}
        body.dark .decision-table-top{border-color:rgba(245,245,245,0.12);background:#1d2128}
        body.dark .decision-table-title{color:var(--fg)}
        body.dark .decision-table-count{color:var(--gray-light)}
        body.dark .decision-table th{color:var(--gray-light);background:#1b2027;border-color:rgba(245,245,245,0.12)}
        body.dark .decision-table td{color:var(--fg-light);border-color:rgba(245,245,245,0.08)}
        body.dark .decision-table tbody tr:nth-child(odd){background:rgba(245,245,245,0.012)}
        body.dark .decision-table tbody tr:hover{background:rgba(245,245,245,0.05)}
        body.dark .meta-pill{border-color:rgba(245,245,245,0.22);color:var(--gray-light)}
        body.dark .mode-pill{border-color:rgba(245,245,245,0.24);color:var(--gray-light)}
        body.dark .pill.verdict-yes{background:rgba(22,163,74,0.2);border-color:rgba(74,222,128,0.44);color:#86efac}
        body.dark .pill.verdict-no{background:rgba(220,38,38,0.18);border-color:rgba(252,165,165,0.38);color:#fca5a5}
        body.dark .pill.verdict-tie{background:rgba(217,119,6,0.2);border-color:rgba(251,191,36,0.4);color:#fcd34d}
        body.dark .pill.verdict-pending,body.dark .pill.verdict-unknown{background:rgba(245,245,245,0.1);border-color:rgba(245,245,245,0.2);color:var(--gray-light)}
        body.dark .decision-empty{color:var(--gray-light)}
        body.dark .logos{border-color:rgba(245,245,245,0.06)}
        body.dark .logos-track span{color:rgba(245,245,245,0.4)}
        body.dark .logos-track span::after{opacity:0.4}
        body.dark .feat{background:rgba(245,245,245,0.03);border-color:rgba(245,245,245,0.06)}
        body.dark .feat:hover{border-color:rgba(245,245,245,0.12);box-shadow:0 40px 80px rgba(0,0,0,0.5)}
        body.dark .feat::before{background:conic-gradient(from 0deg,transparent,rgba(245,245,245,0.03),transparent 30%)}
        body.dark .how-card{background:var(--bg);border-color:rgba(245,245,245,0.08)}
        body.dark .how-card:hover{border-color:rgba(245,245,245,0.15);box-shadow:0 20px 60px rgba(0,0,0,0.3)}
        body.dark .how-card::after{color:rgba(245,245,245,0.2)}
        body.dark .how-num{color:rgba(245,245,245,0.08)}
        body.dark .cta::before{background:radial-gradient(circle,rgba(245,245,245,0.03) 0%,transparent 50%)}
        body.dark .cta::before,
        body.dark .feat::before{display:none}
        body.dark .mcp-card{border-color:rgba(245,245,245,0.08)}
        body.dark .mcp-card:hover{border-color:rgba(245,245,245,0.15);box-shadow:0 20px 60px rgba(0,0,0,0.4)}
        body.dark .mcp-meta-tag{background:rgba(245,245,245,0.06)}
        body.dark .mcp-btn-secondary{background:rgba(245,245,245,0.08)}
        body.dark .mcp-btn-secondary:hover{background:rgba(245,245,245,0.12)}
        body.dark .agent-feat{background:rgba(245,245,245,0.03);border-color:rgba(245,245,245,0.08)}
        body.dark .agent-feat:hover{border-color:rgba(245,245,245,0.12);box-shadow:0 15px 40px rgba(0,0,0,0.3)}
        body.dark .refresh-btn{background:var(--bg);border-color:rgba(245,245,245,0.15)}
        body.dark .refresh-btn:hover{border-color:var(--fg)}
        body.dark footer{border-color:rgba(245,245,245,0.06)}
        body.dark .foot-x a{background:rgba(245,245,245,0.05);border-color:rgba(245,245,245,0.08)}
        body.dark .foot-x a:hover{background:var(--fg);border-color:var(--fg)}
        body.dark .foot-x svg{fill:var(--gray)}
        body.dark .foot-x a:hover svg{fill:var(--bg)}
        body.dark .foot-logo .logo-mark{opacity:0.55}
        body.dark .foot-logo .logo-mark img{filter:brightness(0) invert(1)}
        body.dark .m-bg{background:rgba(17,17,17,0.95)}
        body.dark .m-bg.on{backdrop-filter:none;-webkit-backdrop-filter:none}
        body.dark .modal{background:var(--bg);border-color:rgba(245,245,245,0.1);box-shadow:0 40px 80px rgba(0,0,0,0.6)}
        body.dark .m-head{border-color:rgba(245,245,245,0.06)}
        body.dark .m-x{background:rgba(245,245,245,0.08)}
        body.dark .m-x:hover{background:rgba(245,245,245,0.12)}
        body.dark .mobile-menu{background:var(--bg);box-shadow:-10px 0 40px rgba(0,0,0,0.5)}
        body.dark .mobile-menu a{color:var(--fg);border-color:rgba(245,245,245,0.06)}
        body.dark .mobile-menu a.nav-cta{background:var(--fg);color:var(--bg)}
        body.dark .mobile-overlay{background:rgba(0,0,0,0.5)}
        body.dark .mob span{background:var(--fg)}
        body.dark .install-badge{background:rgba(245,245,245,0.04);border-color:rgba(245,245,245,0.16)}
        body.dark .install-badge:hover{border-color:rgba(245,245,245,0.28)}
        body.dark .code-block{background:#111111;border-color:rgba(245,245,245,0.16)}
        body.dark .playground-card{background:rgba(245,245,245,0.03);border-color:rgba(245,245,245,0.14)}
        body.dark .pg-field select,body.dark .pg-field textarea{background-color:#111111;border-color:rgba(245,245,245,0.18);color:var(--fg)}
        body.dark .pg-btn.secondary{background:rgba(245,245,245,0.1);color:var(--fg)}
        body.dark .pg-select{background-color:#111111;border-color:rgba(245,245,245,0.18);color:var(--fg)}
        body.dark .trail-filter{background-color:#111111;border-color:rgba(245,245,245,0.18);color:var(--fg)}
        body.dark .pg-field select,body.dark .pg-select,body.dark .trail-filter,body.dark select.pg-assert-input{
            background-image:
                linear-gradient(rgba(245,245,245,0.24), rgba(245,245,245,0.24)),
                url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 20 20'%3E%3Ctext x='10' y='14' text-anchor='middle' font-size='16' font-weight='700' font-family='Inter,Arial,sans-serif' fill='%23f5f5f5'%3E%E2%8C%84%3C/text%3E%3C/svg%3E");
        }
        body.dark .pg-redact-label{background:rgba(245,245,245,0.07);border-color:rgba(245,245,245,0.2)}
        body.dark .pg-assert-input{background-color:#111111;border-color:rgba(245,245,245,0.18);color:var(--fg)}
        body.dark .pg-assert-chip{background:rgba(245,245,245,0.08);border-color:rgba(245,245,245,0.2)}
        body.dark .pg-monitor-item{background:rgba(245,245,245,0.05);border-color:rgba(245,245,245,0.14)}
        body.dark .pg-mini-btn{background:rgba(245,245,245,0.14)}
        body.dark .pg-mini-btn.warn{background:rgba(248,113,113,0.18);color:#fca5a5}
        body.dark .pg-advanced{background:rgba(245,245,245,0.03);border-color:rgba(245,245,245,0.14)}
        body.dark .pg-advanced[open] summary{border-bottom-color:rgba(245,245,245,0.1)}
        body.dark .pg-demo-pill{background:rgba(245,245,245,0.08);border-color:rgba(245,245,245,0.2);color:var(--fg)}
        body.dark .pg-demo-pill:hover{background:rgba(245,245,245,0.14)}
        body.dark .trail-action{background:rgba(245,245,245,0.12);color:var(--fg)}
        body.dark .trail-action.active{background:rgba(22,163,74,0.22)}
        body.dark .trail-wrap{border-color:rgba(245,245,245,0.16)}
        body.dark .trail-table th,body.dark .trail-table td{border-bottom-color:rgba(245,245,245,0.08)}
        body.dark .trail-table thead th{background:#111111}
        body.dark .trail-table tbody tr:nth-child(even) td{background:rgba(245,245,245,0.03)}
        body.dark .trail-table tbody tr:hover td{background:rgba(245,245,245,0.08)}
        body.dark .price-card{background:rgba(245,245,245,0.03);border-color:rgba(245,245,245,0.14)}
        body.dark .price-card.featured{border-color:rgba(245,245,245,0.28);box-shadow:0 12px 30px rgba(0,0,0,0.35)}
        body.dark .price-btn{background:rgba(245,245,245,0.1);border-color:rgba(245,245,245,0.18);color:var(--fg)}
        body.dark .price-card.featured .price-btn{background:var(--fg);color:var(--bg);border-color:var(--fg)}
        body.dark .pg-trust-badge{border-color:rgba(245,245,245,0.2);background:rgba(245,245,245,0.07)}
        body.dark .vendor-request-link{border-color:rgba(245,245,245,0.2);background:rgba(245,245,245,0.08)}
        body.dark .vendor-request-link:hover{background:rgba(245,245,245,0.14)}
        body.dark .vr-field input,body.dark .vr-field textarea{background:#111111;border-color:rgba(245,245,245,0.18);color:var(--fg)}
        body.dark .vr-btn.secondary{background:rgba(245,245,245,0.12)}
        body.dark .pg-vendor-requests{border-top-color:rgba(245,245,245,0.14)}
        body.dark .pg-vendor-refresh{background:rgba(245,245,245,0.12)}
        body.dark .pricing-cta-btn.secondary{background:rgba(245,245,245,0.1);border-color:rgba(245,245,245,0.2)}
        body.dark .agent-hero-btn.secondary{background:rgba(245,245,245,0.1);border-color:rgba(245,245,245,0.2)}
        body.dark .pg-btn:focus-visible,
        body.dark .pg-field select:focus-visible,
        body.dark .pg-field textarea:focus-visible,
        body.dark .pg-select:focus-visible,
        body.dark .trail-filter:focus-visible,
        body.dark .pg-assert-input:focus-visible{outline-color:rgba(245,245,245,0.55)}

        /* MODE CONTAINERS */
        #human-mode,#agent-mode,#overview-mode{transition:none}
        #agent-mode,#overview-mode{display:none}
        body.agents #human-mode{display:none}
        body.agents #overview-mode{display:none}
        body.agents #agent-mode{display:block}
        body.overview #human-mode{display:none}
        body.overview #agent-mode{display:none}
        body.overview #overview-mode{display:block}

        /* AGENT MODE */
        .agent-hero{min-height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:8rem 1.5rem 4rem;text-align:center;position:relative;z-index:2;background:var(--bg)}
        .agent-hero-inner{max-width:700px}
        .agent-hero h1{font-size:clamp(2.5rem,10vw,5.5rem);font-weight:800;letter-spacing:-0.05em;line-height:0.9;margin-bottom:1rem;color:var(--fg)}
        .agent-hero .sub{margin-bottom:3rem;animation:fadeUp 0.7s var(--ease) 0.28s forwards}
        .agent-hero-ctas{display:flex;gap:0.7rem;justify-content:center;flex-wrap:wrap;margin:0 auto 2.1rem;animation:fadeUp 0.7s var(--ease) 0.32s forwards}
        .agent-hero-btn{display:inline-flex;align-items:center;justify-content:center;min-height:44px;padding:0.72rem 1.18rem;border-radius:12px;font-size:0.84rem;font-weight:600;text-decoration:none;border:1px solid transparent;transition:all 0.25s var(--ease-out)}
        .agent-hero-btn.primary{background:var(--fg);color:var(--bg);border-color:var(--fg)}
        .agent-hero-btn.secondary{background:rgba(17,17,17,0.08);color:var(--fg);border-color:rgba(17,17,17,0.14)}
        .agent-hero-btn:hover{transform:translateY(-1px)}

        /* MCP CATALOG */
        .mcp-catalog{max-width:800px;margin:0 auto;width:100%;display:flex;flex-direction:column;gap:1.25rem}
        .mcp-card{background:var(--bg);border:2px solid rgba(17,17,17,0.08);border-radius:24px;padding:2rem;transition:all 0.4s var(--ease);position:relative;overflow:hidden}
        .mcp-card:hover{border-color:rgba(17,17,17,0.15);transform:translateY(-4px);box-shadow:0 20px 60px rgba(0,0,0,0.08)}
        .mcp-card-head{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1.25rem;gap:1rem}
        .mcp-card-info h3{font-size:1.25rem;font-weight:700;margin-bottom:0.2rem;color:var(--fg)}
        .mcp-card-info .mcp-url{font-size:0.75rem;color:var(--gray);font-family:'SF Mono',Monaco,Consolas,monospace;font-weight:500}
        .mcp-card-info .mcp-sync{font-size:0.67rem;color:var(--gray-light);margin-top:0.26rem}
        .mcp-card-status{display:inline-flex;align-items:center;gap:0.4rem;background:rgba(22,163,74,0.08);color:var(--g);padding:0.3rem 0.75rem;border-radius:100px;font-size:0.65rem;font-weight:700;text-transform:uppercase;letter-spacing:0.05em;flex-shrink:0}
        .mcp-card-status .status-dot{width:6px;height:6px;background:var(--g);border-radius:50%;animation:pulse 2s ease-in-out infinite}
        .mcp-card-desc{color:var(--gray);font-size:0.9rem;line-height:1.6;margin-bottom:1.25rem}
        .mcp-card-meta{display:flex;gap:1rem;flex-wrap:wrap;margin-bottom:1.5rem}
        .mcp-meta-tag{display:inline-flex;align-items:center;gap:0.35rem;background:rgba(17,17,17,0.04);padding:0.35rem 0.75rem;border-radius:100px;font-size:0.7rem;font-weight:600;color:var(--gray)}
        .mcp-meta-tag svg{width:12px;height:12px;stroke:currentColor;fill:none;stroke-width:2}
        .mcp-card-actions{display:flex;gap:0.75rem;flex-wrap:wrap}
        .mcp-btn{display:inline-flex;align-items:center;gap:0.4rem;padding:0.65rem 1.25rem;border-radius:14px;font-family:inherit;font-size:0.8rem;font-weight:600;text-decoration:none;cursor:pointer;transition:all 0.3s var(--ease-out);border:none}
        .mcp-btn-primary{background:var(--fg);color:var(--bg)}
        .mcp-btn-primary:hover{transform:scale(1.05);box-shadow:0 10px 30px rgba(17,17,17,0.2)}
        .mcp-btn-secondary{background:rgba(17,17,17,0.06);color:var(--fg)}
        .mcp-btn-secondary:hover{background:rgba(17,17,17,0.1);transform:scale(1.03)}
        .mcp-btn svg{width:14px;height:14px;stroke:currentColor;fill:none;stroke-width:2}

        /* CONNECT SECTION */
        .install-badges{display:flex;flex-wrap:wrap;gap:0.5rem;justify-content:center;margin:2rem 0}
        .install-badge{display:inline-flex;align-items:center;justify-content:center;min-height:44px;padding:0.34rem 0.5rem;border-radius:10px;background:rgba(17,17,17,0.04);border:1px solid rgba(17,17,17,0.1);transition:transform 0.2s var(--ease),opacity 0.2s,border-color 0.2s var(--ease)}
        .install-badge:hover{transform:translateY(-2px);opacity:0.92;border-color:rgba(17,17,17,0.2)}
        .install-badge img{display:block;height:32px;border-radius:6px}
        .connect{padding:6rem 1.5rem;position:relative;z-index:2;background:var(--bg)}
        .connect-inner{max-width:800px;margin:0 auto}
        #mcp-playground .connect-inner{max-width:1160px}
        #mcp-playground .pg-head{display:flex;align-items:center;justify-content:space-between;gap:0.8rem;flex-wrap:wrap}
        #mcp-playground h2{margin-bottom:0.35rem}
        #mcp-playground .connect-inner>p{max-width:680px;margin-bottom:2.15rem}
        .pg-trust-badge{display:inline-flex;align-items:center;gap:0.35rem;border-radius:999px;padding:0.32rem 0.66rem;font-size:0.68rem;font-weight:700;letter-spacing:0.02em;border:1px solid rgba(17,17,17,0.14);background:rgba(17,17,17,0.04);color:var(--gray)}
        .pg-trust-badge::before{content:'';width:7px;height:7px;border-radius:50%;background:currentColor;opacity:0.7}
        .pg-trust-badge.pass{color:#15803d;background:rgba(22,163,74,0.12);border-color:rgba(22,163,74,0.28)}
        .pg-trust-badge.fail{color:#b91c1c;background:rgba(220,38,38,0.12);border-color:rgba(220,38,38,0.28)}
        .pg-trust-badge.running{color:#b45309;background:rgba(217,119,6,0.12);border-color:rgba(217,119,6,0.28)}
        .vendor-request-link{display:inline-flex;align-items:center;gap:0.4rem;border-radius:999px;padding:0.36rem 0.7rem;font-size:0.72rem;font-weight:600;border:1px solid rgba(17,17,17,0.15);background:rgba(17,17,17,0.04);color:var(--fg);text-decoration:none;cursor:pointer}
        .vendor-request-link:hover{background:rgba(17,17,17,0.08)}
        .vendor-inline-note{margin-top:0.65rem;font-size:0.74rem;color:var(--gray)}
        .vr-form{display:grid;gap:0.62rem}
        .vr-field{display:grid;gap:0.3rem}
        .vr-field label{font-size:0.72rem;font-weight:600;color:var(--gray)}
        .vr-field input,.vr-field textarea{font:inherit;font-size:0.78rem;padding:0.58rem 0.68rem;border-radius:10px;border:1px solid rgba(17,17,17,0.14);background:var(--bg);color:var(--fg)}
        .vr-field textarea{min-height:74px;resize:vertical}
        .vr-actions{display:flex;gap:0.5rem;flex-wrap:wrap}
        .vr-btn{border:none;border-radius:10px;padding:0.58rem 0.8rem;font:inherit;font-size:0.76rem;font-weight:600;cursor:pointer}
        .vr-btn.primary{background:var(--fg);color:var(--bg)}
        .vr-btn.secondary{background:rgba(17,17,17,0.08);color:var(--fg)}
        .vr-note{font-size:0.72rem;color:var(--gray)}
        .vr-status{font-size:0.72rem;margin-top:0.2rem}
        .vr-status.ok{color:#15803d}
        .vr-top{margin-top:0.55rem;font-size:0.72rem;color:var(--gray)}
        .vr-top-list{margin-top:0.3rem;padding-left:1rem;display:grid;gap:0.18rem}
        .pg-vendor-requests{margin-top:0.8rem;padding-top:0.65rem;border-top:1px dashed rgba(17,17,17,0.12)}
        .pg-vendor-head{display:flex;align-items:center;justify-content:space-between;gap:0.5rem;flex-wrap:wrap}
        .pg-vendor-title{font-size:0.72rem;font-weight:700;letter-spacing:0.06em;text-transform:uppercase;color:var(--gray)}
        .pg-vendor-refresh{border:none;border-radius:8px;padding:0.32rem 0.52rem;font:inherit;font-size:0.68rem;font-weight:600;cursor:pointer;background:rgba(17,17,17,0.08);color:var(--fg)}
        .pg-vendor-list{margin-top:0.5rem;padding-left:1rem;display:grid;gap:0.2rem;font-size:0.72rem;color:var(--gray)}
        .connect h2{font-size:clamp(1.5rem,4vw,2.25rem);font-weight:700;letter-spacing:-0.03em;margin-bottom:0.5rem;color:var(--fg)}
        .connect>p,.connect-inner>p{color:var(--gray);font-size:0.9rem;line-height:1.6;margin-bottom:2rem}
        .code-block{background:var(--bg-dark);border:1px solid rgba(17,17,17,0.1);border-radius:16px;padding:1.5rem;margin-bottom:1.5rem;position:relative;overflow-x:auto}
        .code-block-label{font-size:0.6rem;font-weight:700;text-transform:uppercase;letter-spacing:0.1em;color:var(--gray-light);margin-bottom:0.75rem;display:flex;justify-content:space-between;align-items:center}
        .code-copy{background:rgba(245,245,245,0.1);border:none;padding:0.3rem 0.7rem;border-radius:8px;color:var(--gray-light);font-family:inherit;font-size:0.6rem;font-weight:600;cursor:pointer;transition:all 0.3s}
        .code-copy:hover{background:rgba(245,245,245,0.2);color:var(--fg-light)}
        .code-block pre{margin:0;font-family:'SF Mono',Monaco,Consolas,monospace;font-size:0.78rem;line-height:1.7;color:var(--fg-light);white-space:pre;overflow-x:auto}
        .code-block .k{color:#c084fc}
        .code-block .s{color:#86efac}
        .code-block .n{color:#93c5fd}
        .code-block .c{color:#6b7280}
        .playground-card{background:rgba(17,17,17,0.02);border:1px solid rgba(17,17,17,0.1);border-radius:18px;padding:1.1rem;margin-bottom:1rem;min-width:0}
        .playground-stack{display:grid;gap:1.15rem}
        .playground-split{display:grid;grid-template-columns:minmax(0,1.25fr) minmax(0,1fr);gap:1rem}
        .pg-tabs{display:flex;gap:0.5rem;flex-wrap:wrap}
        .pg-tab-btn{border:1px solid rgba(17,17,17,0.16);background:rgba(17,17,17,0.05);color:var(--fg);border-radius:999px;padding:0.38rem 0.72rem;font:inherit;font-size:0.71rem;font-weight:700;cursor:pointer}
        .pg-tab-btn.active{background:var(--fg);border-color:var(--fg);color:var(--bg)}
        .pg-tab-panel[hidden]{display:none}
        .pg-section-title{font-size:0.71rem;font-weight:700;text-transform:uppercase;letter-spacing:0.1em;color:var(--gray);margin-bottom:0.75rem}
        .pg-demo-strip{display:flex;flex-wrap:wrap;gap:0.45rem;margin-bottom:0.75rem}
        .pg-demo-pill{border:1px solid rgba(17,17,17,0.16);background:rgba(17,17,17,0.05);color:var(--fg);border-radius:999px;padding:0.38rem 0.72rem;font:inherit;font-size:0.7rem;font-weight:600;cursor:pointer}
        .pg-demo-pill:hover{background:rgba(17,17,17,0.1)}
        .pg-grid{display:grid;grid-template-columns:minmax(0,1fr) minmax(0,1fr) minmax(0,1.15fr);gap:0.85rem}
        .pg-field{display:flex;flex-direction:column;gap:0.35rem}
        .pg-field label{font-size:0.72rem;font-weight:600;color:var(--gray)}
        .pg-field select,.pg-field textarea{font:inherit;font-size:0.85rem;padding:0.7rem 0.8rem;border-radius:12px;border:1px solid rgba(17,17,17,0.14);background:var(--bg);color:var(--fg)}
        .pg-field select{padding-right:3.1rem}
        .pg-field select,.pg-select,.trail-filter,select.pg-assert-input{
            appearance:none;
            -webkit-appearance:none;
            cursor:pointer;
            background-image:
                linear-gradient(rgba(17,17,17,0.16), rgba(17,17,17,0.16)),
                url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 20 20'%3E%3Ctext x='10' y='14' text-anchor='middle' font-size='16' font-weight='700' font-family='Inter,Arial,sans-serif' fill='%236b7280'%3E%E2%8C%84%3C/text%3E%3C/svg%3E");
            background-position:right 2.35rem center,right 0.95rem center;
            background-size:1px 58%,1.05rem 1.05rem;
            background-repeat:no-repeat;
        }
        .pg-field textarea{min-height:150px;resize:vertical;font-family:'SF Mono',Monaco,Consolas,monospace}
        .pg-inline{display:grid;grid-template-columns:minmax(0,1fr) auto;gap:0.5rem;align-items:center}
        .pg-preset-inline{grid-template-columns:1fr}
        .pg-preset-inline .pg-mini{width:100%}
        .pg-inline select{min-width:0;width:100%}
        #pgPreset{font-size:0.82rem}
        .pg-mini{padding:0.6rem 0.8rem;white-space:nowrap}
        .pg-actions{display:flex;gap:0.6rem;flex-wrap:wrap;margin-top:0.5rem}
        .pg-actions-primary .pg-btn.primary{min-width:140px}
        .pg-btn{border:none;border-radius:12px;padding:0.65rem 1rem;font:inherit;font-size:0.8rem;font-weight:600;cursor:pointer;min-height:42px;line-height:1}
        .pg-btn:focus-visible,.pg-field select:focus-visible,.pg-field textarea:focus-visible,.pg-select:focus-visible,.trail-filter:focus-visible,.pg-assert-input:focus-visible{outline:2px solid rgba(17,17,17,0.35);outline-offset:2px}
        .pg-btn.primary{background:var(--fg);color:var(--bg)}
        .pg-btn.secondary{background:rgba(17,17,17,0.08);color:var(--fg)}
        .pg-btn:disabled{opacity:0.6;cursor:not-allowed}
        .pg-advanced{margin-top:0.85rem;border:1px solid rgba(17,17,17,0.12);border-radius:12px;background:rgba(17,17,17,0.02)}
        .pg-advanced summary{list-style:none;cursor:pointer;padding:0.65rem 0.8rem;font-size:0.78rem;font-weight:600;color:var(--gray)}
        .pg-advanced summary::-webkit-details-marker{display:none}
        .pg-advanced[open] summary{border-bottom:1px solid rgba(17,17,17,0.08)}
        .pg-advanced-body{padding:0.8rem}
        .pg-case-row{display:flex;gap:0.5rem;flex-wrap:wrap;align-items:center;margin-top:0.6rem}
        .pg-monitor-row{display:flex;gap:0.5rem;flex-wrap:wrap;align-items:center;margin-top:0.55rem}
        .pg-monitor-list{display:flex;flex-direction:column;gap:0.45rem;margin-top:0.55rem}
        .pg-monitor-item{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:0.45rem;padding:0.45rem 0.6rem;border-radius:10px;border:1px solid rgba(17,17,17,0.12);background:rgba(17,17,17,0.03);font-size:0.72rem}
        .pg-monitor-meta{color:var(--gray)}
        .pg-monitor-actions{display:flex;gap:0.35rem}
        .pg-mini-btn{border:none;border-radius:8px;padding:0.28rem 0.48rem;font:inherit;font-size:0.68rem;font-weight:600;cursor:pointer;background:rgba(17,17,17,0.08);color:var(--fg)}
        .pg-mini-btn.warn{background:rgba(220,38,38,0.12);color:#b91c1c}
        .pg-select{font:inherit;font-size:0.78rem;padding:0.58rem 0.7rem;border-radius:10px;border:1px solid rgba(17,17,17,0.14);background:var(--bg);color:var(--fg);min-width:220px;padding-right:3.1rem}
        .pg-redact-row{display:flex;gap:0.45rem;flex-wrap:wrap;align-items:center;margin-top:0.55rem}
        .pg-redact-title{font-size:0.72rem;color:var(--gray);margin-right:0.1rem}
        .pg-redact-label{display:inline-flex;align-items:center;gap:0.3rem;padding:0.3rem 0.55rem;border-radius:999px;border:1px solid rgba(17,17,17,0.14);background:rgba(17,17,17,0.04);font-size:0.7rem;color:var(--fg)}
        .pg-redact-label input{accent-color:var(--fg);width:12px;height:12px}
        .pg-assert-row{display:flex;gap:0.5rem;flex-wrap:wrap;align-items:center;margin-top:0.65rem}
        .pg-assert-input{font:inherit;font-size:0.74rem;padding:0.55rem 0.65rem;border-radius:10px;border:1px solid rgba(17,17,17,0.14);background:var(--bg);color:var(--fg)}
        select.pg-assert-input{padding-right:3rem}
        .pg-assert-template{min-width:220px}
        .pg-assert-input.path{min-width:220px}
        .pg-assert-input.expected{min-width:180px}
        .pg-assert-list{display:flex;flex-wrap:wrap;gap:0.4rem;margin-top:0.5rem}
        .pg-assert-chip{display:inline-flex;align-items:center;gap:0.35rem;background:rgba(17,17,17,0.05);border:1px solid rgba(17,17,17,0.12);border-radius:999px;padding:0.32rem 0.6rem;font-size:0.7rem}
        .pg-assert-chip button{border:none;background:transparent;color:var(--gray);cursor:pointer;font-size:0.9rem;line-height:1}
        .pg-note{font-size:0.75rem;color:var(--gray);margin-top:0.7rem}
        .trail-controls{margin-top:1rem;display:flex;gap:0.5rem;flex-wrap:wrap;padding:0 0.85rem}
        .trail-filter{font:inherit;font-size:0.74rem;padding:0.5rem 0.7rem;border-radius:10px;border:1px solid rgba(17,17,17,0.14);background-color:var(--bg);color:var(--fg);padding-right:3rem;background-repeat:no-repeat;background-position:right 0.95rem center;background-size:1.05rem 1.05rem}
        .trail-meta{font-size:0.72rem;color:var(--gray);margin-top:0.45rem;padding:0 0.85rem}
        .trail-wrap{margin-top:1rem;border:1px solid rgba(17,17,17,0.12);border-radius:14px;overflow:auto}
        .trail-table{width:100%;border-collapse:collapse;font-size:0.76rem;min-width:780px}
        .trail-table th,.trail-table td{padding:0.62rem 0.65rem;border-bottom:1px solid rgba(17,17,17,0.08);text-align:left;vertical-align:top}
        .trail-table th:first-child,.trail-table td:first-child{padding-left:0.9rem}
        .trail-table th{font-size:0.66rem;text-transform:uppercase;letter-spacing:0.08em;color:var(--gray)}
        .trail-table thead th{position:sticky;top:0;background:var(--bg);z-index:1}
        .trail-table tbody tr:nth-child(even) td{background:rgba(17,17,17,0.015)}
        .trail-table tbody tr:hover td{background:rgba(17,17,17,0.04)}
        .trail-table tr.status-row-network td{background:rgba(220,38,38,0.05)}
        .status-chip{display:inline-flex;align-items:center;justify-content:center;min-width:56px;padding:0.2rem 0.45rem;border-radius:999px;font-size:0.66rem;font-weight:700;border:1px solid transparent}
        .status-chip.success{background:rgba(22,163,74,0.12);color:#15803d;border-color:rgba(22,163,74,0.3)}
        .status-chip.client{background:rgba(217,119,6,0.12);color:#b45309;border-color:rgba(217,119,6,0.3)}
        .status-chip.server,.status-chip.network{background:rgba(220,38,38,0.12);color:#b91c1c;border-color:rgba(220,38,38,0.3)}
        .status-chip.other{background:rgba(17,17,17,0.08);color:var(--gray);border-color:rgba(17,17,17,0.2)}
        .status-chip.assert-pass{background:rgba(22,163,74,0.12);color:#15803d;border-color:rgba(22,163,74,0.3)}
        .status-chip.assert-fail{background:rgba(220,38,38,0.12);color:#b91c1c;border-color:rgba(220,38,38,0.3)}
        .status-chip.assert-na{background:rgba(17,17,17,0.08);color:var(--gray);border-color:rgba(17,17,17,0.2)}
        .trail-action{border:none;border-radius:8px;padding:0.25rem 0.5rem;font:inherit;font-size:0.66rem;font-weight:600;cursor:pointer;background:rgba(17,17,17,0.08);color:var(--fg);margin-right:0.25rem}
        .trail-action.active{background:rgba(22,163,74,0.16);color:#15803d}
        .trail-empty{padding:0.9rem;color:var(--gray);font-size:0.78rem;line-height:1.5}
        .output-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
        .pg-provenance{margin-top:0.75rem;display:flex;flex-wrap:wrap;gap:0.5rem}
        .pg-provenance[hidden]{display:none}
        .pg-prov-pill{display:inline-flex;align-items:center;gap:0.4rem;padding:0.34rem 0.62rem;border-radius:999px;border:1px solid rgba(17,17,17,0.12);background:rgba(17,17,17,0.04);font-size:0.68rem;color:var(--gray)}
        .pg-prov-pill strong{font-weight:700;color:var(--fg)}
        .pg-prov-pill a{color:var(--fg);text-decoration:underline;text-underline-offset:2px;word-break:break-all}
        .pricing{padding:3rem 1.5rem 6rem;position:relative;z-index:2;background:var(--bg)}
        .pricing .sec-head{margin-bottom:1.4rem}
        .pricing-grid{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:0.95rem}
	        .price-card{background:rgba(17,17,17,0.02);border:1px solid rgba(17,17,17,0.12);border-radius:18px;padding:1.2rem;display:flex;flex-direction:column;gap:0.8rem}
	        .price-card.featured{border-color:rgba(17,17,17,0.28);box-shadow:0 12px 30px rgba(0,0,0,0.06)}
	        .price-tier{font-size:0.78rem;font-weight:700;letter-spacing:0.08em;text-transform:uppercase;color:var(--gray)}
	        .price-amt{font-size:1.6rem;font-weight:700;letter-spacing:-0.02em;color:var(--fg)}
	        .price-amt span{font-size:0.82rem;color:var(--gray);font-weight:600}
	        .price-list{display:grid;gap:0.42rem;font-size:0.78rem;color:var(--gray)}
	        .price-list div::before{content:"• ";color:var(--fg)}
	        .price-btn{margin-top:auto;display:inline-flex;justify-content:center;align-items:center;min-height:42px;padding:0.62rem 0.95rem;border-radius:12px;text-decoration:none;font-size:0.8rem;font-weight:600;background:rgba(17,17,17,0.08);color:var(--fg);border:1px solid rgba(17,17,17,0.1)}
	        .price-card.featured .price-btn{background:var(--fg);color:var(--bg);border-color:var(--fg)}
	        .pricing-note{max-width:1100px;margin:0.85rem auto 0;font-size:0.72rem;color:var(--gray);text-align:center}
	        .pilot-form{display:grid;gap:0.7rem}
	        .pilot-form label{display:block;font-size:0.72rem;color:var(--gray);font-weight:600;margin-bottom:0.2rem}
	        .pilot-form input,.pilot-form textarea{width:100%;padding:0.65rem 0.8rem;border-radius:12px;border:1px solid rgba(17,17,17,0.14);background:rgba(17,17,17,0.03);color:var(--fg);font:inherit;font-size:0.84rem;outline:none}
	        .pilot-form textarea{min-height:92px;resize:vertical}
	        body.dark .pilot-form input,body.dark .pilot-form textarea{border-color:rgba(245,245,245,0.16);background:rgba(245,245,245,0.06)}
	        .pilot-actions{display:flex;gap:0.6rem;flex-wrap:wrap;align-items:center}
	        .pilot-actions .cta-btn{min-height:42px;padding:0.7rem 1rem;border-radius:12px}
	        .pilot-actions .ghost-btn{display:inline-flex;align-items:center;justify-content:center;min-height:42px;padding:0.7rem 1rem;border-radius:12px;border:1px solid rgba(17,17,17,0.14);background:rgba(17,17,17,0.04);color:var(--fg);font:inherit;font-weight:600;cursor:pointer}
	        body.dark .pilot-actions .ghost-btn{border-color:rgba(245,245,245,0.18);background:rgba(245,245,245,0.06)}
	        .pilot-status{font-size:0.74rem;color:var(--gray)}
	        .pilot-hint{font-size:0.72rem;color:var(--gray);line-height:1.5}
	        .pg-field,.pg-inline,.pg-assert-row>*{min-width:0}
	        .pg-assert-input,.pg-select,.trail-filter{max-width:100%}
	        #pgResponse,#pgDiff{white-space:pre-wrap;word-break:break-word;min-height:74px}

        @media(min-width:1280px){
            #mcp-playground .connect-inner{max-width:1240px}
            .playground-card{padding:1.2rem}
            .playground-split{grid-template-columns:minmax(0,1.3fr) minmax(0,1fr);gap:1.15rem}
            .output-grid{gap:1.15rem}
        }

        @media(min-width:1440px){
            #mcp-playground .connect-inner{max-width:1280px}
            .playground-stack{gap:1.3rem}
        }

        /* AGENT FEATURES */
        .agent-features{padding:6rem 1.5rem;position:relative;z-index:2}
        .agent-feat-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;max-width:800px;margin:0 auto}
        .agent-feat{background:rgba(17,17,17,0.02);border:1px solid rgba(17,17,17,0.08);border-radius:20px;padding:1.75rem;transition:all 0.4s var(--ease)}
        .agent-feat:hover{border-color:rgba(17,17,17,0.15);transform:translateY(-4px);box-shadow:0 15px 40px rgba(0,0,0,0.06)}
        .agent-feat h3{font-size:0.95rem;font-weight:600;margin-bottom:0.3rem;color:var(--fg)}
        .agent-feat p{color:var(--gray);font-size:0.8rem;line-height:1.5}

        @media(max-width:1100px){
            .playground-split,.output-grid{grid-template-columns:1fr}
        }

        @media(max-width:980px){
            .pg-grid{grid-template-columns:repeat(2,minmax(0,1fr))}
            .pg-field[style*="grid-column"]{grid-column:1/-1}
        }

        @media(max-width:700px){
            .pg-grid{grid-template-columns:1fr}
            .pg-inline{grid-template-columns:1fr}
            .pg-inline .pg-mini{width:100%}
            .pg-actions .pg-btn{flex:1 1 calc(50% - 0.4rem)}
            .pg-assert-row{display:grid;grid-template-columns:1fr}
            .pg-assert-row .pg-btn,.pg-assert-row .pg-assert-input{width:100%}
            .pg-case-row .pg-btn,.pg-case-row .pg-select{width:100%;min-width:0}
            .pg-monitor-row .pg-btn,.pg-monitor-row .pg-select{width:100%;min-width:0}
            .trail-controls{display:grid;grid-template-columns:1fr 1fr}
            .trail-controls .trail-filter{width:100%}
            .pricing-grid{grid-template-columns:1fr}
        }

        @media(max-width:768px){
            .mcp-card-head{flex-direction:column}
            .agent-feat-grid{grid-template-columns:1fr}
            .agent-hero{padding:6rem 1.25rem 3rem}
            .agent-hero h1{font-size:clamp(2rem,12vw,3.5rem)}
            #mcp-playground .connect-inner{max-width:800px}
        }

        /* FOOTER */
        footer{padding:2.5rem 1.5rem;border-top:1px solid rgba(17,17,17,0.06);position:relative;z-index:2;background:var(--bg)}
        .foot-inner{max-width:1100px;margin:0 auto;display:flex;justify-content:space-between;align-items:center}
        .foot-logo{display:flex;align-items:center;gap:0.5rem;color:var(--gray);font-size:0.85rem}
        .foot-logo .logo-mark{width:20px;height:20px;opacity:0.4}
        .foot-logo .logo-mark img{width:20px;height:20px;object-fit:contain}
        .foot-links{display:flex;gap:1.5rem}
        .foot-links a{color:var(--gray);text-decoration:none;font-size:0.75rem;transition:color 0.3s}
        .foot-links a:hover{color:var(--fg)}
        .foot-x a{width:36px;height:36px;background:rgba(17,17,17,0.03);border:1px solid rgba(17,17,17,0.06);border-radius:10px;display:flex;align-items:center;justify-content:center;transition:all 0.3s}
        .foot-x a:hover{background:var(--fg);border-color:var(--fg)}
        .foot-x svg{width:14px;height:14px;fill:var(--gray);transition:fill 0.3s}
        .foot-x a:hover svg{fill:var(--bg)}

        /* MODAL */
        .m-bg{display:none;position:fixed;inset:0;background:rgba(245,245,245,0.95);backdrop-filter:none;-webkit-backdrop-filter:none;z-index:2000;opacity:0;visibility:hidden;pointer-events:none;transition:all 0.4s}
        .m-bg.on{display:block;opacity:1;visibility:visible;pointer-events:auto;backdrop-filter:blur(30px);-webkit-backdrop-filter:blur(30px)}
        .modal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0.9);background:var(--bg);border:1px solid rgba(17,17,17,0.1);border-radius:28px;max-width:420px;width:92%;z-index:2001;opacity:0;visibility:hidden;transition:all 0.5s var(--ease-out);box-shadow:0 40px 80px rgba(0,0,0,0.1)}
        .modal.on{opacity:1;visibility:visible;transform:translate(-50%,-50%) scale(1)}
        .m-head{display:flex;justify-content:space-between;align-items:center;padding:1.25rem 1.5rem;border-bottom:1px solid rgba(17,17,17,0.06)}
        .m-head h3{font-size:0.95rem;font-weight:600;color:var(--fg)}
        .m-x{background:rgba(17,17,17,0.05);border:none;width:32px;height:32px;border-radius:10px;color:var(--gray);font-size:1.2rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.3s}
        .m-x:hover{background:rgba(17,17,17,0.1);color:var(--fg)}
        .m-body{padding:1.5rem}
        .m-body p{margin-bottom:0.75rem;font-size:0.8rem;line-height:1.7;color:var(--gray)}
        .m-body strong{color:var(--fg)}
        .m-body a{color:var(--fg);text-decoration:underline}

        /* MOBILE SIDEBAR */
        .mob{display:none;background:none;border:none;cursor:pointer;padding:0.5rem;z-index:1002}
        .mob span{display:block;width:18px;height:1.5px;background:var(--fg);margin:4px 0;transition:all 0.3s var(--ease)}
        
        /* Mobile menu */
        .mobile-menu{
            position:fixed;
            top:0;
            right:-100%;
            width:280px;
            max-width:80vw;
            height:100vh;
            background:var(--bg);
            z-index:1001;
            padding:5rem 2rem 2rem;
            transition:right 0.4s var(--ease);
            box-shadow:-10px 0 40px rgba(0,0,0,0.1);
            display:flex;
            flex-direction:column;
            gap:0.5rem;
        }
        .mobile-menu.open{right:0}
        .mobile-menu a{
            text-decoration:none;
            color:var(--fg);
            font-size:1.1rem;
            font-weight:500;
            padding:1rem 0;
            border-bottom:1px solid rgba(17,17,17,0.06);
            transition:all 0.3s;
        }
        .mobile-menu a:hover{color:var(--gray)}
        .mobile-menu a.nav-cta{
            background:var(--fg);
            color:var(--bg);
            padding:1rem 1.5rem;
            border-radius:100px;
            text-align:center;
            margin-top:1rem;
            border:none;
        }
        .mobile-overlay{
            display:none;
            position:fixed;
            inset:0;
            background:rgba(0,0,0,0.3);
            z-index:1000;
            opacity:0;
            visibility:hidden;
            pointer-events:none;
            transition:all 0.4s;
        }
        .mobile-overlay.open{display:block;opacity:1;visibility:visible;pointer-events:auto}
        
        /* Hamburger animation */
        .mob.open span:nth-child(1){transform:rotate(45deg) translate(4px, 4px)}
        .mob.open span:nth-child(2){opacity:0}
        .mob.open span:nth-child(3){transform:rotate(-45deg) translate(4px, -4px)}

        @media(max-width:900px){
            .feat-grid{grid-template-columns:1fr}
            .feat.c4,.feat.c3,.feat.c2{grid-column:span 1}
            .how-grid{flex-direction:column;max-width:380px}
            .how-card::after{display:none}
        }
        @media(max-width:768px){
            nav{padding:0.7rem}
            .nav-wrap{
                display:grid;
                grid-template-columns:auto 1fr auto;
                align-items:center;
                gap:0.45rem;
                padding:0.48rem 0.5rem 0.48rem 0.7rem;
            }
            .logo{min-width:0}
            .logo span{font-size:0.9rem}
            .mode-toggle{padding:2px;gap:1px}
            .mode-toggle{
                position:static;
                left:auto;
                transform:none;
                justify-self:center;
                width:100%;
                max-width:170px;
                justify-content:center;
            }
            .mode-toggle button{padding:0.34rem 0.62rem;font-size:0.66rem;flex:1}
            .mob{justify-self:end}
            .nav-links{display:none}
            .mob{display:block}
            .hero{padding:6.1rem 1.1rem 1.5rem;min-height:92vh}
            .hero h1{font-size:clamp(2.5rem,16vw,5rem)}
            .sub{margin-bottom:2rem}
            .badge{margin-bottom:1.8rem}
            .input-wrap{max-width:100%}
            .input-row{height:auto}
            .input-box{border-radius:18px}
            .input-inner{border-radius:16px;padding:0.3rem}
            /* Keep >=16px to prevent iOS auto-zoom on focus */
            .input-field{font-size:16px;padding:0.78rem 0.9rem}
            .input-btn{padding:0.7rem 1rem;font-size:0.82rem;border-radius:12px}
            .chips{margin-top:0.9rem;gap:0.4rem}
            .chip{font-size:0.68rem;padding:0.36rem 0.7rem}
            .refresh-btn{
                right:0;
                top:calc(100% + 10px);
                transform:none;
                width:44px;
                height:44px;
                border-radius:12px;
                font-size:1.05rem;
            }
            .refresh-btn:hover{transform:scale(1.04)}
            .refresh-btn:active{transform:scale(0.96)}
            .ans{min-height:160px}
            .decision-table-wrap{max-height:250px}
            .decision-table th{font-size:0.63rem;padding:0.52rem 0.55rem}
            .decision-table td{font-size:0.71rem;padding:0.5rem 0.55rem}
            .decision-table .col-time{font-size:0.66rem}
            .decision-table{min-width:860px}
            .decision-table .dt-col-time{width:138px}
            .decision-table .dt-col-set{width:62px}
            .decision-table .dt-col-option{width:62px}
            .decision-table .dt-col-mode{width:74px}
            .decision-table .dt-col-question{width:auto}
            .decision-table .dt-col-verdict{width:88px}
            .pill{font-size:0.62rem;padding:0.17rem 0.45rem}
            .logos{padding:1.5rem 1rem}
            .features,.how,.connect,.agent-features{padding:4.5rem 1rem}
            .cta{padding:6rem 1rem}
            .sec-head{margin:0 auto 2.5rem}
            .sec-head p{font-size:0.9rem}
            .feat{padding:1.35rem;border-radius:20px}
            .how-card{padding:1.7rem 1.2rem;border-radius:22px}
            .how-num{font-size:3.5rem}
            .mcp-card{padding:1.3rem;border-radius:18px}
            .mcp-card-meta{gap:0.5rem;margin-bottom:1rem}
            .mcp-meta-tag{font-size:0.64rem;padding:0.28rem 0.6rem}
            .code-block{padding:1rem}
            .code-block pre{font-size:0.72rem;line-height:1.55}
            .pg-grid{grid-template-columns:1fr}
            .pg-inline{flex-direction:column}
            .pg-case-row{flex-direction:column;align-items:stretch}
            .pg-select{min-width:0;width:100%}
            .pg-redact-row{align-items:flex-start}
            .pg-assert-row{flex-direction:column;align-items:stretch}
            .pg-assert-template{min-width:0;width:100%}
            .pg-assert-input.path,.pg-assert-input.expected{min-width:0;width:100%}
            .theme-toggle{right:0.8rem;bottom:0.8rem;width:38px;height:38px}
            .foot-inner{flex-direction:column;gap:1.25rem}
            .result{height:auto}
        }
        @media(max-width:430px){
            nav{padding:0.45rem}
            .nav-wrap{
                padding:0.3rem 0.4rem 0.3rem 0.52rem;
                gap:0.32rem;
                min-height:40px;
            }
            .logo-mark,.logo-mark img{width:22px;height:22px}
            .logo span{display:none}
            .mode-toggle{max-width:220px;padding:1px}
            .mode-toggle button{padding:0.24rem 0.45rem;font-size:0.61rem;line-height:1.1}
            .mob{padding:0.35rem}
            .mob span{width:16px;height:1.4px;margin:3.5px 0}
            .hero h1{font-size:clamp(2.2rem,15vw,4.2rem)}
            .sub{font-size:0.96rem}
            .input-btn{padding:0.64rem 0.86rem;font-size:0.78rem}
            .agent-hero{padding:5.25rem 1rem 2.25rem}
            .mcp-card-info h3{font-size:1.05rem}
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div class="grain"></div>
    <div class="glow" id="glow"></div>

    <nav id="nav">
        <div class="nav-wrap">
            <a href="#" class="logo">
                <div class="logo-mark">
                    <img src="https://i.imgur.com/IsBmzxq.png" alt="decide logo">
                </div>
                <span>decide</span>
            </a>
            <div class="mode-toggle" id="modeToggle">
                <button class="active" data-mode="humans" onclick="setMode('humans')">Humans</button>
                <button data-mode="agents" onclick="setMode('agents')">Agents</button>
                <button data-mode="overview" onclick="setMode('overview')">Overview</button>
            </div>
            <div class="nav-links" id="navLinksHuman">
                <a href="#features">Features</a>
                <a href="#" class="nav-signin nav-cta" onclick="event.preventDefault(); openSignIn();">Sign In</a>
            </div>
            <div class="nav-links" id="navLinksAgent" style="display:none">
                <a href="/livedemo#agents">Live demo</a>
                <a href="#pricing">Pricing</a>
                <a href="#mcp-connect">Connect</a>
                <a href="https://github.com/decidefyi/decide" target="_blank">GitHub</a>
                <a href="#" class="nav-signin nav-cta" onclick="event.preventDefault(); openSignIn();">Sign In</a>
            </div>
            <button class="mob" id="mobBtn"><span></span><span></span><span></span></button>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div class="mobile-overlay" id="mobileOverlay"></div>
    <div class="mobile-menu" id="mobileMenu">
        <div id="mobileHumanLinks">
            <a href="#features" class="mobile-link">Features</a>
            <a href="#" class="nav-cta mobile-link" onclick="event.preventDefault(); openSignIn();">Sign In</a>
        </div>
        <div id="mobileAgentLinks" style="display:none">
            <a href="/livedemo#agents" class="mobile-link">Live demo</a>
            <a href="#pricing" class="mobile-link">Pricing</a>
            <a href="#mcp-connect" class="mobile-link">Connect</a>
            <a href="https://github.com/decidefyi/decide" class="mobile-link" target="_blank">GitHub</a>
            <a href="#" class="nav-cta mobile-link nav-signin" onclick="event.preventDefault(); openSignIn();">Sign In</a>
        </div>
    </div>

    <!-- OVERVIEW MODE -->
    <div id="overview-mode">
      <section class="hero">
        <div class="hero-inner">
          <div class="badge"><span class="badge-dot"></span>Decision infrastructure</div>
          <h1>
            <span class="word"><span>Decision API</span></span>
            <span class="word"><span class="serif">for humans + agents.</span></span>
          </h1>
          <p class="sub">Get one clear verdict: yes, no, or tie. Route agent actions to deterministic MCP notaries. Add Krafthaus signals only when ranking subjective choices.</p>
          <div class="input-wrap">
            <div class="cta-row" style="justify-content:center;gap:0.7rem;flex-wrap:wrap;">
              <a class="input-btn" href="#" onclick="event.preventDefault(); setMode('humans'); document.getElementById('q')?.focus();">Run a decision</a>
              <a class="input-btn" href="/livedemo#agents" style="background:transparent;color:var(--fg);border:1px solid rgba(17,17,17,0.12);text-decoration:none;">Open live demo</a>
            </div>
          </div>
        </div>
      </section>

      <section class="features sec-light" id="overview">
        <div class="sec-head">
          <h2>How decide <span class="serif">works</span></h2>
          <p>Decision API resolves ambiguity. MCP notaries execute deterministic actions. Krafthaus is optional and used only for preference-heavy choices.</p>
        </div>
        <div class="feat-grid">
          <div class="feat c3">
            <div class="feat-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12l5 5L20 7"/></svg></div>
            <h3>Decision API (humans)</h3>
            <p>Binary verdicts for direct questions, with tie when options are equivalent.</p>
          </div>
          <div class="feat c3">
            <div class="feat-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3l9 4.5-9 4.5-9-4.5z"/><path d="M3 12l9 4.5 9-4.5"/><path d="M3 17l9 4.5 9-4.5"/></svg></div>
            <h3>Decision API (agents)</h3>
            <p>Structured outputs so agents can gate actions before invoking a notary.</p>
          </div>
          <div class="feat c3">
            <div class="feat-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 7h16M4 12h10M4 17h7"/></svg></div>
            <h3>MCP notaries</h3>
            <p>Refund, cancel, return, and trial checks. Stateless, policy-sourced, deterministic.</p>
          </div>
          <div class="feat c3">
            <div class="feat-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M12 4h9"/><path d="M4 9h16"/><path d="M4 15h8"/></svg></div>
            <h3>Krafthaus (optional)</h3>
            <p>Optional sentiment ranking for best-of-N choices. Notary execution stays deterministic.</p>
          </div>
        </div>
      </section>

      <section class="how sec-light">
        <div class="sec-head"><h2>Flow in <span class="serif">practice</span></h2></div>
        <div class="how-grid">
          <div class="how-card"><div class="how-num">1</div><h3>Ask</h3><p>A human or agent sends a decision request.</p></div>
          <div class="how-card"><div class="how-num">2</div><h3>Resolve</h3><p>Engine returns yes, no, or tie.</p></div>
          <div class="how-card"><div class="how-num">3</div><h3>Execute</h3><p>If action is needed, call the matched notary.</p></div>
        </div>
      </section>
    </div>

    <!-- HUMAN MODE -->
    <div id="human-mode">
    <section class="hero">
        <div class="hero-inner">
            <div class="badge"><span class="badge-dot"></span>Decision API</div>
            <h1>
                <span class="word"><span>Clear</span></span>
                <span class="word"><span class="serif">verdicts.</span></span>
            </h1>
            <p class="sub">When models hedge, decide returns one verdict: yes, no, or tie. No debate loop.</p>
            <div class="input-wrap">
                <div class="input-row">
                    <div class="input-box" id="inputBox">
                        <div class="input-inner" id="inputInner">
                            <input type="text" class="input-field" id="q" placeholder="ship this launch today?" autocomplete="off" maxlength="230">
                            <button class="input-btn" id="btn">decide</button>
                        </div>
                    </div>
                    <button class="refresh-btn" id="refreshBtn" title="Start over">↻</button>
                </div>
                <div class="char-count" id="charCount"></div>
                <div class="decision-status" id="decisionStatus" aria-live="polite"></div>
                <div class="decision-mode-switch" id="decisionModeSwitch" role="tablist" aria-label="Decision input mode">
                    <button class="decision-mode-btn active" type="button" data-decision-mode="single">Single decision</button>
                    <button class="decision-mode-btn" type="button" data-decision-mode="multi">Multi option</button>
                </div>
                <div class="decision-mode-copy" id="decisionModeCopy">Ask one question. We return yes, no, or tie.</div>
                <div class="chips" id="decisionChips">
                    <button class="chip" type="button" data-single="ship this launch today?" data-multi="best launch window: today | next week | next month">ship this launch today?</button>
                    <button class="chip" type="button" data-single="escalate this support ticket?" data-multi="best retention offer: 10% off | 20% off | free month">escalate this support ticket?</button>
                    <button class="chip" type="button" data-single="run this experiment now?" data-multi="best onboarding focus: speed | guidance | personalization">run this experiment now?</button>
                </div>
                <div class="result">
                    <div class="ans" id="ans" aria-live="polite"></div>
                </div>
                <div class="trust-note">High-risk categories are blocked (finance / legal / medical). See Terms &amp; Safety.</div>
            </div>
        </div>
    </section>

    <section class="sec-light" id="api-explainer">
        <div class="bullet-strip">
            <span class="bullet-pill">Input → single verdict</span>
            <span class="bullet-pill">Tie when equivalent</span>
            <span class="bullet-pill">Deterministic rationale</span>
            <span class="bullet-pill">Sentiment optional (off by default)</span>
        </div>
        <div class="code-slab">
<pre>{
  \"endpoint\": \"/api/decide\",
  \"request\": { \"question\": \"ship this launch today?\", \"mode\": \"single\" },
  \"response\": { \"c\": \"yes\", \"v\": \"yes\", \"request_id\": \"abc123\" },
  \"field_map\": { \"c\": \"decision_class\", \"v\": \"decision\" }
}</pre>
        </div>
    </section>

    <div class="logos">
        <div class="logos-track">
            <span>Deterministic outputs</span><span>Tie detection</span><span>Stateless decisions</span><span>Safety filters</span><span>Deterministic outputs</span><span>Tie detection</span><span>Stateless decisions</span><span>Safety filters</span>
        </div>
    </div>

    <section class="features sec-light" id="features">
        <div class="sec-head">
            <h2>Why it <span class="serif">works</span></h2>
            <p>Built for fast choices, clear outputs, and safe defaults.</p>
        </div>
        <div class="feat-grid">
            <div class="feat c4">
                <div class="feat-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg></div>
                <h3>Deterministic Verdict</h3>
                <p>One output for one input: yes, no, or tie.</p>
            </div>
            <div class="feat c2">
                <div class="feat-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg></div>
                <h3>Tie Detection</h3>
                <p>If options are equivalent, decide says tie.</p>
            </div>
            <div class="feat c2">
                <div class="feat-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4l-6 6M17 4l6 6M1 20l6-6M7 20l-6-6"/></svg></div>
                <h3>Clean Context</h3>
                <p>Each decision is stateless, so old chat drift does not leak in.</p>
            </div>
            <div class="feat c2">
                <div class="feat-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 12l2 2 4-4"/></svg></div>
                <h3>Actionable Output</h3>
                <p>Response format is short and easy to route into workflows.</p>
            </div>
            <div class="feat c2">
                <div class="feat-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg></div>
                <h3>Safety Filters</h3>
                <p>Finance, legal, and medical prompts are blocked by policy.</p>
            </div>
        </div>
    </section>

    <section class="how sec-light" id="how">
        <div class="sec-head"><h2>How it <span class="serif">works</span></h2></div>
        <div class="how-grid">
            <div class="how-card"><div class="how-num">1</div><h3>Ask</h3><p>Ask a yes/no question or a multi-option prompt.</p></div>
            <div class="how-card"><div class="how-num">2</div><h3>Resolve</h3><p>Receive one verdict: yes, no, or tie.</p></div>
            <div class="how-card"><div class="how-num">3</div><h3>Act</h3><p>Execute, escalate, or skip with confidence.</p></div>
        </div>
    </section>

    <section class="cta sec-light">
        <div class="cta-inner">
            <h2>Run your next <span class="serif">decision.</span></h2>
            <p>One question. One verdict.</p>
            <a href="#" class="cta-btn" onclick="document.getElementById('q').focus();window.scrollTo({top:0,behavior:'smooth'});return false;">Run decision</a>
        </div>
    </section>
    </div>

    <!-- AGENT MODE -->
    <div id="agent-mode">
    <section class="agent-hero">
        <div class="agent-hero-inner">
            <div class="badge"><span class="badge-dot"></span>MCP Servers</div>
            <h1>Decision tools for <span class="serif">agents.</span></h1>
            <p class="sub">Deterministic MCP servers that give your AI agents clear, auditable answers.</p>
	            <div class="agent-hero-ctas">
	                <a href="#" class="agent-hero-btn primary nav-signin" onclick="event.preventDefault(); openSignIn();">Start for free</a>
                        <a href="/livedemo#agents" class="agent-hero-btn secondary">Open live demo</a>
	            </div>

	            <div class="mcp-catalog">
	                <div class="mcp-card">
	                    <div class="mcp-card-head">
                        <div class="mcp-card-info">
                            <h3>Refund Notary</h3>
                            <span class="mcp-url">refund.decide.fyi</span>
                            <div class="mcp-sync" id="refundSync">Last policy sync: loading…</div>
                        </div>
                        <div class="mcp-card-status"><span class="status-dot"></span> Live</div>
                    </div>
                    <p class="mcp-card-desc">Deterministic refund eligibility checker for US consumer subscriptions. Returns ALLOWED, DENIED, or UNKNOWN based on each vendor's official refund policy window.</p>
                    <div class="mcp-card-meta">
                        <span class="mcp-meta-tag"><svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>64 vendors</span>
                        <span class="mcp-meta-tag"><svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>Stateless</span>
                        <span class="mcp-meta-tag"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>Updated daily</span>
                        <span class="mcp-meta-tag"><svg viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>Free / No auth</span>
                    </div>
                    <div class="mcp-card-actions">
                        <a href="https://refund.decide.fyi" target="_blank" class="mcp-btn mcp-btn-primary">Visit<svg viewBox="0 0 24 24"><path d="M7 17L17 7M17 7H7M17 7v10"/></svg></a>
                        <button class="mcp-btn mcp-btn-secondary" onclick="document.getElementById('mcp-connect').scrollIntoView({behavior:'smooth'})">Connect<svg viewBox="0 0 24 24"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg></button>
                        <a href="https://github.com/decidefyi/decide" target="_blank" class="mcp-btn mcp-btn-secondary">GitHub<svg viewBox="0 0 24 24"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0020 4.77 5.07 5.07 0 0019.91 1S18.73.65 16 2.48a13.38 13.38 0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 005 4.77a5.44 5.44 0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 009 18.13V22"/></svg></a>
                    </div>
                </div>

                <div class="mcp-card">
                    <div class="mcp-card-head">
                        <div class="mcp-card-info">
                            <h3>Cancel Notary</h3>
                            <span class="mcp-url">cancel.decide.fyi</span>
                            <div class="mcp-sync" id="cancelSync">Last policy sync: loading…</div>
                        </div>
                        <div class="mcp-card-status"><span class="status-dot"></span> Live</div>
                    </div>
                    <p class="mcp-card-desc">Cancellation penalty checker for US consumer subscriptions. Returns FREE_CANCEL, PENALTY, or LOCKED based on each vendor's cancellation terms.</p>
                    <div class="mcp-card-meta">
                        <span class="mcp-meta-tag"><svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>64 vendors</span>
                        <span class="mcp-meta-tag"><svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>Stateless</span>
                        <span class="mcp-meta-tag"><svg viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg>ETF detection</span>
                        <span class="mcp-meta-tag"><svg viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>Free / No auth</span>
                    </div>
                    <div class="mcp-card-actions">
                        <a href="https://cancel.decide.fyi" target="_blank" class="mcp-btn mcp-btn-primary">Visit<svg viewBox="0 0 24 24"><path d="M7 17L17 7M17 7H7M17 7v10"/></svg></a>
                        <button class="mcp-btn mcp-btn-secondary" onclick="document.getElementById('mcp-connect').scrollIntoView({behavior:'smooth'})">Connect<svg viewBox="0 0 24 24"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg></button>
                        <a href="https://github.com/decidefyi/decide" target="_blank" class="mcp-btn mcp-btn-secondary">GitHub<svg viewBox="0 0 24 24"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0020 4.77 5.07 5.07 0 0019.91 1S18.73.65 16 2.48a13.38 13.38 0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 005 4.77a5.44 5.44 0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 009 18.13V22"/></svg></a>
                    </div>
                </div>

                <div class="mcp-card">
                    <div class="mcp-card-head">
                        <div class="mcp-card-info">
                            <h3>Return Notary</h3>
                            <span class="mcp-url">return.decide.fyi</span>
                            <div class="mcp-sync" id="returnSync">Last policy sync: loading…</div>
                        </div>
                        <div class="mcp-card-status"><span class="status-dot"></span> Live</div>
                    </div>
                    <p class="mcp-card-desc">Return eligibility checker for US consumer subscriptions. Returns RETURNABLE, EXPIRED, or NON_RETURNABLE with return type (full refund, prorated, credit) and method.</p>
                    <div class="mcp-card-meta">
                        <span class="mcp-meta-tag"><svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>64 vendors</span>
                        <span class="mcp-meta-tag"><svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>Stateless</span>
                        <span class="mcp-meta-tag"><svg viewBox="0 0 24 24"><path d="M1 4v6h6M23 20v-6h-6"/><path d="M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 013.51 15"/></svg>Return method</span>
                        <span class="mcp-meta-tag"><svg viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>Free / No auth</span>
                    </div>
                    <div class="mcp-card-actions">
                        <a href="https://return.decide.fyi" target="_blank" class="mcp-btn mcp-btn-primary">Visit<svg viewBox="0 0 24 24"><path d="M7 17L17 7M17 7H7M17 7v10"/></svg></a>
                        <button class="mcp-btn mcp-btn-secondary" onclick="document.getElementById('mcp-connect').scrollIntoView({behavior:'smooth'})">Connect<svg viewBox="0 0 24 24"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg></button>
                        <a href="https://github.com/decidefyi/decide" target="_blank" class="mcp-btn mcp-btn-secondary">GitHub<svg viewBox="0 0 24 24"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0020 4.77 5.07 5.07 0 0019.91 1S18.73.65 16 2.48a13.38 13.38 0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 005 4.77a5.44 5.44 0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 009 18.13V22"/></svg></a>
                    </div>
                </div>

                <div class="mcp-card">
                    <div class="mcp-card-head">
                        <div class="mcp-card-info">
                            <h3>Trial Notary</h3>
                            <span class="mcp-url">trial.decide.fyi</span>
                            <div class="mcp-sync" id="trialSync">Last policy sync: loading…</div>
                        </div>
                        <div class="mcp-card-status"><span class="status-dot"></span> Live</div>
                    </div>
                    <p class="mcp-card-desc">Free trial availability and terms checker for US consumer subscriptions. Returns TRIAL_AVAILABLE or NO_TRIAL with trial length, card requirement, and auto-conversion status.</p>
                    <div class="mcp-card-meta">
                        <span class="mcp-meta-tag"><svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>64 vendors</span>
                        <span class="mcp-meta-tag"><svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>Stateless</span>
                        <span class="mcp-meta-tag"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>Card &amp; auto-convert</span>
                        <span class="mcp-meta-tag"><svg viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>Free / No auth</span>
                    </div>
                    <div class="mcp-card-actions">
                        <a href="https://trial.decide.fyi" target="_blank" class="mcp-btn mcp-btn-primary">Visit<svg viewBox="0 0 24 24"><path d="M7 17L17 7M17 7H7M17 7v10"/></svg></a>
                        <button class="mcp-btn mcp-btn-secondary" onclick="document.getElementById('mcp-connect').scrollIntoView({behavior:'smooth'})">Connect<svg viewBox="0 0 24 24"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg></button>
                        <a href="https://github.com/decidefyi/decide" target="_blank" class="mcp-btn mcp-btn-secondary">GitHub<svg viewBox="0 0 24 24"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0020 4.77 5.07 5.07 0 0019.91 1S18.73.65 16 2.48a13.38 13.38 0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 005 4.77a5.44 5.44 0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 009 18.13V22"/></svg></a>
                    </div>
	                </div>
	            </div>
	            <div class="vendor-inline-note">
	                Missing a vendor? <a href="#" class="vendor-request-link" onclick="event.preventDefault(); openVendorRequest('agents');">Request a vendor</a>
	            </div>
	        </div>
	    </section>

    <section class="connect" id="mcp-playground">
	        <div class="connect-inner">
	            <div class="pg-head">
                <h2>Live demo + audit trail</h2>
	                <span class="pg-trust-badge" id="pgTrustBadge">Trust Suite: not run</span>
	            </div>
	            <p>Run real MCP calls, inspect responses, and keep a scoped trail of recent runs.</p>
	            <div class="playground-stack">
	                <div class="playground-split">
	                    <div class="playground-card">
                        <div class="pg-section-title">Run Request</div>
                        <div class="pg-demo-strip">
                            <button class="pg-demo-pill" id="pgDemoRefundBtn" type="button">Demo: refund ALLOWED</button>
                            <button class="pg-demo-pill" id="pgDemoCancelBtn" type="button">Demo: cancel PENALTY</button>
                            <button class="pg-demo-pill" id="pgDemoTrustBtn" type="button">Demo: trust suite</button>
                        </div>
                        <div class="pg-grid">
                            <div class="pg-field">
                                <label for="pgNotary">Notary</label>
                                <select id="pgNotary">
                                    <option value="refund">Refund Notary</option>
                                    <option value="cancel">Cancel Notary</option>
                                    <option value="return">Return Notary</option>
                                    <option value="trial">Trial Notary</option>
                                </select>
                            </div>
                            <div class="pg-field">
                                <label for="pgMode">Mode</label>
                                <select id="pgMode">
                                    <option value="mcp">MCP (JSON-RPC tools/call)</option>
                                    <option value="rest">REST</option>
                                </select>
                            </div>
                            <div class="pg-field">
                                <label for="pgPreset">Preset</label>
                                <div class="pg-inline pg-preset-inline">
                                    <select id="pgPreset"></select>
                                    <button class="pg-btn secondary pg-mini" id="pgLoadPresetBtn" type="button">Load preset</button>
                                </div>
                            </div>
                            <div class="pg-field" style="grid-column:1/-1">
                                <label for="pgPayload">Request payload (JSON)</label>
                                <textarea id="pgPayload"></textarea>
                            </div>
                        </div>
                        <div class="pg-actions pg-actions-primary">
                            <button class="pg-btn primary" id="pgRunBtn" type="button">Run request</button>
                            <button class="pg-btn secondary" id="pgCopyRespBtn" type="button">Copy response</button>
                            <button class="pg-btn secondary" id="pgShareRunBtn" type="button">Copy share link</button>
                        </div>
                        <details class="pg-advanced" id="pgAdvancedTools">
                            <summary>Advanced tools</summary>
                            <div class="pg-advanced-body">
                                <div class="pg-actions pg-actions-secondary">
                                    <button class="pg-btn secondary" id="pgExportBtn" type="button">Export CSV</button>
                                    <button class="pg-btn secondary" id="pgClearTrailBtn" type="button">Clear trail</button>
                                    <button class="pg-btn secondary" id="pgRunTrustSuiteBtn" type="button">Run trust suite</button>
                                </div>
                                <div class="pg-case-row">
                                    <button class="pg-btn secondary" id="pgSaveCaseBtn" type="button">Save case</button>
                                    <select class="pg-select" id="pgSavedCases">
                                        <option value="">No saved cases</option>
                                    </select>
                                    <button class="pg-btn secondary" id="pgLoadCaseBtn" type="button">Load case</button>
                                    <button class="pg-btn secondary" id="pgDeleteCaseBtn" type="button">Delete case</button>
                                    <button class="pg-btn secondary" id="pgRunSuiteBtn" type="button">Run saved suite</button>
                                </div>
                                <div class="pg-monitor-row">
                                    <select class="pg-select" id="pgMonitorInterval">
                                        <option value="1">Monitor every 1 hour</option>
                                        <option value="6">Monitor every 6 hours</option>
                                        <option value="24" selected>Monitor every 24 hours</option>
                                    </select>
                                    <button class="pg-btn secondary" id="pgSaveMonitorBtn" type="button">Save as monitor</button>
                                    <button class="pg-btn secondary" id="pgRunMonitorsBtn" type="button">Run due monitors</button>
                                </div>
                                <div class="pg-note" id="pgMonitorSummary">No monitors yet.</div>
                                <div class="pg-monitor-list" id="pgMonitorList"></div>
	                                <div class="pg-vendor-requests">
	                                    <div class="pg-vendor-head">
	                                        <span class="pg-vendor-title">Vendor requests (network)</span>
	                                        <button class="pg-vendor-refresh" id="pgVendorRefreshBtn" type="button">Refresh</button>
	                                    </div>
	                                    <ul class="pg-vendor-list" id="pgVendorNetworkList"></ul>
	                                    <div class="pg-note" style="margin-top:0.5rem">
	                                        Missing a vendor? <a href="#" class="vendor-request-link" onclick="event.preventDefault(); openVendorRequest('playground');">Request a vendor</a>
	                                    </div>
	                                </div>
	                                <div class="pg-redact-row" id="pgRedactRow">
	                                    <span class="pg-redact-title">Share redaction:</span>
	                                    <label class="pg-redact-label"><input type="checkbox" data-redact-field="vendor" checked>vendor</label>
                                    <label class="pg-redact-label"><input type="checkbox" data-redact-field="region">region</label>
                                    <label class="pg-redact-label"><input type="checkbox" data-redact-field="plan">plan</label>
                                    <label class="pg-redact-label"><input type="checkbox" data-redact-field="days_since_purchase">days</label>
                                    <label class="pg-redact-label"><input type="checkbox" data-redact-field="requestId" checked>request id</label>
                                </div>
                            </div>
                        </details>
                        <div class="pg-note" id="pgScopeNote">Audit scope: loading…</div>
                    </div>

                    <div class="playground-card">
                        <div class="pg-section-title">Assertions</div>
                        <div class="pg-assert-row">
                            <select class="pg-assert-input pg-assert-template" id="pgAssertTemplate">
                                <option value="">Assertion template</option>
                            </select>
                            <button class="pg-btn secondary" id="pgUseAssertTemplateBtn" type="button">Use template</button>
                            <input class="pg-assert-input path" id="pgAssertPath" type="text" placeholder="assert path (e.g. result.verdict or status)">
                            <select class="pg-assert-input" id="pgAssertOp">
                                <option value="eq">= equals</option>
                                <option value="neq">!= not equal</option>
                                <option value="contains">contains</option>
                                <option value="gt">&gt; greater than</option>
                                <option value="lt">&lt; less than</option>
                                <option value="exists">exists</option>
                            </select>
                            <input class="pg-assert-input expected" id="pgAssertExpected" type="text" placeholder="expected value">
                            <button class="pg-btn secondary" id="pgAddAssertBtn" type="button">Add assertion</button>
                        </div>
                        <div class="pg-assert-list" id="pgAssertList"></div>
                    </div>
                </div>

                <div class="output-grid">
                    <div class="code-block">
                        <div class="code-block-label"><span>Latest response</span></div>
                        <pre id="pgResponse">Run a request to see output.</pre>
                        <div class="pg-provenance" id="pgProvenance" hidden></div>
                    </div>
                    <div class="code-block">
                        <div class="code-block-label"><span>Diff vs previous response</span></div>
                        <pre id="pgDiff">Run twice to compare output changes.</pre>
                    </div>
                </div>

                <div class="playground-card">
                    <div class="pg-section-title">Audit Trail</div>
                    <div class="trail-wrap">
                        <div class="trail-controls">
                            <select class="trail-filter" id="pgFilterStatus">
                                <option value="all">All statuses</option>
                                <option value="success">Success (2xx)</option>
                                <option value="client">Client error (4xx)</option>
                                <option value="server">Server error (5xx)</option>
                                <option value="network">Network / failed</option>
                            </select>
                            <select class="trail-filter" id="pgFilterNotary">
                                <option value="all">All notaries</option>
                                <option value="refund">Refund</option>
                                <option value="cancel">Cancel</option>
                                <option value="return">Return</option>
                                <option value="trial">Trial</option>
                            </select>
                            <select class="trail-filter" id="pgFilterMode">
                                <option value="all">All modes</option>
                                <option value="mcp">MCP</option>
                                <option value="rest">REST</option>
                            </select>
                            <select class="trail-filter" id="pgFilterLatency">
                                <option value="all">Any latency</option>
                                <option value="slow">Slow (&gt; 500ms)</option>
                            </select>
                        </div>
                        <div class="trail-meta" id="pgTrailMeta">Showing 0 of 0 runs.</div>
                        <table class="trail-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Notary</th>
                                    <th>Mode</th>
                                    <th>Status</th>
                                    <th>Assert</th>
                                    <th>Latency</th>
                                    <th>Req hash</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="pgTrailBody"></tbody>
                        </table>
                        <div class="trail-empty" id="pgTrailEmpty">No runs yet. Run your first request.</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="connect" id="mcp-connect">
        <div class="connect-inner">
            <h2>Connect your agent</h2>
            <p>Add decide notaries to any MCP-compatible client in seconds.</p>

            <div class="install-badges">
                <a href="cursor://anysphere.cursor-deeplink/mcp/install?name=refund-decide&config=eyJ1cmwiOiAiaHR0cHM6Ly9yZWZ1bmQuZGVjaWRlLmZ5aS9hcGkvbWNwIn0=" class="install-badge" title="Add Refund Notary to Cursor"><img src="https://cursor.com/deeplink/mcp-install-dark.png" alt="Add to Cursor" height="32"></a>
                <a href="https://insiders.vscode.dev/redirect/mcp/install?name=refund-decide&config=%7B%22type%22%3A%20%22http%22%2C%20%22url%22%3A%20%22https%3A//refund.decide.fyi/api/mcp%22%7D" class="install-badge" title="Add Refund Notary to VS Code"><img src="https://fastmcp.me/badges/vscode_dark.svg" alt="Add to VS Code" height="32"></a>
                <a href="#" class="install-badge" onclick="event.preventDefault();document.querySelector('.code-block .code-copy').click();alert('JSON config copied! Paste into your Claude Desktop MCP settings.')" title="Copy config for Claude Desktop"><img src="https://fastmcp.me/badges/claude_dark.svg" alt="Add to Claude" height="32"></a>
                <a href="#" class="install-badge" onclick="event.preventDefault();document.querySelector('.code-block .code-copy').click();alert('JSON config copied! Paste into ChatGPT Settings → Connectors → Developer mode.')" title="Copy config for ChatGPT"><img src="https://fastmcp.me/badges/chatgpt_dark.svg" alt="Add to ChatGPT" height="32"></a>
                <a href="#" class="install-badge" onclick="event.preventDefault();document.querySelector('.code-block .code-copy').click();alert('JSON config copied! Paste into your Codex MCP settings.')" title="Copy config for Codex"><img src="https://fastmcp.me/badges/codex_dark.svg" alt="Add to Codex" height="32"></a>
                <a href="#" class="install-badge" onclick="event.preventDefault();document.querySelector('.code-block .code-copy').click();alert('JSON config copied! Paste into your Gemini MCP settings.')" title="Copy config for Gemini"><img src="https://fastmcp.me/badges/gemini_dark.svg" alt="Add to Gemini" height="32"></a>
            </div>

            <div class="code-block">
                <div class="code-block-label"><span>Claude Desktop / Cursor / Windsurf</span><button class="code-copy" onclick="copyCode(this)">Copy</button></div>
<pre>{
  <span class="s">"mcpServers"</span>: {
    <span class="s">"refund-decide"</span>: {
      <span class="s">"url"</span>: <span class="s">"https://refund.decide.fyi/api/mcp"</span>
    },
    <span class="s">"cancel-decide"</span>: {
      <span class="s">"url"</span>: <span class="s">"https://cancel.decide.fyi/api/mcp"</span>
    },
    <span class="s">"return-decide"</span>: {
      <span class="s">"url"</span>: <span class="s">"https://return.decide.fyi/api/mcp"</span>
    },
    <span class="s">"trial-decide"</span>: {
      <span class="s">"url"</span>: <span class="s">"https://trial.decide.fyi/api/mcp"</span>
    }
  }
}</pre>
            </div>

            <div class="code-block">
                <div class="code-block-label"><span>JSON-RPC &mdash; tools/call</span><button class="code-copy" onclick="copyCode(this)">Copy</button></div>
<pre>curl -X POST https://refund.decide.fyi/api/mcp \
  -H <span class="s">"Content-Type: application/json"</span> \
  -d <span class="s">'{
    "jsonrpc": "2.0",
    "id": 1,
    "method": "tools/call",
    "params": {
      "name": "refund_eligibility",
      "arguments": {
        "vendor": "adobe",
        "days_since_purchase": 12,
        "region": "US",
        "plan": "individual"
      }
    }
  }'</span></pre>
            </div>

            <div class="code-block">
                <div class="code-block-label"><span>REST API</span><button class="code-copy" onclick="copyCode(this)">Copy</button></div>
<pre>curl -X POST https://refund.decide.fyi/api/v1/refund/eligibility \
  -H <span class="s">"Content-Type: application/json"</span> \
  -d <span class="s">'{"vendor":"spotify","days_since_purchase":5,"region":"US","plan":"individual"}'</span></pre>
            </div>
        </div>
    </section>

    <section class="pricing sec-light" id="pricing">
        <div class="sec-head">
            <h2>Simple <span class="serif">pricing</span></h2>
            <p>Start free, then upgrade when your team needs higher volume and workflows.</p>
        </div>
		        <div class="pricing-grid">
            <div class="price-card">
                <div class="price-tier">Starter</div>
                <div class="price-amt">$0 <span>/ forever</span></div>
                <div class="price-list">
                    <div>4 notaries + live demo</div>
                    <div>Basic audit trail + trust suite</div>
                    <div>Best for evaluation and solo builds</div>
                </div>
                <a class="price-btn" href="/livedemo#agents" data-track="pricing_starter_cta">Use live demo</a>
            </div>
	            <div class="price-card featured">
	                <div class="price-tier">Pro</div>
	                <div class="price-amt">$49 <span>/ month</span></div>
	                <div class="price-list">
	                    <div>Higher request limits</div>
	                    <div>Saved cases + monitor workflows</div>
	                    <div>Commercial usage + exports</div>
	                </div>
	                <a class="price-btn" href="#" onclick="event.preventDefault(); openPilotIntake();">Start pilot</a>
	            </div>
            <div class="price-card">
                <div class="price-tier">Enterprise</div>
                <div class="price-amt">Custom <span>/ contract</span></div>
                <div class="price-list">
                    <div>Custom limits + usage plans</div>
                    <div>Custom policy packs</div>
                    <div>Security questionnaire + invoicing</div>
                </div>
	                <a class="price-btn" href="mailto:decidefyi@gmail.com?subject=decide%20Enterprise%20inquiry&body=Hi%20decide%20team%2C%0A%0ACompany%3A%0AUse%20case%3A%0AExpected%20calls%2Fmo%3A%0AMust-have%20vendors%3A%0ASecurity%2FSSO%20needs%3A%0ATimeline%3A%0A%0AThanks!" data-track="pricing_enterprise_cta">Talk to sales</a>
	            </div>
	        </div>
            <p class="pricing-note">Support is async and best-effort on Starter and Pro. No SLA outside Enterprise contracts.</p>
	    </section>

    <section class="agent-features sec-light">
        <div class="sec-head">
            <h2>Built for <span class="serif">agents</span></h2>
            <p>No API keys. No databases. No side effects.</p>
        </div>
        <div class="agent-feat-grid">
            <div class="agent-feat">
                <h3>Deterministic</h3>
                <p>Same input, same output. Every time. Fully auditable decisions your agent can cite.</p>
            </div>
            <div class="agent-feat">
                <h3>Stateless</h3>
                <p>No sessions, no tokens, no stored data. Pure function over HTTP.</p>
            </div>
            <div class="agent-feat">
                <h3>MCP Native</h3>
                <p>JSON-RPC 2.0 over HTTP POST. Works with Claude Desktop, Cursor, and any MCP client.</p>
            </div>
            <div class="agent-feat">
                <h3>64 Vendors</h3>
                <p>Adobe, Netflix, Spotify, Microsoft 365, and 60 more. Updated daily via automated checks.</p>
            </div>
            <div class="agent-feat">
                <h3>Zero Config</h3>
                <p>No API keys, no auth, no sign-up. Point your agent at the endpoint and go.</p>
            </div>
            <div class="agent-feat">
                <h3>Open Source</h3>
                <p>Full rules, policy sources, and server code on GitHub. Verify everything.</p>
            </div>
        </div>
    </section>

    <section class="cta sec-light">
        <div class="cta-inner">
            <h2>Ship <span class="serif">decisions.</span></h2>
            <p>Give your agents the tools to stop hedging.</p>
            <a href="https://github.com/decidefyi/decide" target="_blank" class="cta-btn">View on GitHub<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7 17L17 7M17 7H7M17 7v10"/></svg></a>
        </div>
    </section>
    </div>

    <footer>
        <div class="foot-inner">
            <div class="foot-logo">
                <div class="logo-mark">
                    <img src="https://i.imgur.com/IsBmzxq.png" alt="decide logo">
                </div>
                <span>decide</span>
            </div>
            <div class="foot-links">
                <a href="#" onclick="openM('privacy');return false">Privacy</a>
                <a href="#" onclick="openM('terms');return false">Terms</a>
                <a href="#" onclick="openM('contact');return false">Contact</a>
                <a href="#" onclick="openM('api');return false">API</a>
            </div>
            <div class="foot-x"><a href="https://x.com/decidefyi" target="_blank"><svg viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a></div>
        </div>
    </footer>

    <div class="m-bg" id="mbg" onclick="closeM()"></div>
    <div class="modal" id="privacy"><div class="m-head"><h3>Privacy Policy</h3><button class="m-x" onclick="closeM()">×</button></div><div class="m-body"><p><strong>Last updated:</strong> February 2026</p><p>decide provides consumer decision tools for humans and AI agents, including MCP notaries and a live demo with audit trail.</p><p><strong>What we process:</strong> request inputs and outputs needed to run your call. Local demo history, saved cases, and assertions are stored in your browser unless you use authenticated account features.</p><p><strong>What we don't do:</strong> we do not sell personal data and we do not use your prompts to train public models.</p><p><strong>Operational logs:</strong> we may keep service logs (for uptime, abuse prevention, and debugging) with limited metadata such as timestamp, route, status, latency, and hashed request identifiers.</p><p><strong>Questions?</strong> Email <a href="mailto:decidefyi@gmail.com">decidefyi@gmail.com</a>.</p></div></div>
    <div class="modal" id="terms"><div class="m-head"><h3>Terms of Service</h3><button class="m-x" onclick="closeM()">×</button></div><div class="m-body"><p><strong>Last updated:</strong> February 2026</p><p><strong>Service scope:</strong> decide offers decision support tools (human yes/no flows, MCP notaries, live demo, and audit trail).</p><p><strong>No professional advice:</strong> outputs are informational and may be incomplete. They are not financial, legal, or medical advice.</p><p><strong>Safety policy:</strong> certain high-risk prompts may be blocked (for example financial/legal/medical asks) and the UI will return an explanatory message.</p><p><strong>Your responsibility:</strong> you are responsible for downstream decisions and integrations built on top of decide responses.</p><p><strong>Availability:</strong> features may change, and uptime is best-effort while the platform evolves.</p></div></div>
    <div class="modal" id="api"><div class="m-head"><h3>Platform & API</h3><button class="m-x" onclick="closeM()">×</button></div><div class="m-body"><p><strong>What you can use today</strong></p><p>• MCP notaries: refund, cancel, return, and trial<br>• REST endpoints for the same deterministic policy checks<br>• Live demo + audit trail for testing, assertions, diffs, and shareable snapshots</p><p><strong>Best for</strong></p><p>• Agent workflows that need deterministic policy answers<br>• QA and regression checks with assertion templates<br>• Teams that need reproducible run history and troubleshooting context</p><p><strong>Integration help:</strong> contact <a href="mailto:decidefyi@gmail.com">decidefyi@gmail.com</a>.</p></div></div>
    <div class="modal" id="pilot"><div class="m-head"><h3>Pro pilot intake</h3><button class="m-x" onclick="closeM()">×</button></div><div class="m-body">
        <p class="pilot-hint">Answer 4 quick questions and I'll reply with a Pro pilot link + suggested setup. This keeps support async and lightweight.</p>
        <form class="pilot-form" id="pilotForm">
            <div>
                <label for="pilotUseCase">What are you building?</label>
                <textarea id="pilotUseCase" placeholder="e.g. support agent that classifies refund eligibility + produces customer-ready replies"></textarea>
            </div>
            <div>
                <label for="pilotVolume">Expected calls / month</label>
                <input id="pilotVolume" type="text" placeholder="e.g. 5k/mo">
            </div>
            <div>
                <label for="pilotVendors">Must-have vendors</label>
                <input id="pilotVendors" type="text" placeholder="e.g. adobe, netflix, spotify">
            </div>
            <div>
                <label for="pilotEmail">Your email (optional)</label>
                <input id="pilotEmail" type="email" placeholder="you@company.com">
            </div>
            <div class="pilot-actions">
                <button class="cta-btn" type="submit">Email me</button>
                <button class="ghost-btn" type="button" id="pilotCopyBtn">Copy message</button>
                <span class="pilot-status" id="pilotStatus"></span>
            </div>
        </form>
    </div></div>
    <div class="modal" id="contact"><div class="m-head"><h3>Contact</h3><button class="m-x" onclick="closeM()">×</button></div><div class="m-body"><p>For product feedback, integrations, or partnership requests:</p><p>• X: <a href="https://x.com/decidefyi" target="_blank">@decidefyi</a><br>• Email: <a href="mailto:decidefyi@gmail.com">decidefyi@gmail.com</a></p><p>If you're sharing a demo issue, include your run snapshot link so we can debug quickly.</p></div></div>
    <div class="modal" id="vendor-request">
        <div class="m-head">
            <h3>Request a vendor</h3>
            <button class="m-x" onclick="closeM()">×</button>
        </div>
        <div class="m-body">
            <form id="vendorRequestForm" class="vr-form">
                <input type="hidden" id="vrSource" value="unknown">
                <div class="vr-field">
                    <label for="vrVendor">Vendor name *</label>
                    <input id="vrVendor" type="text" required placeholder="e.g. Notion">
                </div>
                <div class="vr-field">
                    <label for="vrPolicyUrl">Policy URL (optional)</label>
                    <input id="vrPolicyUrl" type="url" placeholder="https://...">
                </div>
                <div class="vr-field">
                    <label for="vrUseCase">Use case (optional)</label>
                    <textarea id="vrUseCase" placeholder="How you'd use this vendor in your workflow"></textarea>
                </div>
                <div class="vr-field">
                    <label for="vrEmail">Email (optional)</label>
                    <input id="vrEmail" type="email" placeholder="you@company.com">
                </div>
                <div class="vr-actions">
                    <button class="vr-btn primary" id="vrSubmitBtn" type="submit">Submit request</button>
                    <button class="vr-btn secondary" id="vrMailtoBtn" type="button">Email instead</button>
                </div>
                <div class="vr-note">We prioritize vendors based on request volume + integration demand.</div>
                <div class="vr-status" id="vrStatus"></div>
                <div class="vr-top">
                    Top requested (this browser):
                    <ul class="vr-top-list" id="vrTopList"></ul>
                </div>
            </form>
        </div>
    </div>

    <!-- Theme toggle (floating) -->
    <button class="theme-toggle" id="themeToggle" title="Toggle theme" aria-label="Toggle theme">
        <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
        <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
    </button>

    <script>
        // Canvas gradient mesh - light theme
        const canvas=document.getElementById('canvas'),ctx=canvas.getContext('2d');
        let w,h,particles=[];
        function resize(){w=canvas.width=innerWidth;h=canvas.height=innerHeight}
        resize();
        window.addEventListener('resize',resize);

        class Particle{
            constructor(){this.reset()}
            reset(){
                this.x=Math.random()*w;
                this.y=Math.random()*h;
                this.vx=(Math.random()-0.5)*0.3;
                this.vy=(Math.random()-0.5)*0.3;
                this.r=Math.random()*300+200;
            }
            update(){
                this.x+=this.vx;this.y+=this.vy;
                if(this.x<-this.r||this.x>w+this.r||this.y<-this.r||this.y>h+this.r)this.reset();
            }
            draw(){
                const g=ctx.createRadialGradient(this.x,this.y,0,this.x,this.y,this.r);
                const c=window._particleDark?'rgba(245,245,245,0.015)':'rgba(17,17,17,0.015)';
                g.addColorStop(0,c);
                g.addColorStop(1,'transparent');
                ctx.fillStyle=g;
                ctx.beginPath();
                ctx.arc(this.x,this.y,this.r,0,Math.PI*2);
                ctx.fill();
            }
        }
        for(let i=0;i<4;i++)particles.push(new Particle());
        function animate(){
            ctx.clearRect(0,0,w,h);
            particles.forEach(p=>{p.update();p.draw()});
            requestAnimationFrame(animate);
        }
        animate();

        // Cursor glow
        const glow=document.getElementById('glow');
        document.addEventListener('mousemove',e=>{glow.style.left=e.clientX+'px';glow.style.top=e.clientY+'px'});

        // Nav scroll
        window.addEventListener('scroll',()=>document.getElementById('nav').classList.toggle('scrolled',scrollY>60));

        // Mobile menu
        const mobBtn = document.getElementById('mobBtn');
        const mobileMenu = document.getElementById('mobileMenu');
        const mobileOverlay = document.getElementById('mobileOverlay');
        
        function toggleMobileMenu() {
            mobileOverlay.style.display = '';
            mobileOverlay.style.pointerEvents = '';
            mobBtn.classList.toggle('open');
            mobileMenu.classList.toggle('open');
            mobileOverlay.classList.toggle('open');
            document.body.style.overflow = mobileMenu.classList.contains('open') ? 'hidden' : '';
        }
        
        function closeMobileMenu() {
            mobBtn.classList.remove('open');
            mobileMenu.classList.remove('open');
            mobileOverlay.classList.remove('open');
            mobileOverlay.style.display = 'none';
            mobileOverlay.style.pointerEvents = 'none';
            document.body.style.overflow = '';
        }
        
        mobBtn.addEventListener('click', toggleMobileMenu);
        mobileOverlay.addEventListener('click', closeMobileMenu);
        
        // Close mobile menu when clicking links
        document.querySelectorAll('.mobile-menu .mobile-link').forEach(link => {
            link.addEventListener('click', (e) => {
                // Don't close immediately for sign in (it opens a modal)
                if (!link.classList.contains('nav-cta')) {
                    closeMobileMenu();
                }
            });
        });

	        // Modal
	        function openM(id){const mbg=document.getElementById('mbg');mbg.style.display='';mbg.style.pointerEvents='';mbg.classList.add('on');document.getElementById(id).classList.add('on');document.body.style.overflow='hidden'}
	        function closeM(){const mbg=document.getElementById('mbg');mbg.classList.remove('on');mbg.style.display='none';mbg.style.pointerEvents='none';document.querySelectorAll('.modal').forEach(m=>m.classList.remove('on'));document.body.style.overflow=''}
	        document.addEventListener('keydown',e=>{if(e.key==='Escape')closeM()});

	        // Pro pilot intake (mailto-based: zero backend / zero billing integration needed)
	        const pilotForm = document.getElementById('pilotForm');
	        const pilotUseCase = document.getElementById('pilotUseCase');
	        const pilotVolume = document.getElementById('pilotVolume');
	        const pilotVendors = document.getElementById('pilotVendors');
	        const pilotEmail = document.getElementById('pilotEmail');
	        const pilotStatus = document.getElementById('pilotStatus');
	        const pilotCopyBtn = document.getElementById('pilotCopyBtn');

	        function buildPilotMessage() {
	            const useCase = (pilotUseCase?.value || '').trim();
	            const volume = (pilotVolume?.value || '').trim();
	            const vendors = (pilotVendors?.value || '').trim();
	            const email = (pilotEmail?.value || '').trim();
	            return [
	                'Hi decide team,',
	                '',
	                `What I'm building: ${useCase || '(fill in)'}`,
	                `Expected calls/month: ${volume || '(fill in)'}`,
	                `Must-have vendors: ${vendors || '(fill in)'}`,
	                `Contact email: ${email || '(optional)'}`,
	                '',
	                'Please send a Pro pilot link and any recommended setup.',
	                '',
	                'Thanks!'
	            ].join('\\n');
	        }

	        function openPilotIntake() {
	            trackEvent('pricing_pro_cta', { source: 'pilot_modal' });
	            openM('pilot');
	            setTimeout(() => { pilotUseCase?.focus(); }, 50);
	        }

	        function openPilotEmail() {
	            const subject = encodeURIComponent('decide Pro pilot');
	            const body = encodeURIComponent(buildPilotMessage());
	            window.location.href = `mailto:decidefyi@gmail.com?subject=${subject}&body=${body}`;
	        }

	        pilotForm?.addEventListener('submit', (event) => {
	            event.preventDefault();
	            pilotStatus.textContent = 'Opening email…';
	            try { openPilotEmail(); } finally { setTimeout(() => { pilotStatus.textContent = ''; }, 1500); }
	        });

	        pilotCopyBtn?.addEventListener('click', async () => {
	            try {
	                await navigator.clipboard.writeText(buildPilotMessage());
	                pilotStatus.textContent = 'Copied.';
	            } catch {
	                pilotStatus.textContent = 'Copy failed.';
	            } finally {
	                setTimeout(() => { pilotStatus.textContent = ''; }, 1500);
	            }
	        });

	        // Vendor request flow
	        const vrForm = document.getElementById('vendorRequestForm');
	        const vrSource = document.getElementById('vrSource');
	        const vrVendor = document.getElementById('vrVendor');
        const vrPolicyUrl = document.getElementById('vrPolicyUrl');
        const vrUseCase = document.getElementById('vrUseCase');
        const vrEmail = document.getElementById('vrEmail');
        const vrStatus = document.getElementById('vrStatus');
        const vrSubmitBtn = document.getElementById('vrSubmitBtn');
        const vrMailtoBtn = document.getElementById('vrMailtoBtn');
        const vrTopList = document.getElementById('vrTopList');

        function getVendorRequestStoreKey() {
            const uid = window.Clerk?.user?.id;
            return uid ? `decide_vendor_requests_${uid}` : 'decide_vendor_requests_guest';
        }

        function loadVendorRequests() {
            try { return JSON.parse(localStorage.getItem(getVendorRequestStoreKey()) || '{}'); } catch { return {}; }
        }

        function saveVendorRequests(data) {
            localStorage.setItem(getVendorRequestStoreKey(), JSON.stringify(data));
        }

        function renderTopVendorRequests() {
            if (!vrTopList) return;
            const data = loadVendorRequests();
            const top = Object.entries(data).sort((a, b) => b[1] - a[1]).slice(0, 5);
            vrTopList.innerHTML = '';
            if (!top.length) {
                const li = document.createElement('li');
                li.textContent = 'No requests yet';
                vrTopList.appendChild(li);
                return;
            }
            top.forEach(([name, count]) => {
                const li = document.createElement('li');
                li.textContent = `${name} (${count})`;
                vrTopList.appendChild(li);
            });
        }

        function buildVendorRequestMailto() {
            const vendor = (vrVendor?.value || '').trim();
            const policyUrl = (vrPolicyUrl?.value || '').trim();
            const useCase = (vrUseCase?.value || '').trim();
            const email = (vrEmail?.value || '').trim();
            const source = (vrSource?.value || 'unknown').trim();
            const lines = [
                `Vendor: ${vendor || '(not provided)'}`,
                `Policy URL: ${policyUrl || '(not provided)'}`,
                `Use case: ${useCase || '(not provided)'}`,
                `Email: ${email || '(not provided)'}`,
                `Source: ${source}`
            ];
            return `mailto:decidefyi@gmail.com?subject=${encodeURIComponent(`Vendor request: ${vendor || 'unknown'}`)}&body=${encodeURIComponent(lines.join('\n'))}`;
        }

        async function submitVendorRequest(event) {
            event?.preventDefault();
            if (!vrVendor?.value.trim()) {
                vrStatus.textContent = 'Vendor name is required.';
                return;
            }
            vrSubmitBtn.disabled = true;
            vrStatus.textContent = 'Submitting...';

            const vendor = vrVendor.value.trim();
            const payload = {
                event: 'vendor_request',
                props: {
                    vendor,
                    policy_url: (vrPolicyUrl.value || '').trim(),
                    use_case: (vrUseCase.value || '').trim(),
                    email: (vrEmail.value || '').trim(),
                    source: (vrSource.value || 'unknown').trim()
                }
            };

            try {
                const res = await fetch('/api/track', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload),
                    keepalive: true
                });
                if (!res.ok) throw new Error(`track ${res.status}`);

                const counts = loadVendorRequests();
                const key = vendor.toLowerCase();
                counts[key] = (counts[key] || 0) + 1;
                saveVendorRequests(counts);
                renderTopVendorRequests();

                vrStatus.textContent = 'Request submitted. Thank you.';
                vrStatus.className = 'vr-status ok';
                vrForm.reset();
                vrSource.value = payload.props.source;
            } catch {
                vrStatus.textContent = 'Could not submit automatically — opening email fallback...';
                window.location.href = buildVendorRequestMailto();
            } finally {
                vrSubmitBtn.disabled = false;
            }
        }

        function openVendorRequest(source = 'unknown') {
            if (vrSource) vrSource.value = source;
            if (vrStatus) {
                vrStatus.textContent = '';
                vrStatus.className = 'vr-status';
            }
            renderTopVendorRequests();
            openM('vendor-request');
        }

        vrForm?.addEventListener('submit', submitVendorRequest);
        vrMailtoBtn?.addEventListener('click', () => {
            window.location.href = buildVendorRequestMailto();
        });

        // Gemini AI Decision
        // The API key is stored in the environment on the server. The client
        // calls the `/api/decide` route instead of sending the request directly
        // to Gemini. This keeps the key secret.
        const API_ENDPOINT = '/api/decide';
        const MODEL = 'gemini-2.0-flash-lite';
        const q=document.getElementById('q'),btn=document.getElementById('btn'),ans=document.getElementById('ans'),refreshBtn=document.getElementById('refreshBtn'),charCount=document.getElementById('charCount'),decisionStatus=document.getElementById('decisionStatus'),inputInnerEl=document.getElementById('inputInner');
        const decisionModeButtons = Array.from(document.querySelectorAll('.decision-mode-btn'));
        const decisionModeCopy = document.getElementById('decisionModeCopy');
        const decisionChips = Array.from(document.querySelectorAll('#decisionChips .chip'));
        
        let decisionInputMode = 'single';
        let decideRequestSeq = 0;
        let thinkingTimer = null;
        let answerTimer = null;
        let decisionBusy = false;
        let decisionSetCounter = 0;
        const DECISION_HISTORY_LIMIT = 20;
        const decisionRows = [];
        const DEFAULT_PLACEHOLDER = 'ship this launch today?';
        const MULTI_PLACEHOLDER = 'best option: launch now | launch next week | launch next month';
        const RETRY_PLACEHOLDER = 'Try another question.';
        function showRetryPlaceholder() {
            q.value = '';
            q.placeholder = RETRY_PLACEHOLDER;
            q.classList.add('retry-placeholder');
            q.focus();
        }
        
        function resetPlaceholder() {
            q.placeholder = decisionInputMode === 'multi' ? MULTI_PLACEHOLDER : DEFAULT_PLACEHOLDER;
            q.classList.remove('retry-placeholder');
        }

        function clearDecisionStatus() {
            decisionStatus.textContent = '';
            decisionStatus.className = 'decision-status';
        }

        function setDecisionStatus(message, tone = 'warn') {
            decisionStatus.textContent = message;
            decisionStatus.className = `decision-status ${tone} show`;
        }

        function setDecisionBusy(isBusy) {
            decisionBusy = isBusy;
            btn.disabled = isBusy;
        }

        function applyDecisionInputMode(mode) {
            decisionInputMode = mode === 'multi' ? 'multi' : 'single';
            decisionModeButtons.forEach((button) => {
                button.classList.toggle('active', button.dataset.decisionMode === decisionInputMode);
            });

            if (decisionInputMode === 'multi') {
                decisionModeCopy.textContent = 'Multi mode: separate options with "|" and we return yes/no for each option.';
                q.placeholder = MULTI_PLACEHOLDER;
            } else {
                decisionModeCopy.textContent = 'Ask one question. We return yes, no, or tie.';
                q.placeholder = DEFAULT_PLACEHOLDER;
            }

            decisionChips.forEach((chip) => {
                const sample = decisionInputMode === 'multi' ? chip.dataset.multi : chip.dataset.single;
                chip.textContent = sample || '';
            });
        }

        function isPolicySensitiveQuestion(text) {
            const t = text.toLowerCase();
            const patterns = [
                /\b(bitcoin|btc|crypto|ethereum|eth)\b/,
                /\b(invest|investment|stock|stocks|trading|trade|portfolio)\b/,
                /\b(legal|lawsuit|sue|contract law|attorney|lawyer)\b/,
                /\b(medical|diagnose|diagnosis|prescription|medication|treatment)\b/
            ];
            return patterns.some((re) => re.test(t));
        }

        // Character countdown - only show when 20 chars remaining
        q.addEventListener('input', () => {
            const len = q.value.length;
            const remaining = 230 - len;
            
            if (remaining <= 20) {
                charCount.textContent = remaining;
                charCount.classList.add('show');
            } else {
                charCount.classList.remove('show');
            }
            
            // Reset to decide mode when typing
            resetToDecideMode();
            clearDecisionStatus();
        });

        function resetToDecideMode() {
            inputInnerEl.style.display = 'flex';
        }

        function clearDecisionUiTimers() {
            if (thinkingTimer) {
                clearTimeout(thinkingTimer);
                thinkingTimer = null;
            }
            if (answerTimer) {
                clearTimeout(answerTimer);
                answerTimer = null;
            }
        }

        function forceUnlockDecisionUi() {
            clearDecisionUiTimers();
            btn.disabled = decisionBusy;
            q.disabled = false;
            q.readOnly = false;
            q.style.pointerEvents = 'auto';
            btn.style.pointerEvents = 'auto';
            inputInnerEl.style.pointerEvents = 'auto';
            inputInnerEl.style.display = 'flex';
            // Failsafe: if any overlays got stuck, clear them.
            document.getElementById('mbg').classList.remove('on');
            mobileOverlay.classList.remove('open');
            mobileMenu.classList.remove('open');
            mobBtn.classList.remove('open');
            document.getElementById('mbg').style.display = 'none';
            document.getElementById('mbg').style.pointerEvents = 'none';
            mobileOverlay.style.display = 'none';
            mobileOverlay.style.pointerEvents = 'none';
            document.querySelectorAll('.modal').forEach(m => m.classList.remove('on'));
            document.body.style.overflow = '';
        }

        async function callGemini(question) {
  try {
    const response = await fetch('/api/decide', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ question }),
    });

    if (response.status === 204) return { blocked: true }; // blocked by server policy
    const data = await response.json();
    return data;
  } catch (error) {
    console.error('Decide API error:', error);
    return { error: true };
  }
}
        function nowStamp() {
            return new Date().toISOString().slice(0, 19).replace('T', ' ');
        }

        function escapeHtml(value) {
            return String(value ?? '')
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;');
        }

        function shortQuestion(value) {
            const cleaned = String(value ?? '').replace(/\r?\n/g, ' ').trim();
            if (!cleaned) return '-';
            return cleaned;
        }

        function verdictTone(verdict) {
            const v = String(verdict || '').toLowerCase();
            if (v === 'yes') return 'verdict-yes';
            if (v === 'no') return 'verdict-no';
            if (v === 'tie') return 'verdict-tie';
            if (v === 'pending') return 'verdict-pending';
            return 'verdict-unknown';
        }

        function parseMultiInput(text) {
            const raw = String(text || '').trim();
            if (!raw) return { stem: 'best option', options: [] };

            const segments = raw.split('|').map((item) => item.trim()).filter(Boolean);
            if (segments.length < 2) return { stem: raw, options: [] };

            let stem = 'best option';
            const first = segments[0];
            const colonIndex = first.indexOf(':');
            if (colonIndex !== -1) {
                const parsedStem = first.slice(0, colonIndex).trim();
                if (parsedStem) stem = parsedStem;
                segments[0] = first.slice(colonIndex + 1).trim();
            }

            const options = segments.map((item) => item.replace(/\s+/g, ' ').trim()).filter(Boolean);
            return { stem, options };
        }

        function buildMultiOptionQuestion(stem, options, option) {
            const list = options.map((item, idx) => `${idx + 1}) ${item}`).join('; ');
            return `Question: ${stem}. Options: ${list}. Option under evaluation: ${option}. Should this option be selected over the others? Answer strictly yes or no.`;
        }

        function renderDecisionTable() {
            const distinctSets = new Set(decisionRows.map((row) => row.setLabel).filter(Boolean)).size;
            const countLabel = `${distinctSets} set${distinctSets === 1 ? '' : 's'} · ${decisionRows.length} row${decisionRows.length === 1 ? '' : 's'}`;
            const head = `
                <div class="decision-table-top">
                    <span class="decision-table-title">Decision Runs</span>
                    <span class="decision-table-count">${countLabel}</span>
                </div>
            `;

            if (!decisionRows.length) {
                ans.innerHTML = `${head}<div class="decision-empty">No decisions yet. Ask a question to start a history.</div>`;
                return;
            }

            const rowsHtml = decisionRows.map((row) => {
                const question = shortQuestion(row.question);
                const fullQuestion = String(row.question || '-').replace(/\r?\n/g, ' ').trim() || '-';
                const verdict = String(row.verdict || '-');
                const mode = String(row.mode || 'single');
                const setLabel = String(row.setLabel || '-');
                const optionLabel = String(row.optionLabel || '-');
                return `
                    <tr>
                        <td class="col-time">${escapeHtml(row.time || '-')}</td>
                        <td class="col-set"><span class="meta-pill">${escapeHtml(setLabel)}</span></td>
                        <td class="col-option"><span class="meta-pill">${escapeHtml(optionLabel)}</span></td>
                        <td class="col-mode"><span class="mode-pill">${escapeHtml(mode)}</span></td>
                        <td class="col-question" title="${escapeHtml(fullQuestion)}">${escapeHtml(question)}</td>
                        <td><span class="pill ${verdictTone(verdict)}">${escapeHtml(verdict)}</span></td>
                    </tr>
                `;
            }).join('');

            ans.innerHTML = `
                ${head}
                <div class="decision-table-wrap">
                    <table class="decision-table">
                        <colgroup>
                            <col class="dt-col-time">
                            <col class="dt-col-set">
                            <col class="dt-col-option">
                            <col class="dt-col-mode">
                            <col class="dt-col-question">
                            <col class="dt-col-verdict">
                        </colgroup>
                        <thead>
                            <tr>
                                <th>Time (UTC)</th>
                                <th>Set</th>
                                <th>Opt</th>
                                <th>Mode</th>
                                <th>Question</th>
                                <th>Verdict</th>
                            </tr>
                        </thead>
                        <tbody>${rowsHtml}</tbody>
                    </table>
                </div>
            `;
        }

        function upsertDecisionRow(seq, patch) {
            const existingIndex = decisionRows.findIndex((row) => row.seq === seq);
            if (existingIndex === -1) {
                decisionRows.unshift({
                    seq,
                    time: nowStamp(),
                    mode: decisionInputMode === 'multi' ? 'multi' : 'single',
                    setLabel: '-',
                    optionLabel: '-',
                    question: '',
                    verdict: '-',
                    status: 'pending',
                    requestId: '-',
                    ...patch
                });
            } else {
                decisionRows[existingIndex] = { ...decisionRows[existingIndex], ...patch };
            }

            if (decisionRows.length > DECISION_HISTORY_LIMIT) {
                decisionRows.length = DECISION_HISTORY_LIMIT;
            }
            renderDecisionTable();
        }

        async function decide(text) {
            text = text.trim();
            if (text.length < 3) {
                return { c: 'unclear', v: 'Ask a question' };
            }
            return await callGemini(text);
        }

        async function handleDecide() {
            if (decisionBusy) return;

            const seq = ++decideRequestSeq;
            const setLabel = `S${++decisionSetCounter}`;
            const text = q.value.trim();
            if (text.length < 3) {
                setDecisionStatus('Enter at least 3 characters.', 'warn');
                return;
            }

            if (decisionInputMode === 'multi' && !text.includes('|')) {
                setDecisionStatus('Multi mode expects options separated by "|". Example: Option A | Option B | Option C', 'warn');
                return;
            }
            
            forceUnlockDecisionUi();
            resetPlaceholder();
            clearDecisionStatus();
            if (decisionInputMode === 'multi') {
                setDecisionStatus('Multi mode is beta and returns yes/no for each option.', 'warn');
            }
            setDecisionBusy(true);

            if (isPolicySensitiveQuestion(text)) {
                upsertDecisionRow(`${seq}-0`, {
                    time: nowStamp(),
                    mode: decisionInputMode === 'multi' ? 'multi' : 'single',
                    setLabel,
                    optionLabel: decisionInputMode === 'multi' ? '-' : '1',
                    question: text,
                    verdict: '-',
                    status: 'blocked (policy)',
                    requestId: '-'
                });
                setDecisionBusy(false);
                showRetryPlaceholder();
                setDecisionStatus('Can’t answer financial / legal / medical decisions. Try another question.', 'warn');
                return;
            }

            resetToDecideMode();

            const unlockWatchdog = setTimeout(() => {
                if (seq === decideRequestSeq) forceUnlockDecisionUi();
            }, 8000);

            if (decisionInputMode === 'multi') {
                const parsed = parseMultiInput(text);
                if (parsed.options.length < 2) {
                    clearTimeout(unlockWatchdog);
                    setDecisionBusy(false);
                    forceUnlockDecisionUi();
                    setDecisionStatus('Multi mode needs at least 2 options separated by "|".', 'warn');
                    return;
                }

                const optionRowSeqs = parsed.options.map((_, idx) => `${seq}-${idx}`);
                for (let idx = parsed.options.length - 1; idx >= 0; idx -= 1) {
                    const rowSeq = optionRowSeqs[idx];
                    upsertDecisionRow(rowSeq, {
                        time: nowStamp(),
                        mode: 'multi',
                        setLabel,
                        optionLabel: String(idx + 1),
                        question: `${parsed.stem}: ${parsed.options[idx]}`,
                        verdict: 'pending',
                        status: 'pending',
                        requestId: '-'
                    });
                }

                let blockedCount = 0;
                let errorCount = 0;

                try {
                    await Promise.all(parsed.options.map(async (option, idx) => {
                        const rowSeq = optionRowSeqs[idx];
                        const optionQuestion = buildMultiOptionQuestion(parsed.stem, parsed.options, option);
                        let result;
                        try {
                            result = await decide(optionQuestion);
                        } catch (error) {
                            result = { error: true };
                        }

                        if (seq !== decideRequestSeq) return;

                        if (result && result.blocked) {
                            blockedCount += 1;
                            upsertDecisionRow(rowSeq, {
                                time: nowStamp(),
                                mode: 'multi',
                                setLabel,
                                optionLabel: String(idx + 1),
                                question: `${parsed.stem}: ${parsed.options[idx]}`,
                                verdict: '-',
                                status: 'blocked (policy)',
                                requestId: '-'
                            });
                            return;
                        }

                        if (!result || result.error || !result.v) {
                            errorCount += 1;
                            upsertDecisionRow(rowSeq, {
                                time: nowStamp(),
                                mode: 'multi',
                                setLabel,
                                optionLabel: String(idx + 1),
                                question: `${parsed.stem}: ${parsed.options[idx]}`,
                                verdict: 'unknown',
                                status: 'error',
                                requestId: '-'
                            });
                            return;
                        }

                        upsertDecisionRow(rowSeq, {
                            time: nowStamp(),
                            mode: 'multi',
                            setLabel,
                            optionLabel: String(idx + 1),
                            question: `${parsed.stem}: ${parsed.options[idx]}`,
                            verdict: String(result.v || '').trim() || '-',
                            status: 'done',
                            requestId: result.request_id || '-'
                        });
                    }));
                } finally {
                    clearTimeout(unlockWatchdog);
                    setDecisionBusy(false);
                    if (seq === decideRequestSeq) forceUnlockDecisionUi();
                }

                if (seq !== decideRequestSeq) return;

                if (blockedCount > 0) {
                    setDecisionStatus(`${blockedCount} option(s) blocked by policy.`, 'warn');
                } else if (errorCount > 0) {
                    setDecisionStatus('Some options failed. Try again.', 'error');
                } else {
                    clearDecisionStatus();
                }

                return;
            }

            upsertDecisionRow(seq, {
                time: nowStamp(),
                mode: 'single',
                setLabel,
                optionLabel: '1',
                question: text,
                verdict: 'pending',
                status: 'pending',
                requestId: '-'
            });

            let result;
            try {
                result = await decide(text);
            } catch (error) {
                result = { error: true };
            } finally {
                clearTimeout(unlockWatchdog);
                setDecisionBusy(false);
                if (seq === decideRequestSeq) forceUnlockDecisionUi();
            }

            if (seq !== decideRequestSeq) return;
            
            // Only show "Try another question" for blocked questions (status 204)
            if (result && result.blocked) {
                upsertDecisionRow(seq, {
                    time: nowStamp(),
                    mode: 'single',
                    setLabel,
                    optionLabel: '1',
                    question: text,
                    verdict: '-',
                    status: 'blocked (policy)',
                    requestId: '-'
                });
                resetToDecideMode();
                showRetryPlaceholder();
                setDecisionStatus('Question blocked by policy (financial / legal / medical). Try another one.', 'warn');
                return;
            }
            
            // For errors or missing data, show a generic error but keep default placeholder
            if (!result || result.error || !result.v) {
                setDecisionStatus('Network hiccup. Please try again.', 'error');
                upsertDecisionRow(seq, {
                    time: nowStamp(),
                    mode: 'single',
                    setLabel,
                    optionLabel: '1',
                    question: text,
                    verdict: 'unknown',
                    status: 'error',
                    requestId: '-'
                });
                return;
            }
            
            clearDecisionStatus();
            upsertDecisionRow(seq, {
                time: nowStamp(),
                mode: 'single',
                setLabel,
                optionLabel: '1',
                question: text,
                verdict: String(result.v || '').trim() || '-',
                status: 'done',
                requestId: result.request_id || '-'
            });
        }

        function ask(t) {
            q.value = t;
            const remaining = 230 - t.length;
            if (remaining <= 20) {
                charCount.textContent = remaining;
                charCount.classList.add('show');
            } else {
                charCount.classList.remove('show');
            }
            clearDecisionStatus();
            q.focus();
        }

        decisionChips.forEach((chip) => {
            chip.addEventListener('click', () => {
                const sample = decisionInputMode === 'multi' ? chip.dataset.multi : chip.dataset.single;
                ask(sample || '');
            });
        });

        decisionModeButtons.forEach((button) => {
            button.addEventListener('click', () => {
                applyDecisionInputMode(button.dataset.decisionMode);
                clearDecisionStatus();
                resetToDecideMode();
            });
        });

        applyDecisionInputMode('single');
        renderDecisionTable();

        btn.addEventListener('click', handleDecide);
        q.addEventListener('keydown', e => { if (e.key === 'Enter' && !decisionBusy) handleDecide(); });
        
        // Refresh button - clear and start over
        refreshBtn.addEventListener('click', () => {
            clearDecisionUiTimers();
            decideRequestSeq += 1;
            forceUnlockDecisionUi();
            q.value = '';
            ans.className = 'ans';
            decisionRows.length = 0;
            setDecisionBusy(false);
            renderDecisionTable();
            charCount.classList.remove('show');
            resetToDecideMode();
            resetPlaceholder();
            clearDecisionStatus();
            q.focus();
        });
        
        document.querySelectorAll('a[href^="#"]').forEach(a => {
            a.addEventListener('click', function(e) {
                if (this.classList.contains('nav-signin') || this.classList.contains('nav-cta')) return; // Don't interfere with Sign In
                const h = this.getAttribute('href');
                if (h === '#') return;
                e.preventDefault();
                document.querySelector(h)?.scrollIntoView({ behavior: 'smooth' });
            });
        });

        // Clerk initialization
        let clerkReady = false;
        
        // Update UI based on auth state
        function updateAuthUI() {
            const signInLinks = Array.from(document.querySelectorAll('.nav-signin'));
            const user = window.Clerk?.user;
            
            // Remove existing sign out button if present
            document.querySelectorAll('.sign-out-btn').forEach((el) => el.remove());
            
            if (user) {
                // User is signed in - update the Sign In link to show user info
                const displayName = user.firstName || user.emailAddresses?.[0]?.emailAddress?.split('@')[0] || 'Account';
                const avatarUrl = user.imageUrl;
                
                signInLinks.forEach((link) => {
                    const isMobileMenu = Boolean(link.closest('.mobile-menu'));
                    if (isMobileMenu) {
                        link.textContent = displayName;
                        link.onclick = (e) => {
                            e.preventDefault();
                            closeMobileMenu();
                            openUserMenu();
                        };
                        return;
                    }

                    link.innerHTML = `
                        <span style="display:flex;align-items:center;gap:0.5rem;">
                            ${avatarUrl ? `<img src="${avatarUrl}" style="width:24px;height:24px;border-radius:50%;object-fit:cover;">` : ''}
                            <span>${displayName}</span>
                        </span>
                    `;
                    link.onclick = (e) => {
                        e.preventDefault();
                        openUserMenu();
                    };
                    link.classList.add('signed-in');

                    // Add Sign Out button after each desktop user button
                    const signOutBtn = document.createElement('a');
                    signOutBtn.href = '#';
                    signOutBtn.className = 'sign-out-btn';
                    signOutBtn.textContent = 'Sign Out';
                    signOutBtn.onclick = (e) => {
                        e.preventDefault();
                        signOut();
                    };
                    link.insertAdjacentElement('afterend', signOutBtn);
                });
            } else {
                // User is signed out - restore Sign In link
                signInLinks.forEach((link) => {
                    link.innerHTML = 'Sign In';
                    link.onclick = (e) => {
                        e.preventDefault();
                        if (link.closest('.mobile-menu')) closeMobileMenu();
                        openSignIn();
                    };
                    link.classList.remove('signed-in');
                });
            }
            updatePlaygroundScopeNote();
            renderTrail();
            renderSavedCases();
            loadShareRedactionPrefs();
            renderAssertions();
            renderAssertionTemplates();
            renderMonitors();
        }
        
        // Open user menu/profile
        async function openUserMenu() {
            if (!window.Clerk) return;
            
            try {
                await window.Clerk.openUserProfile();
            } catch (error) {
                console.error('Error opening user profile:', error);
            }
        }
        
        // Sign out function
        async function signOut() {
            if (!window.Clerk) return;
            
            try {
                await window.Clerk.signOut();
                updateAuthUI();
            } catch (error) {
                console.error('Error signing out:', error);
            }
        }
        
        window.addEventListener('load', async () => {
            if (window.Clerk) {
                await window.Clerk.load();
                clerkReady = true;
                
                // Update UI based on current auth state
                updateAuthUI();
                
                // Listen for auth state changes
                window.Clerk.addListener(({ user }) => {
                    updateAuthUI();
                });
            }
        });

        function syncNavVisibility(isAgents) {
            const isMobile = window.matchMedia('(max-width: 768px)').matches;

            // Desktop nav links should never render on mobile; mobile menu handles those.
            document.getElementById('navLinksHuman').style.display = isMobile ? 'none' : (isAgents ? 'none' : 'flex');
            document.getElementById('navLinksAgent').style.display = isMobile ? 'none' : (isAgents ? 'flex' : 'none');

            // Mobile menu sections
            document.getElementById('mobileHumanLinks').style.display = isAgents ? 'none' : 'block';
            document.getElementById('mobileAgentLinks').style.display = isAgents ? 'block' : 'none';
        }

        const VALID_MODES = new Set(['humans', 'agents', 'overview']);

        function getModeFromLocation() {
            const params = new URLSearchParams(window.location.search);
            const queryMode = (params.get('mode') || '').toLowerCase();
            if (VALID_MODES.has(queryMode)) return queryMode;

            const hash = (window.location.hash || '').toLowerCase();
            if (hash === '#humans') return 'humans';
            if (hash === '#agents') return 'agents';
            if (hash === '#overview') return 'overview';

            const path = (window.location.pathname || '/').replace(/\/+$/, '') || '/';
            if (path === '/livedemo' || path === '/playground' || path === '/agents') return 'agents';
            if (path === '/humans') return 'humans';

            // Deterministic default for root landing.
            return 'overview';
        }

        function buildModeUrl(mode) {
            const params = new URLSearchParams(window.location.search);
            params.delete('mode');
            if (mode !== 'overview') params.set('mode', mode);
            const query = params.toString();
            const basePath = window.location.pathname || '/';
            return `${basePath}${query ? `?${query}` : ''}`;
        }

        // Mode toggle (Humans / Agents / Overview)
        function setMode(mode, options = {}) {
            const resolvedMode = VALID_MODES.has(mode) ? mode : 'overview';
            const isAgents = resolvedMode === 'agents';
            const { updateHistory = true, scroll = true } = options;

            // Toggle desktop/mobile nav variants based on viewport
            syncNavVisibility(isAgents);

            // Show/hide mode containers
            document.body.classList.toggle('agents', isAgents);
            document.body.classList.toggle('overview', resolvedMode === 'overview');

            // Update toggle buttons
            document.querySelectorAll('.mode-toggle button').forEach(b => {
                b.classList.toggle('active', b.dataset.mode === resolvedMode);
            });

            if (updateHistory) {
                history.replaceState(null, '', buildModeUrl(resolvedMode));
            }

            if (scroll) {
                window.scrollTo({ top: 0, behavior: 'instant' });
            }
        }

        // MCP playground + audit trail
        const pgNotary = document.getElementById('pgNotary');
        const pgMode = document.getElementById('pgMode');
        const pgPreset = document.getElementById('pgPreset');
        const pgLoadPresetBtn = document.getElementById('pgLoadPresetBtn');
        const pgPayload = document.getElementById('pgPayload');
        const pgRunBtn = document.getElementById('pgRunBtn');
        const pgCopyRespBtn = document.getElementById('pgCopyRespBtn');
        const pgShareRunBtn = document.getElementById('pgShareRunBtn');
        const pgExportBtn = document.getElementById('pgExportBtn');
        const pgClearTrailBtn = document.getElementById('pgClearTrailBtn');
        const pgRunTrustSuiteBtn = document.getElementById('pgRunTrustSuiteBtn');
        const pgDemoRefundBtn = document.getElementById('pgDemoRefundBtn');
        const pgDemoCancelBtn = document.getElementById('pgDemoCancelBtn');
        const pgDemoTrustBtn = document.getElementById('pgDemoTrustBtn');
        const pgSaveCaseBtn = document.getElementById('pgSaveCaseBtn');
        const pgSavedCases = document.getElementById('pgSavedCases');
        const pgLoadCaseBtn = document.getElementById('pgLoadCaseBtn');
        const pgDeleteCaseBtn = document.getElementById('pgDeleteCaseBtn');
        const pgRunSuiteBtn = document.getElementById('pgRunSuiteBtn');
        const pgMonitorInterval = document.getElementById('pgMonitorInterval');
        const pgSaveMonitorBtn = document.getElementById('pgSaveMonitorBtn');
        const pgRunMonitorsBtn = document.getElementById('pgRunMonitorsBtn');
        const pgMonitorList = document.getElementById('pgMonitorList');
        const pgMonitorSummary = document.getElementById('pgMonitorSummary');
        const pgVendorNetworkList = document.getElementById('pgVendorNetworkList');
        const pgVendorRefreshBtn = document.getElementById('pgVendorRefreshBtn');
        const pgAdvancedTools = document.getElementById('pgAdvancedTools');
        const pgRedactChecks = Array.from(document.querySelectorAll('#pgRedactRow [data-redact-field]'));
        const pgAssertTemplate = document.getElementById('pgAssertTemplate');
        const pgUseAssertTemplateBtn = document.getElementById('pgUseAssertTemplateBtn');
        const pgAssertPath = document.getElementById('pgAssertPath');
        const pgAssertOp = document.getElementById('pgAssertOp');
        const pgAssertExpected = document.getElementById('pgAssertExpected');
        const pgAddAssertBtn = document.getElementById('pgAddAssertBtn');
        const pgAssertList = document.getElementById('pgAssertList');
        const pgResponse = document.getElementById('pgResponse');
        const pgProvenance = document.getElementById('pgProvenance');
        const pgDiff = document.getElementById('pgDiff');
        const pgScopeNote = document.getElementById('pgScopeNote');
        const pgTrustBadge = document.getElementById('pgTrustBadge');
        const pgTrailBody = document.getElementById('pgTrailBody');
        const pgTrailEmpty = document.getElementById('pgTrailEmpty');
        const pgTrailMeta = document.getElementById('pgTrailMeta');
        const pgFilterStatus = document.getElementById('pgFilterStatus');
        const pgFilterNotary = document.getElementById('pgFilterNotary');
        const pgFilterMode = document.getElementById('pgFilterMode');
        const pgFilterLatency = document.getElementById('pgFilterLatency');
        let pgPreviousResponseText = '';
        let pgLastRunSnapshot = null;
        let pgMonitorRunning = false;

        function trackEvent(event, props = {}) {
            const payload = { event, props, ts: new Date().toISOString() };
            try {
                const body = JSON.stringify(payload);
                if (navigator.sendBeacon) {
                    const blob = new Blob([body], { type: 'application/json' });
                    navigator.sendBeacon('/api/track', blob);
                    return;
                }
                fetch('/api/track', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body,
                    keepalive: true
                }).catch(() => {});
            } catch {}
        }

        const PLAYGROUND_CONFIG = {
            refund: {
                mcp: { endpoint: '/api/mcp', template: { jsonrpc: '2.0', id: 1, method: 'tools/call', params: { name: 'refund_eligibility', arguments: { vendor: 'adobe', days_since_purchase: 5, region: 'US', plan: 'individual' } } } },
                rest: { endpoint: '/api/v1/refund/eligibility', template: { vendor: 'adobe', days_since_purchase: 5, region: 'US', plan: 'individual' } }
            },
            cancel: {
                mcp: { endpoint: '/api/cancel-mcp', template: { jsonrpc: '2.0', id: 1, method: 'tools/call', params: { name: 'cancellation_penalty', arguments: { vendor: 'adobe', region: 'US', plan: 'individual' } } } },
                rest: { endpoint: '/api/v1/cancel/penalty', template: { vendor: 'adobe', region: 'US', plan: 'individual' } }
            },
            return: {
                mcp: { endpoint: '/api/return-mcp', template: { jsonrpc: '2.0', id: 1, method: 'tools/call', params: { name: 'return_eligibility', arguments: { vendor: 'adobe', days_since_purchase: 5, region: 'US', plan: 'individual' } } } },
                rest: { endpoint: '/api/v1/return/eligibility', template: { vendor: 'adobe', days_since_purchase: 5, region: 'US', plan: 'individual' } }
            },
            trial: {
                mcp: { endpoint: '/api/trial-mcp', template: { jsonrpc: '2.0', id: 1, method: 'tools/call', params: { name: 'trial_terms', arguments: { vendor: 'adobe', region: 'US', plan: 'individual' } } } },
                rest: { endpoint: '/api/v1/trial/terms', template: { vendor: 'adobe', region: 'US', plan: 'individual' } }
            }
        };

        const PLAYGROUND_PRESETS = {
            refund: {
                mcp: [
                    { label: 'Adobe allowed (5 days)', payload: { jsonrpc: '2.0', id: 1, method: 'tools/call', params: { name: 'refund_eligibility', arguments: { vendor: 'adobe', days_since_purchase: 5, region: 'US', plan: 'individual' } } } },
                    { label: 'Boundary day 14 (allowed)', payload: { jsonrpc: '2.0', id: 1, method: 'tools/call', params: { name: 'refund_eligibility', arguments: { vendor: 'adobe', days_since_purchase: 14, region: 'US', plan: 'individual' } } } },
                    { label: 'Boundary day 15 (denied)', payload: { jsonrpc: '2.0', id: 1, method: 'tools/call', params: { name: 'refund_eligibility', arguments: { vendor: 'adobe', days_since_purchase: 15, region: 'US', plan: 'individual' } } } },
                    { label: 'Unknown vendor fallback', payload: { jsonrpc: '2.0', id: 1, method: 'tools/call', params: { name: 'refund_eligibility', arguments: { vendor: 'unknownco', days_since_purchase: 7, region: 'US', plan: 'individual' } } } },
                    { label: 'Diagnostic: missing vendor', tier: 'diag', payload: { jsonrpc: '2.0', id: 1, method: 'tools/call', params: { name: 'refund_eligibility', arguments: { days_since_purchase: 5, region: 'US', plan: 'individual' } } } }
                ],
                rest: [
                    { label: 'Adobe allowed (5 days)', payload: { vendor: 'adobe', days_since_purchase: 5, region: 'US', plan: 'individual' } },
                    { label: 'Boundary day 14 (allowed)', payload: { vendor: 'adobe', days_since_purchase: 14, region: 'US', plan: 'individual' } },
                    { label: 'Boundary day 15 (denied)', payload: { vendor: 'adobe', days_since_purchase: 15, region: 'US', plan: 'individual' } },
                    { label: 'Unknown vendor fallback', payload: { vendor: 'unknownco', days_since_purchase: 7, region: 'US', plan: 'individual' } },
                    { label: 'Diagnostic: missing vendor', tier: 'diag', payload: { days_since_purchase: 5, region: 'US', plan: 'individual' } }
                ]
            },
            cancel: {
                mcp: [
                    { label: 'Adobe ETF path', payload: { jsonrpc: '2.0', id: 1, method: 'tools/call', params: { name: 'cancellation_penalty', arguments: { vendor: 'adobe', region: 'US', plan: 'individual' } } } },
                    { label: 'Free cancel path', payload: { jsonrpc: '2.0', id: 1, method: 'tools/call', params: { name: 'cancellation_penalty', arguments: { vendor: 'netflix', region: 'US', plan: 'individual' } } } },
                    { label: 'Unknown vendor fallback', payload: { jsonrpc: '2.0', id: 1, method: 'tools/call', params: { name: 'cancellation_penalty', arguments: { vendor: 'unknownco', region: 'US', plan: 'individual' } } } },
                    { label: 'Diagnostic: invalid plan', tier: 'diag', payload: { jsonrpc: '2.0', id: 1, method: 'tools/call', params: { name: 'cancellation_penalty', arguments: { vendor: 'adobe', region: 'US', plan: 'weekly' } } } }
                ],
                rest: [
                    { label: 'Adobe ETF path', payload: { vendor: 'adobe', region: 'US', plan: 'individual' } },
                    { label: 'Free cancel path', payload: { vendor: 'netflix', region: 'US', plan: 'individual' } },
                    { label: 'Unknown vendor fallback', payload: { vendor: 'unknownco', region: 'US', plan: 'individual' } },
                    { label: 'Diagnostic: invalid plan', tier: 'diag', payload: { vendor: 'adobe', region: 'US', plan: 'weekly' } }
                ]
            },
            return: {
                mcp: [
                    { label: 'Returnable (5 days)', payload: { jsonrpc: '2.0', id: 1, method: 'tools/call', params: { name: 'return_eligibility', arguments: { vendor: 'adobe', days_since_purchase: 5, region: 'US', plan: 'individual' } } } },
                    { label: 'Boundary day 14 (returnable)', payload: { jsonrpc: '2.0', id: 1, method: 'tools/call', params: { name: 'return_eligibility', arguments: { vendor: 'adobe', days_since_purchase: 14, region: 'US', plan: 'individual' } } } },
                    { label: 'Boundary day 15 (expired)', payload: { jsonrpc: '2.0', id: 1, method: 'tools/call', params: { name: 'return_eligibility', arguments: { vendor: 'adobe', days_since_purchase: 15, region: 'US', plan: 'individual' } } } },
                    { label: 'Diagnostic: missing days', tier: 'diag', payload: { jsonrpc: '2.0', id: 1, method: 'tools/call', params: { name: 'return_eligibility', arguments: { vendor: 'adobe', region: 'US', plan: 'individual' } } } }
                ],
                rest: [
                    { label: 'Returnable (5 days)', payload: { vendor: 'adobe', days_since_purchase: 5, region: 'US', plan: 'individual' } },
                    { label: 'Boundary day 14 (returnable)', payload: { vendor: 'adobe', days_since_purchase: 14, region: 'US', plan: 'individual' } },
                    { label: 'Boundary day 15 (expired)', payload: { vendor: 'adobe', days_since_purchase: 15, region: 'US', plan: 'individual' } },
                    { label: 'Diagnostic: missing days', tier: 'diag', payload: { vendor: 'adobe', region: 'US', plan: 'individual' } }
                ]
            },
            trial: {
                mcp: [
                    { label: 'Card-required trial', payload: { jsonrpc: '2.0', id: 1, method: 'tools/call', params: { name: 'trial_terms', arguments: { vendor: 'adobe', region: 'US', plan: 'individual' } } } },
                    { label: 'No-trial style check', payload: { jsonrpc: '2.0', id: 1, method: 'tools/call', params: { name: 'trial_terms', arguments: { vendor: 'legacy_service', region: 'US', plan: 'individual' } } } },
                    { label: 'Diagnostic: missing region', tier: 'diag', payload: { jsonrpc: '2.0', id: 1, method: 'tools/call', params: { name: 'trial_terms', arguments: { vendor: 'adobe', plan: 'individual' } } } }
                ],
                rest: [
                    { label: 'Card-required trial', payload: { vendor: 'adobe', region: 'US', plan: 'individual' } },
                    { label: 'No-trial style check', payload: { vendor: 'legacy_service', region: 'US', plan: 'individual' } },
                    { label: 'Diagnostic: missing region', tier: 'diag', payload: { vendor: 'adobe', plan: 'individual' } }
                ]
            }
        };

        const ASSERTION_TEMPLATES = {
            all: [
                { label: 'HTTP status is 200', path: 'status', op: 'eq', expected: '200' },
                { label: 'Latency under 500ms', path: 'latency', op: 'lt', expected: '500' }
            ],
            mcp: {
                refund: [
                    { label: 'Refund text contains ALLOWED', path: 'result.content[0].text', op: 'contains', expected: 'ALLOWED' },
                    { label: 'Refund text contains WITHIN_WINDOW', path: 'result.content[0].text', op: 'contains', expected: 'WITHIN_WINDOW' },
                    { label: 'Refund text contains Source', path: 'result.content[0].text', op: 'contains', expected: 'Source:' }
                ],
                cancel: [
                    { label: 'Cancel text contains PENALTY', path: 'result.content[0].text', op: 'contains', expected: 'PENALTY' },
                    { label: 'Cancel text contains Source', path: 'result.content[0].text', op: 'contains', expected: 'Source:' }
                ],
                return: [
                    { label: 'Return text contains RETURNABLE', path: 'result.content[0].text', op: 'contains', expected: 'RETURNABLE' },
                    { label: 'Return text contains Source', path: 'result.content[0].text', op: 'contains', expected: 'Source:' }
                ],
                trial: [
                    { label: 'Trial text contains TRIAL_AVAILABLE', path: 'result.content[0].text', op: 'contains', expected: 'TRIAL_AVAILABLE' },
                    { label: 'Trial text contains Source', path: 'result.content[0].text', op: 'contains', expected: 'Source:' }
                ]
            },
            rest: {
                refund: [
                    { label: 'Verdict = ALLOWED', path: 'verdict', op: 'eq', expected: 'ALLOWED' },
                    { label: 'Code = WITHIN_WINDOW', path: 'code', op: 'eq', expected: 'WITHIN_WINDOW' },
                    { label: 'Source url exists', path: 'policy_source_url', op: 'exists', expected: '' },
                    { label: 'Last checked exists', path: 'policy_last_checked', op: 'exists', expected: '' }
                ],
                cancel: [
                    { label: 'Verdict = PENALTY', path: 'verdict', op: 'eq', expected: 'PENALTY' },
                    { label: 'Source url exists', path: 'policy_source_url', op: 'exists', expected: '' },
                    { label: 'Last checked exists', path: 'policy_last_checked', op: 'exists', expected: '' }
                ],
                return: [
                    { label: 'Verdict = RETURNABLE', path: 'verdict', op: 'eq', expected: 'RETURNABLE' },
                    { label: 'Source url exists', path: 'policy_source_url', op: 'exists', expected: '' },
                    { label: 'Last checked exists', path: 'policy_last_checked', op: 'exists', expected: '' }
                ],
                trial: [
                    { label: 'Verdict = TRIAL_AVAILABLE', path: 'verdict', op: 'eq', expected: 'TRIAL_AVAILABLE' },
                    { label: 'Source url exists', path: 'policy_source_url', op: 'exists', expected: '' },
                    { label: 'Last checked exists', path: 'policy_last_checked', op: 'exists', expected: '' }
                ]
            }
        };

        function getPlaygroundAuditKey() {
            const uid = window.Clerk?.user?.id;
            return uid ? `decide_playground_audit_${uid}` : 'decide_playground_audit_guest';
        }

        function getPlaygroundCasesKey() {
            const uid = window.Clerk?.user?.id;
            return uid ? `decide_playground_cases_${uid}` : 'decide_playground_cases_guest';
        }

        function getPlaygroundRedactKey() {
            const uid = window.Clerk?.user?.id;
            return uid ? `decide_playground_redact_${uid}` : 'decide_playground_redact_guest';
        }

        function getPlaygroundAssertKey() {
            const uid = window.Clerk?.user?.id;
            return uid ? `decide_playground_assert_${uid}` : 'decide_playground_assert_guest';
        }

        function getPlaygroundMonitorsKey() {
            const uid = window.Clerk?.user?.id;
            return uid ? `decide_playground_monitors_${uid}` : 'decide_playground_monitors_guest';
        }

        function getPlaygroundTrustSuiteKey() {
            const uid = window.Clerk?.user?.id;
            return uid ? `decide_playground_trust_suite_${uid}` : 'decide_playground_trust_suite_guest';
        }

        function setTrustSuiteBadge(state, detail = '') {
            if (!pgTrustBadge) return;
            pgTrustBadge.classList.remove('pass', 'fail', 'running');
            if (state === 'pass') {
                pgTrustBadge.classList.add('pass');
                pgTrustBadge.textContent = detail || 'Trust Suite: PASS';
                return;
            }
            if (state === 'fail') {
                pgTrustBadge.classList.add('fail');
                pgTrustBadge.textContent = detail || 'Trust Suite: FAIL';
                return;
            }
            if (state === 'running') {
                pgTrustBadge.classList.add('running');
                pgTrustBadge.textContent = detail || 'Trust Suite: running…';
                return;
            }
            pgTrustBadge.textContent = detail || 'Trust Suite: not run';
        }

        function restoreTrustSuiteBadge() {
            try {
                const raw = localStorage.getItem(getPlaygroundTrustSuiteKey());
                if (!raw) return setTrustSuiteBadge('neutral');
                const saved = JSON.parse(raw);
                if (!saved || !saved.state) return setTrustSuiteBadge('neutral');
                setTrustSuiteBadge(saved.state, saved.text);
            } catch {
                setTrustSuiteBadge('neutral');
            }
        }

        function updatePlaygroundScopeNote() {
            if (!pgScopeNote) return;
            const uid = window.Clerk?.user?.id;
            pgScopeNote.textContent = uid
                ? `Audit scope: signed-in account (${uid.slice(0, 8)}…) in this browser session.`
                : 'Audit scope: this browser (guest). Sign in to scope trail and monitors to your account.';
            restoreTrustSuiteBadge();
        }

        function loadTrail() {
            try { return JSON.parse(localStorage.getItem(getPlaygroundAuditKey()) || '[]'); } catch { return []; }
        }

        function saveTrail(entries) {
            localStorage.setItem(getPlaygroundAuditKey(), JSON.stringify(entries.slice(0, 50)));
        }

        function loadSavedCases() {
            try { return JSON.parse(localStorage.getItem(getPlaygroundCasesKey()) || '[]'); } catch { return []; }
        }

        function saveSavedCases(cases) {
            localStorage.setItem(getPlaygroundCasesKey(), JSON.stringify(cases.slice(0, 100)));
        }

        function loadAssertions() {
            try { return JSON.parse(localStorage.getItem(getPlaygroundAssertKey()) || '[]'); } catch { return []; }
        }

        function saveAssertions(assertions) {
            localStorage.setItem(getPlaygroundAssertKey(), JSON.stringify(assertions.slice(0, 100)));
        }

        function loadMonitors() {
            try { return JSON.parse(localStorage.getItem(getPlaygroundMonitorsKey()) || '[]'); } catch { return []; }
        }

        function saveMonitors(monitors) {
            localStorage.setItem(getPlaygroundMonitorsKey(), JSON.stringify(monitors.slice(0, 100)));
        }

        function getScopedAssertions(notary = pgNotary.value, mode = pgMode.value) {
            return loadAssertions().filter((a) => a.notary === notary && a.mode === mode);
        }

        function renderAssertions() {
            const assertions = getScopedAssertions();
            pgAssertList.innerHTML = '';
            if (!assertions.length) {
                const empty = document.createElement('span');
                empty.className = 'pg-note';
                empty.textContent = 'No assertions yet.';
                pgAssertList.appendChild(empty);
                return;
            }
            assertions.forEach((rule) => {
                const chip = document.createElement('span');
                chip.className = 'pg-assert-chip';
                const label = document.createElement('span');
                label.textContent = `${rule.path} ${rule.op} ${rule.expected || ''}`.trim();
                const removeBtn = document.createElement('button');
                removeBtn.type = 'button';
                removeBtn.setAttribute('aria-label', 'Remove assertion');
                removeBtn.textContent = '×';
                chip.appendChild(label);
                chip.appendChild(removeBtn);
                removeBtn.addEventListener('click', () => {
                    const next = loadAssertions().filter((a) => a.id !== rule.id);
                    saveAssertions(next);
                    renderAssertions();
                });
                pgAssertList.appendChild(chip);
            });
        }

        function getAssertionTemplateList() {
            const modeTemplates = ASSERTION_TEMPLATES[pgMode.value] || {};
            return [...(ASSERTION_TEMPLATES.all || []), ...(modeTemplates[pgNotary.value] || [])];
        }

        function renderAssertionTemplates() {
            const templates = getAssertionTemplateList();
            pgAssertTemplate.innerHTML = '';
            const placeholder = document.createElement('option');
            placeholder.value = '';
            placeholder.textContent = 'Assertion template';
            pgAssertTemplate.appendChild(placeholder);
            templates.forEach((tpl, idx) => {
                const opt = document.createElement('option');
                opt.value = String(idx);
                opt.textContent = tpl.label;
                pgAssertTemplate.appendChild(opt);
            });
        }

        function applyAssertionTemplate() {
            if (pgAssertTemplate.value === '') return;
            const idx = Number(pgAssertTemplate.value);
            if (!Number.isFinite(idx)) return;
            const tpl = getAssertionTemplateList()[idx];
            if (!tpl) return;
            pgAssertPath.value = tpl.path;
            pgAssertOp.value = tpl.op;
            pgAssertExpected.value = tpl.expected;
            pgAssertExpected.focus();
        }

        function getSelectedRedactions() {
            return new Set(pgRedactChecks.filter((el) => el.checked).map((el) => el.dataset.redactField));
        }

        function saveShareRedactionPrefs() {
            const selected = Array.from(getSelectedRedactions());
            localStorage.setItem(getPlaygroundRedactKey(), JSON.stringify(selected));
        }

        function loadShareRedactionPrefs() {
            let selected = ['vendor', 'requestId'];
            try {
                const parsed = JSON.parse(localStorage.getItem(getPlaygroundRedactKey()) || 'null');
                if (Array.isArray(parsed)) selected = parsed;
            } catch {}
            const selectedSet = new Set(selected);
            pgRedactChecks.forEach((el) => {
                el.checked = selectedSet.has(el.dataset.redactField);
            });
        }

        function renderSavedCases() {
            const cases = loadSavedCases().filter((c) => c.notary === pgNotary.value && c.mode === pgMode.value);
            pgSavedCases.innerHTML = '';
            if (!cases.length) {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'No saved cases for this view';
                pgSavedCases.appendChild(option);
                return;
            }
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'Select a saved case';
            pgSavedCases.appendChild(defaultOption);
            cases.forEach((entry) => {
                const option = document.createElement('option');
                option.value = entry.id;
                option.textContent = entry.name;
                pgSavedCases.appendChild(option);
            });
        }

        function formatMonitorTime(ts) {
            if (!ts) return '—';
            const d = new Date(ts);
            if (Number.isNaN(d.getTime())) return '—';
            return d.toLocaleString([], { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
        }

        function renderMonitors() {
            const monitors = loadMonitors();
            const visible = monitors.filter((m) => m.notary === pgNotary.value && m.mode === pgMode.value);
            pgMonitorList.innerHTML = '';
            if (!visible.length) {
                pgMonitorSummary.textContent = 'No monitors yet.';
                return;
            }
            const activeCount = visible.filter((m) => m.active !== false).length;
            pgMonitorSummary.textContent = `${visible.length} monitor(s) in this view, ${activeCount} active.`;
            visible.forEach((monitor) => {
                const item = document.createElement('div');
                item.className = 'pg-monitor-item';
                const status = monitor.lastStatus || 'never';
                const meta = document.createElement('div');
                meta.className = 'pg-monitor-meta';
                meta.textContent = `${monitor.name} • every ${monitor.intervalHours}h • ${monitor.active !== false ? 'active' : 'paused'} • last: ${status} • next: ${formatMonitorTime(monitor.nextRunAt)}`;

                const actions = document.createElement('div');
                actions.className = 'pg-monitor-actions';
                actions.innerHTML = `
                    <button class="pg-mini-btn" type="button" data-monitor-action="run" data-monitor-id="${monitor.id}">Run</button>
                    <button class="pg-mini-btn" type="button" data-monitor-action="toggle" data-monitor-id="${monitor.id}">${monitor.active !== false ? 'Pause' : 'Resume'}</button>
                    <button class="pg-mini-btn warn" type="button" data-monitor-action="delete" data-monitor-id="${monitor.id}">Delete</button>
                `;
                item.appendChild(meta);
                item.appendChild(actions);
                pgMonitorList.appendChild(item);
            });
        }

	        async function renderNetworkVendorRequests() {
	            if (!pgVendorNetworkList) return;
	            pgVendorNetworkList.innerHTML = '<li>Loading…</li>';
	            try {
	                // Keep vendor-request stats under /api/metrics (Vercel Hobby plan caps Serverless Functions).
	                const response = await fetch('/api/metrics', { cache: 'no-store' });
	                if (!response.ok) throw new Error(`status ${response.status}`);
	                const data = await response.json();
	                const top = Array.isArray(data?.top_vendor_requests_30d) ? data.top_vendor_requests_30d.slice(0, 8) : [];
	                pgVendorNetworkList.innerHTML = '';
	                if (!top.length) {
	                    pgVendorNetworkList.innerHTML = '<li>No vendor requests yet</li>';
	                    return;
	                }
                top.forEach((row) => {
                    const li = document.createElement('li');
                    li.textContent = `${row.vendor} (${row.count})`;
                    pgVendorNetworkList.appendChild(li);
                });
            } catch {
                pgVendorNetworkList.innerHTML = '<li>Unavailable right now</li>';
            }
        }

        async function maybeNotifyMonitorFailure(monitor, entry) {
            const title = `Monitor failed: ${monitor.name}`;
            const body = `${monitor.notary}/${monitor.mode} • status ${entry?.status || 0} • ${entry?.assertSummary || 'assert fail'}`;
            if ('Notification' in window) {
                if (Notification.permission === 'granted') {
                    new Notification(title, { body });
                    return;
                }
                if (Notification.permission === 'default') {
                    try { await Notification.requestPermission(); } catch {}
                    if (Notification.permission === 'granted') {
                        new Notification(title, { body });
                        return;
                    }
                }
            }
            pgScopeNote.textContent = `${title}. Enable notifications for browser alerts.`;
        }

        async function runMonitorById(id, { dueOnly = false } = {}) {
            const monitors = loadMonitors();
            const idx = monitors.findIndex((m) => m.id === id);
            if (idx < 0) return null;
            const monitor = monitors[idx];
            if (!monitor || monitor.active === false) return null;
            const now = Date.now();
            if (dueOnly && monitor.nextRunAt && monitor.nextRunAt > now) return null;

            const entry = await runPlayground({
                notary: monitor.notary,
                mode: monitor.mode,
                payload: monitor.payload,
                caseName: `monitor:${monitor.name}`,
                silentUi: true
            });

            const failed = !entry || entry.assertPass === false || entry.status >= 400 || entry.status === 0;
            const previous = monitor.lastStatus || 'never';
            monitor.lastStatus = failed ? 'FAIL' : 'PASS';
            monitor.lastRunAt = new Date().toISOString();
            monitor.lastMessage = entry?.assertSummary || '';
            monitor.nextRunAt = now + (Number(monitor.intervalHours || 24) * 60 * 60 * 1000);
            monitors[idx] = monitor;
            saveMonitors(monitors);
            renderMonitors();
            if (failed && previous !== 'FAIL') {
                await maybeNotifyMonitorFailure(monitor, entry);
            }
            return monitor;
        }

        async function runDueMonitors() {
            if (pgMonitorRunning) return;
            pgMonitorRunning = true;
            pgRunMonitorsBtn.disabled = true;
            try {
                const due = loadMonitors().filter((m) => m.active !== false && m.nextRunAt && m.nextRunAt <= Date.now());
                let runCount = 0;
                for (const monitor of due) {
                    await runMonitorById(monitor.id, { dueOnly: true });
                    runCount += 1;
                }
                if (runCount) {
                    pgScopeNote.textContent = `Ran ${runCount} due monitor(s).`;
                }
            } finally {
                pgRunMonitorsBtn.disabled = false;
                pgMonitorRunning = false;
            }
        }

        function saveMonitorFromSelectedCase() {
            const caseId = pgSavedCases.value;
            if (!caseId) {
                pgScopeNote.textContent = 'Pick a saved case first, then click Save as monitor.';
                return;
            }
            const selected = loadSavedCases().find((c) => c.id === caseId);
            if (!selected) return;
            const intervalHours = Number(pgMonitorInterval.value || 24);
            const defaultName = `${selected.name} monitor`;
            const name = (window.prompt('Monitor name:', defaultName) || '').trim();
            if (!name) return;

            const monitors = loadMonitors();
            const exists = monitors.find((m) => m.name.toLowerCase() === name.toLowerCase() && m.notary === selected.notary && m.mode === selected.mode);
            const base = {
                id: exists?.id || `${Date.now()}-${Math.random().toString(16).slice(2, 8)}`,
                name,
                notary: selected.notary,
                mode: selected.mode,
                payload: selected.payload,
                intervalHours,
                active: true,
                nextRunAt: Date.now() + (intervalHours * 60 * 60 * 1000),
                lastRunAt: exists?.lastRunAt || '',
                lastStatus: exists?.lastStatus || 'never',
                lastMessage: exists?.lastMessage || ''
            };
            const next = exists ? monitors.map((m) => (m.id === exists.id ? base : m)) : [base, ...monitors];
            saveMonitors(next);
            renderMonitors();
            pgScopeNote.textContent = `Saved monitor: ${name} (every ${intervalHours}h).`;
        }

        function deleteMonitor(id) {
            const next = loadMonitors().filter((m) => m.id !== id);
            saveMonitors(next);
            renderMonitors();
        }

        function toggleMonitor(id) {
            const monitors = loadMonitors();
            const target = monitors.find((m) => m.id === id);
            if (!target) return;
            target.active = target.active === false ? true : false;
            if (target.active && (!target.nextRunAt || target.nextRunAt < Date.now())) {
                target.nextRunAt = Date.now() + (Number(target.intervalHours || 24) * 60 * 60 * 1000);
            }
            saveMonitors(monitors);
            renderMonitors();
        }

        function classifyTrailStatus(entry) {
            const status = Number(entry.status);
            if (entry.error || !Number.isFinite(status) || status <= 0) return 'network';
            if (status >= 200 && status < 300) return 'success';
            if (status >= 400 && status < 500) return 'client';
            if (status >= 500) return 'server';
            return 'other';
        }

        function getFilteredTrail(entries) {
            return entries.filter((entry) => {
                const statusClass = classifyTrailStatus(entry);
                if ((pgFilterStatus?.value || 'all') !== 'all' && statusClass !== pgFilterStatus.value) return false;
                if ((pgFilterNotary?.value || 'all') !== 'all' && entry.notary !== pgFilterNotary.value) return false;
                if ((pgFilterMode?.value || 'all') !== 'all' && entry.mode !== pgFilterMode.value) return false;
                if ((pgFilterLatency?.value || 'all') === 'slow' && Number(entry.latency || 0) <= 500) return false;
                return true;
            });
        }

        function renderTrail() {
            const entries = loadTrail();
            const filtered = getFilteredTrail(entries).sort((a, b) => {
                const pinA = a.pinned ? 1 : 0;
                const pinB = b.pinned ? 1 : 0;
                if (pinA !== pinB) return pinB - pinA;
                return new Date(b.ts).getTime() - new Date(a.ts).getTime();
            });
            pgTrailBody.innerHTML = '';
            pgTrailEmpty.style.display = filtered.length ? 'none' : 'block';
            pgTrailMeta.textContent = `Showing ${filtered.length} of ${entries.length} runs.`;
            filtered.forEach((e) => {
                const statusClass = classifyTrailStatus(e);
                const statusText = statusClass === 'network' ? 'failed' : String(e.status || 'n/a');
                const assertClass = e.assertPass === true ? 'assert-pass' : (e.assertPass === false ? 'assert-fail' : 'assert-na');
                const assertText = e.assertPass === true ? 'pass' : (e.assertPass === false ? 'fail' : 'n/a');
                const tr = document.createElement('tr');
                tr.className = `status-row-${statusClass}`;
                const tTime = document.createElement('td');
                tTime.textContent = new Date(e.ts).toLocaleString();
                tr.appendChild(tTime);

                const tNotary = document.createElement('td');
                tNotary.textContent = e.notary || '';
                tr.appendChild(tNotary);

                const tMode = document.createElement('td');
                tMode.textContent = e.mode || '';
                tr.appendChild(tMode);

                const tStatus = document.createElement('td');
                const statusChip = document.createElement('span');
                statusChip.className = `status-chip ${statusClass}`;
                statusChip.textContent = statusText;
                tStatus.appendChild(statusChip);
                tr.appendChild(tStatus);

                const tAssert = document.createElement('td');
                const assertChip = document.createElement('span');
                assertChip.className = `status-chip ${assertClass}`;
                assertChip.textContent = assertText;
                assertChip.title = e.assertSummary || '';
                tAssert.appendChild(assertChip);
                tr.appendChild(tAssert);

                const tLatency = document.createElement('td');
                tLatency.textContent = `${Number(e.latency || 0)}ms`;
                tr.appendChild(tLatency);

                const tHash = document.createElement('td');
                tHash.textContent = `${(e.reqHash || '').slice(0, 10)}…`;
                tr.appendChild(tHash);

                const tActions = document.createElement('td');
                const pinBtn = document.createElement('button');
                pinBtn.className = `trail-action ${e.pinned ? 'active' : ''}`;
                pinBtn.dataset.trailAction = 'pin';
                pinBtn.dataset.id = e.id || '';
                pinBtn.textContent = e.pinned ? 'Pinned' : 'Pin';
                const replayBtn = document.createElement('button');
                replayBtn.className = 'trail-action';
                replayBtn.dataset.trailAction = 'replay';
                replayBtn.dataset.id = e.id || '';
                replayBtn.textContent = 'Replay';
                tActions.appendChild(pinBtn);
                tActions.appendChild(replayBtn);
                tr.appendChild(tActions);
                pgTrailBody.appendChild(tr);
            });
        }

        async function hashString(input) {
            if (!window.crypto?.subtle) return 'nohash';
            const bytes = new TextEncoder().encode(input);
            const buf = await crypto.subtle.digest('SHA-256', bytes);
            return Array.from(new Uint8Array(buf)).map((b) => b.toString(16).padStart(2, '0')).join('');
        }

        function setPlaygroundDiff(currentText) {
            if (!pgPreviousResponseText) {
                pgDiff.textContent = 'No previous run yet.';
                pgPreviousResponseText = currentText;
                return;
            }
            if (pgPreviousResponseText === currentText) {
                pgDiff.textContent = 'No change vs previous response.';
                pgPreviousResponseText = currentText;
                return;
            }
            const prevLines = pgPreviousResponseText.split('\n');
            const currLines = currentText.split('\n');
            const limit = Math.max(prevLines.length, currLines.length);
            const rows = [];
            for (let i = 0; i < limit; i += 1) {
                const a = prevLines[i];
                const b = currLines[i];
                if (a === b) continue;
                if (typeof a !== 'undefined') rows.push(`- ${a}`);
                if (typeof b !== 'undefined') rows.push(`+ ${b}`);
            }
            pgDiff.textContent = rows.length ? rows.join('\n') : 'No change vs previous response.';
            pgPreviousResponseText = currentText;
        }

        function redactObject(value, fields) {
            if (Array.isArray(value)) return value.map((item) => redactObject(item, fields));
            if (!value || typeof value !== 'object') return value;
            const copy = {};
            Object.entries(value).forEach(([key, raw]) => {
                if (fields.has(key)) {
                    copy[key] = '[REDACTED]';
                } else {
                    copy[key] = redactObject(raw, fields);
                }
            });
            return copy;
        }

        function redactResponseText(text, fields) {
            if (!text || !fields.size) return text;
            try {
                const parsed = JSON.parse(text);
                return JSON.stringify(redactObject(parsed, fields), null, 2);
            } catch {}
            let output = text;
            const jsonReplacements = [
                { key: 'vendor', regex: /("vendor"\s*:\s*)(".*?"|-?\d+(?:\.\d+)?|true|false|null)/gi },
                { key: 'region', regex: /("region"\s*:\s*)(".*?"|-?\d+(?:\.\d+)?|true|false|null)/gi },
                { key: 'plan', regex: /("plan"\s*:\s*)(".*?"|-?\d+(?:\.\d+)?|true|false|null)/gi },
                { key: 'days_since_purchase', regex: /("days_since_purchase"\s*:\s*)(".*?"|-?\d+(?:\.\d+)?|true|false|null)/gi },
                { key: 'requestId', regex: /("requestId"\s*:\s*)(".*?"|-?\d+(?:\.\d+)?|true|false|null)/gi }
            ];
            jsonReplacements.forEach(({ key, regex }) => {
                if (!fields.has(key)) return;
                output = output.replace(regex, '$1"[REDACTED]"');
            });
            if (fields.has('vendor')) output = output.replace(/(\bVendor:\s*)([^\n\r]+)/gi, '$1[REDACTED]');
            if (fields.has('region')) output = output.replace(/(\bRegion:\s*)([^\n\r]+)/gi, '$1[REDACTED]');
            if (fields.has('plan')) output = output.replace(/(\bPlan:\s*)([^\n\r]+)/gi, '$1[REDACTED]');
            if (fields.has('days_since_purchase')) output = output.replace(/(\bdays_since_purchase\b[^0-9-]*)(-?\d+)/gi, '$1[REDACTED]');
            if (fields.has('requestId')) output = output.replace(/(\bRequest ID:\s*)([^\s]+)/gi, '$1[REDACTED]');
            return output;
        }

        function getRedactedSnapshot(snapshot) {
            const fields = getSelectedRedactions();
            if (!fields.size) return snapshot;
            const payload = redactObject(snapshot.payload, fields);
            const redacted = { ...snapshot, payload };
            redacted.responseText = redactResponseText(snapshot.responseText, fields);
            if (fields.has('requestId') && redacted.requestId) redacted.requestId = '[REDACTED]';
            return redacted;
        }

        function getByPath(obj, path) {
            if (!path) return undefined;
            const normalized = path.replace(/\[(\d+)\]/g, '.$1');
            return normalized.split('.').filter(Boolean).reduce((acc, part) => (acc == null ? undefined : acc[part]), obj);
        }

        function parseExpectedValue(raw) {
            const value = String(raw || '').trim();
            if (!value) return '';
            if (value === 'true') return true;
            if (value === 'false') return false;
            if (value === 'null') return null;
            if (!Number.isNaN(Number(value)) && value !== '') return Number(value);
            try { return JSON.parse(value); } catch {}
            return value;
        }

        function evaluateAssertions(assertions, context) {
            if (!assertions.length) return { pass: null, summary: 'n/a' };
            const failures = [];
            assertions.forEach((rule) => {
                const lhs = rule.path === 'status'
                    ? context.status
                    : (rule.path === 'latency' ? context.latency : getByPath(context.body, rule.path));
                const rhs = parseExpectedValue(rule.expected);
                let ok = false;
                switch (rule.op) {
                    case 'eq': ok = lhs === rhs; break;
                    case 'neq': ok = lhs !== rhs; break;
                    case 'contains': ok = String(lhs ?? '').toLowerCase().includes(String(rhs ?? '').toLowerCase()); break;
                    case 'gt': ok = Number(lhs) > Number(rhs); break;
                    case 'lt': ok = Number(lhs) < Number(rhs); break;
                    case 'exists': ok = lhs !== undefined && lhs !== null; break;
                    default: ok = false;
                }
                if (!ok) failures.push(rule.path);
            });
            return failures.length
                ? { pass: false, summary: `fail (${failures.join(', ')})` }
                : { pass: true, summary: 'pass' };
        }

        function encodeSnapshot(snapshot) {
            try {
                const json = JSON.stringify(snapshot);
                const utf8 = encodeURIComponent(json).replace(/%([0-9A-F]{2})/g, (_, p1) => String.fromCharCode(parseInt(p1, 16)));
                return btoa(utf8).replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/g, '');
            } catch {
                return '';
            }
        }

        function decodeSnapshot(raw) {
            if (!raw) return null;
            try {
                const base64 = raw.replace(/-/g, '+').replace(/_/g, '/');
                const padded = base64 + '==='.slice((base64.length + 3) % 4);
                const bin = atob(padded);
                const percent = Array.from(bin).map((c) => `%${c.charCodeAt(0).toString(16).padStart(2, '0')}`).join('');
                return JSON.parse(decodeURIComponent(percent));
            } catch {
                return null;
            }
        }

        function setShareButtonState(label, timeoutMs = 1500) {
            pgShareRunBtn.textContent = label;
            setTimeout(() => { pgShareRunBtn.textContent = 'Copy share link'; }, timeoutMs);
        }

        function copyRunShareLink() {
            if (!pgLastRunSnapshot) {
                setShareButtonState('Run first');
                return;
            }
            const encoded = encodeSnapshot(getRedactedSnapshot(pgLastRunSnapshot));
            if (!encoded) {
                setShareButtonState('Share failed');
                return;
            }
            const url = new URL(window.location.href);
            url.searchParams.set('pgsnap', encoded);
            url.hash = '#agents';
            navigator.clipboard.writeText(url.toString()).then(() => {
                setShareButtonState('Link copied!');
            }).catch(() => {
                setShareButtonState('Copy failed');
            });
        }

        function maybeLoadSharedSnapshot() {
            const params = new URLSearchParams(window.location.search);
            const raw = params.get('pgsnap');
            if (!raw) return;
            const snapshot = decodeSnapshot(raw);
            if (!snapshot || !snapshot.payload || !snapshot.responseText) return;

            if (snapshot.notary && PLAYGROUND_CONFIG[snapshot.notary]) pgNotary.value = snapshot.notary;
            if (snapshot.mode && PLAYGROUND_CONFIG[pgNotary.value]?.[snapshot.mode]) pgMode.value = snapshot.mode;
            renderPresetOptions();
            setPlaygroundPayload(snapshot.payload);
            pgResponse.textContent = snapshot.responseText;
            const parsedSnapshot = (() => { try { return JSON.parse(snapshot.responseText); } catch { return null; } })();
            renderProvenance(snapshot.provenance || extractProvenance(parsedSnapshot));
            pgDiff.textContent = 'Loaded from shared snapshot.';
            pgPreviousResponseText = snapshot.responseText;
            pgLastRunSnapshot = snapshot;
            pgScopeNote.textContent = 'Loaded shared snapshot link. Edit payload and run to test live.';

            params.delete('pgsnap');
            const cleanUrl = `${window.location.pathname}${params.toString() ? `?${params.toString()}` : ''}${window.location.hash || ''}`;
            history.replaceState(null, '', cleanUrl);
        }

        function setPlaygroundPayload(payload) {
            pgPayload.value = JSON.stringify(payload, null, 2);
        }

        function extractProvenanceFromMcpText(text) {
            const sourceMatch = /Source:\s*(.+)/i.exec(text || '');
            const notesMatch = /Source Notes:\s*(.+)/i.exec(text || '');
            const checkedMatch = /Last Checked:\s*(.+)/i.exec(text || '');
            return {
                sourceUrl: sourceMatch?.[1]?.trim() || '',
                sourceNotes: notesMatch?.[1]?.trim() || '',
                lastChecked: checkedMatch?.[1]?.trim() || ''
            };
        }

        function extractProvenance(parsed) {
            if (!parsed || typeof parsed !== 'object') return null;
            const root = parsed.result || parsed;
            if (root && typeof root === 'object' && ('policy_source_url' in root || 'policy_source_notes' in root || 'policy_last_checked' in root)) {
                return {
                    sourceUrl: String(root.policy_source_url || '').trim(),
                    sourceNotes: String(root.policy_source_notes || '').trim(),
                    lastChecked: String(root.policy_last_checked || '').trim()
                };
            }
            const mcpText = parsed?.result?.content?.[0]?.text;
            if (typeof mcpText === 'string' && mcpText) return extractProvenanceFromMcpText(mcpText);
            return null;
        }

        function renderProvenance(provenance) {
            if (!pgProvenance) return;
            const sourceUrl = String(provenance?.sourceUrl || '').trim();
            const sourceNotes = String(provenance?.sourceNotes || '').trim();
            const lastChecked = String(provenance?.lastChecked || '').trim();
            const hasData = [sourceUrl, sourceNotes, lastChecked].some((value) => value && value.toUpperCase() !== 'N/A');
            if (!hasData) {
                pgProvenance.hidden = true;
                pgProvenance.innerHTML = '';
                return;
            }
            pgProvenance.hidden = false;
            const sourceInner = sourceUrl && sourceUrl.toUpperCase() !== 'N/A'
                ? `<a href="${sourceUrl}" target="_blank" rel="noopener noreferrer">open source</a>`
                : 'N/A';
            const notesInner = sourceNotes && sourceNotes.toUpperCase() !== 'N/A' ? sourceNotes : 'N/A';
            const checkedInner = lastChecked && lastChecked.toUpperCase() !== 'N/A' ? lastChecked : 'N/A';
            pgProvenance.innerHTML = `
                <span class="pg-prov-pill"><strong>Provenance</strong></span>
                <span class="pg-prov-pill"><strong>Source</strong> ${sourceInner}</span>
                <span class="pg-prov-pill"><strong>Notes</strong> ${notesInner}</span>
                <span class="pg-prov-pill"><strong>Checked</strong> ${checkedInner}</span>
            `;
        }

        function getPresetList() {
            const presets = PLAYGROUND_PRESETS[pgNotary.value]?.[pgMode.value] || [];
            if (!pgAdvancedTools?.open) {
                return presets.filter((preset) => preset.tier !== 'diag');
            }
            return presets;
        }

        function renderPresetOptions() {
            const previous = pgPreset.value;
            const presets = getPresetList();
            pgPreset.innerHTML = '';
            if (!presets.length) {
                const opt = document.createElement('option');
                opt.value = 'none';
                opt.textContent = 'Default template';
                pgPreset.appendChild(opt);
                return;
            }
            presets.forEach((preset, i) => {
                const opt = document.createElement('option');
                opt.value = String(i);
                const tag = preset.tier === 'diag' ? ' [Diagnostic]' : ' [Core]';
                opt.textContent = pgAdvancedTools?.open ? `${preset.label}${tag}` : preset.label;
                pgPreset.appendChild(opt);
            });
            const hasPrevious = previous !== '' && previous !== 'none' && presets[Number(previous)];
            pgPreset.value = hasPrevious ? previous : '0';
        }

        function setPlaygroundTemplate() {
            const preset = getPresetList()[Number(pgPreset.value || 0)];
            if (preset?.payload) {
                setPlaygroundPayload(preset.payload);
                return;
            }
            const cfg = PLAYGROUND_CONFIG[pgNotary.value][pgMode.value];
            setPlaygroundPayload(cfg.template);
        }

        async function executePlaygroundRequest(notary, mode, payload) {
            const cfg = PLAYGROUND_CONFIG[notary][mode];
            const started = performance.now();
            try {
                const res = await fetch(cfg.endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const text = await res.text();
                let parsed;
                try { parsed = JSON.parse(text); } catch { parsed = { raw: text }; }
                return {
                    ok: true,
                    status: res.status,
                    latency: Math.round(performance.now() - started),
                    requestId: res.headers.get('x-vercel-id') || '',
                    parsed,
                    responseText: JSON.stringify(parsed, null, 2),
                    rawText: text
                };
            } catch (error) {
                const responseText = `Request failed: ${error.message}`;
                return {
                    ok: false,
                    status: 0,
                    latency: Math.round(performance.now() - started),
                    requestId: '',
                    parsed: { error: error.message || 'request failed' },
                    responseText,
                    rawText: responseText,
                    error: error.message || 'request failed'
                };
            }
        }

        async function persistTrailEntry(baseEntry) {
            const reqHash = await hashString(JSON.stringify(baseEntry.payload || {}));
            const resHash = await hashString(String(baseEntry.rawText || baseEntry.responseText || ''));
            const entry = {
                ...baseEntry,
                id: baseEntry.id || `${Date.now()}-${Math.random().toString(16).slice(2, 8)}`,
                reqHash,
                resHash
            };
            const entries = [entry, ...loadTrail()];
            saveTrail(entries);
            renderTrail();
            return entry;
        }

        async function runPlayground(options = {}) {
            const notary = options.notary || pgNotary.value;
            const mode = options.mode || pgMode.value;
            let payload = options.payload;
            if (!payload) {
                try {
                    payload = JSON.parse(pgPayload.value);
                } catch {
                    pgResponse.textContent = 'Invalid JSON payload.';
                    renderProvenance(null);
                    return null;
                }
            }

            if (!options.silentUi) pgRunBtn.disabled = true;
            try {
                const result = await executePlaygroundRequest(notary, mode, payload);
                pgResponse.textContent = result.responseText;
                setPlaygroundDiff(result.responseText);
                const provenance = extractProvenance(result.parsed);
                renderProvenance(provenance);
                trackEvent('playground_run', {
                    notary,
                    mode,
                    status: result.status,
                    latency_ms: result.latency
                });
                const assertions = getScopedAssertions(notary, mode);
                const assertResult = evaluateAssertions(assertions, {
                    status: result.status,
                    latency: result.latency,
                    body: result.parsed
                });
                pgLastRunSnapshot = {
                    ts: new Date().toISOString(),
                    notary,
                    mode,
                    payload,
                    responseText: result.responseText,
                    status: result.status,
                    latency: result.latency,
                    requestId: result.requestId,
                    provenance
                };

                const saved = await persistTrailEntry({
                    ts: new Date().toISOString(),
                    notary,
                    mode,
                    payload,
                    status: result.status,
                    latency: result.latency,
                    requestId: result.requestId,
                    responseText: result.responseText,
                    rawText: result.rawText,
                    error: result.error || '',
                    assertPass: assertResult.pass,
                    assertSummary: assertResult.summary,
                    caseName: options.caseName || '',
                    pinned: false
                });
                return saved;
            } finally {
                if (!options.silentUi) pgRunBtn.disabled = false;
            }
        }

        function saveCurrentCase() {
            let payload;
            try {
                payload = JSON.parse(pgPayload.value);
            } catch {
                pgResponse.textContent = 'Invalid JSON payload.';
                return;
            }
            const defaultName = `${pgNotary.value}-${pgMode.value}-${new Date().toISOString().slice(11, 19)}`;
            const name = (window.prompt('Name this test case:', defaultName) || '').trim();
            if (!name) return;
            const cases = loadSavedCases();
            const existing = cases.find((c) => c.notary === pgNotary.value && c.mode === pgMode.value && c.name.toLowerCase() === name.toLowerCase());
            if (existing) {
                existing.payload = payload;
                existing.updatedAt = new Date().toISOString();
            } else {
                cases.unshift({
                    id: `${Date.now()}-${Math.random().toString(16).slice(2, 8)}`,
                    name,
                    notary: pgNotary.value,
                    mode: pgMode.value,
                    payload,
                    updatedAt: new Date().toISOString()
                });
            }
            saveSavedCases(cases);
            renderSavedCases();
        }

        function loadSelectedCase() {
            const id = pgSavedCases.value;
            if (!id) return;
            const selected = loadSavedCases().find((c) => c.id === id);
            if (!selected) return;
            if (selected.notary !== pgNotary.value || selected.mode !== pgMode.value) {
                pgNotary.value = selected.notary;
                pgMode.value = selected.mode;
                renderPresetOptions();
            }
            setPlaygroundPayload(selected.payload);
        }

        function deleteSelectedCase() {
            const id = pgSavedCases.value;
            if (!id) return;
            const cases = loadSavedCases();
            const next = cases.filter((c) => c.id !== id);
            saveSavedCases(next);
            renderSavedCases();
        }

        function addAssertion() {
            const path = (pgAssertPath.value || '').trim();
            const op = pgAssertOp.value;
            const expected = (pgAssertExpected.value || '').trim();
            if (!path) return;
            if (op !== 'exists' && !expected) return;
            const assertions = loadAssertions();
            assertions.unshift({
                id: `${Date.now()}-${Math.random().toString(16).slice(2, 8)}`,
                notary: pgNotary.value,
                mode: pgMode.value,
                path,
                op,
                expected
            });
            saveAssertions(assertions);
            pgAssertPath.value = '';
            pgAssertExpected.value = '';
            renderAssertions();
        }

        function toggleTrailPin(id) {
            if (!id) return;
            const entries = loadTrail();
            const target = entries.find((e) => e.id === id);
            if (!target) return;
            target.pinned = !target.pinned;
            saveTrail(entries);
            renderTrail();
        }

        async function replayTrailEntry(id) {
            if (!id) return;
            const target = loadTrail().find((e) => e.id === id);
            if (!target || !target.payload || !target.notary || !target.mode) return;
            pgNotary.value = target.notary;
            pgMode.value = target.mode;
            renderPresetOptions();
            renderSavedCases();
            renderAssertions();
            renderAssertionTemplates();
            setPlaygroundPayload(target.payload);
            await runPlayground({ notary: target.notary, mode: target.mode, payload: target.payload, caseName: target.caseName || '' });
        }

        async function runSavedSuite() {
            const suite = loadSavedCases().filter((c) => c.notary === pgNotary.value && c.mode === pgMode.value);
            if (!suite.length) {
                pgScopeNote.textContent = 'No saved cases to run in this notary/mode.';
                return;
            }
            pgRunSuiteBtn.disabled = true;
            pgRunBtn.disabled = true;
            try {
                let pass = 0;
                let fail = 0;
                for (const testCase of suite) {
                    const entry = await runPlayground({
                        notary: testCase.notary,
                        mode: testCase.mode,
                        payload: testCase.payload,
                        caseName: testCase.name,
                        silentUi: true
                    });
                    if (entry?.assertPass === false) fail += 1;
                    else pass += 1;
                }
                pgScopeNote.textContent = `Suite complete: ${suite.length} case(s), ${pass} pass, ${fail} fail.`;
            } finally {
                pgRunSuiteBtn.disabled = false;
                pgRunBtn.disabled = false;
            }
        }

        function getCorePresetPayload(notary, mode) {
            const list = PLAYGROUND_PRESETS[notary]?.[mode] || [];
            const core = list.find((preset) => preset.tier !== 'diag') || list[0];
            if (core?.payload) return core.payload;
            return PLAYGROUND_CONFIG[notary]?.[mode]?.template || null;
        }

        function parseJsonSafe(text) {
            try { return JSON.parse(text); } catch { return null; }
        }

        function isTrustPass(mode, entry) {
            const statusOk = Number(entry?.status || 0) >= 200 && Number(entry?.status || 0) < 300;
            if (!statusOk || !entry?.responseText) return false;
            const parsed = parseJsonSafe(entry.responseText);
            if (!parsed) return false;

            if (mode === 'rest') {
                const source = parsed.policy_source_url;
                const checked = parsed.policy_last_checked;
                return Boolean(source && source !== 'N/A' && checked && checked !== 'N/A');
            }

            const mcpText = parsed?.result?.content?.[0]?.text || '';
            return /Source:\s*(?!N\/A).+/i.test(mcpText) && /Last Checked:\s*(?!N\/A).+/i.test(mcpText);
        }

        async function runTrustSuite() {
            const originalNotary = pgNotary.value;
            const originalMode = pgMode.value;
            const originalPayload = pgPayload.value;
            const notaries = ['refund', 'cancel', 'return', 'trial'];
            const modes = ['mcp', 'rest'];
            let passed = 0;
            let failed = 0;
            const failedCases = [];

            pgRunTrustSuiteBtn.disabled = true;
            pgRunBtn.disabled = true;
            pgRunSuiteBtn.disabled = true;
            setTrustSuiteBadge('running');
            try {
                for (const mode of modes) {
                    for (const notary of notaries) {
                        const payload = getCorePresetPayload(notary, mode);
                        if (!payload) {
                            failed += 1;
                            failedCases.push(`${notary}/${mode} (missing payload)`);
                            continue;
                        }
                        const entry = await runPlayground({
                            notary,
                            mode,
                            payload,
                            caseName: 'trust-suite',
                            silentUi: true
                        });
                        const ok = isTrustPass(mode, entry);
                        if (ok) passed += 1;
                        else {
                            failed += 1;
                            failedCases.push(`${notary}/${mode}`);
                        }
                    }
                }

                const total = passed + failed;
                pgScopeNote.textContent = failed
                    ? `Trust suite: ${passed}/${total} passed. Failed: ${failedCases.join(', ')}.`
                    : `Trust suite: ${passed}/${total} passed across all notaries (MCP + REST).`;
                const badgeText = `Trust Suite: ${failed ? 'FAIL' : 'PASS'} (${passed}/${total})`;
                setTrustSuiteBadge(failed ? 'fail' : 'pass', badgeText);
                localStorage.setItem(
                    getPlaygroundTrustSuiteKey(),
                    JSON.stringify({ state: failed ? 'fail' : 'pass', text: badgeText, ts: new Date().toISOString() })
                );
                trackEvent('trust_suite_run', { passed, failed, total });
            } finally {
                pgNotary.value = originalNotary;
                pgMode.value = originalMode;
                renderPresetOptions();
                renderSavedCases();
                renderAssertions();
                renderAssertionTemplates();
                pgPayload.value = originalPayload;
                pgRunTrustSuiteBtn.disabled = false;
                pgRunBtn.disabled = false;
                pgRunSuiteBtn.disabled = false;
            }
        }

        async function runDemoScenario(type) {
            if (type === 'refund') {
                const payload = getCorePresetPayload('refund', 'mcp');
                pgNotary.value = 'refund';
                pgMode.value = 'mcp';
                renderPresetOptions();
                renderSavedCases();
                renderAssertions();
                renderAssertionTemplates();
                setPlaygroundPayload(payload);
                trackEvent('demo_flow_run', { scenario: 'refund_allowed' });
                await runPlayground({ notary: 'refund', mode: 'mcp', payload });
                return;
            }
            if (type === 'cancel') {
                const payload = getCorePresetPayload('cancel', 'rest');
                pgNotary.value = 'cancel';
                pgMode.value = 'rest';
                renderPresetOptions();
                renderSavedCases();
                renderAssertions();
                renderAssertionTemplates();
                setPlaygroundPayload(payload);
                trackEvent('demo_flow_run', { scenario: 'cancel_penalty' });
                await runPlayground({ notary: 'cancel', mode: 'rest', payload });
                return;
            }
            if (type === 'trust') {
                trackEvent('demo_flow_run', { scenario: 'trust_suite' });
                await runTrustSuite();
            }
        }

        function maybeEnterDemoMode() {
            const params = new URLSearchParams(window.location.search);
            const isDemo = params.get('demo') === '1' || window.location.hash === '#demo';
            if (!isDemo) return;
            setMode('agents');
            setTimeout(() => {
                document.getElementById('mcp-playground')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
                pgScopeNote.textContent = 'Demo mode: use quick demo pills to run live scenarios.';
            }, 150);
            trackEvent('demo_mode_entered', { via: params.get('demo') === '1' ? 'query' : 'hash' });
        }

        function exportTrailCsv() {
            const entries = loadTrail();
            if (!entries.length) return;
            const rows = [['timestamp', 'notary', 'mode', 'status', 'assert_pass', 'assert_summary', 'latency_ms', 'request_id', 'request_hash', 'response_hash', 'pinned', 'case_name']];
            entries.forEach((e) => rows.push([e.ts, e.notary, e.mode, String(e.status), String(e.assertPass), e.assertSummary || '', String(e.latency), e.requestId || '', e.reqHash, e.resHash, String(Boolean(e.pinned)), e.caseName || '']));
            const csv = rows.map((r) => r.map((v) => `"${String(v).replaceAll('"', '""')}"`).join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `decide-playground-audit-${new Date().toISOString().slice(0, 19).replace(/[:T]/g, '-')}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function formatSyncDate(isoDate) {
            if (!isoDate) return null;
            const parsed = new Date(`${isoDate}T00:00:00Z`);
            if (Number.isNaN(parsed.getTime())) return null;
            return new Intl.DateTimeFormat('en-US', { month: 'short', day: 'numeric', year: 'numeric', timeZone: 'UTC' }).format(parsed);
        }

        async function loadNotarySyncDates() {
            const map = [
                { id: 'refundSync', path: '/rules/policy-sources.json' },
                { id: 'cancelSync', path: '/rules/cancel-policy-sources.json' },
                { id: 'returnSync', path: '/rules/return-policy-sources.json' },
                { id: 'trialSync', path: '/rules/trial-policy-sources.json' }
            ];
            for (const item of map) {
                const el = document.getElementById(item.id);
                if (!el) continue;
                try {
                    const response = await fetch(item.path, { cache: 'no-store' });
                    if (!response.ok) throw new Error(`status ${response.status}`);
                    const data = await response.json();
                    const formatted = formatSyncDate(data?.last_checked);
                    el.textContent = formatted ? `Last policy sync: ${formatted}` : 'Last policy sync: updated daily';
                } catch {
                    el.textContent = 'Last policy sync: updated daily';
                }
            }
        }

        pgNotary.addEventListener('change', () => { renderPresetOptions(); setPlaygroundTemplate(); renderSavedCases(); renderAssertions(); renderAssertionTemplates(); });
        pgMode.addEventListener('change', () => { renderPresetOptions(); setPlaygroundTemplate(); renderSavedCases(); renderAssertions(); renderAssertionTemplates(); });
        pgPreset.addEventListener('change', setPlaygroundTemplate);
        pgLoadPresetBtn.addEventListener('click', setPlaygroundTemplate);
        pgRunBtn.addEventListener('click', () => runPlayground());
        pgDemoRefundBtn?.addEventListener('click', () => runDemoScenario('refund'));
        pgDemoCancelBtn?.addEventListener('click', () => runDemoScenario('cancel'));
        pgDemoTrustBtn?.addEventListener('click', () => runDemoScenario('trust'));
        pgCopyRespBtn.addEventListener('click', async () => {
            await navigator.clipboard.writeText(pgResponse.textContent || '');
            pgCopyRespBtn.textContent = 'Copied!';
            setTimeout(() => { pgCopyRespBtn.textContent = 'Copy response'; }, 1500);
        });
        pgShareRunBtn.addEventListener('click', copyRunShareLink);
        pgExportBtn.addEventListener('click', exportTrailCsv);
        pgRunTrustSuiteBtn.addEventListener('click', runTrustSuite);
        pgSaveCaseBtn.addEventListener('click', saveCurrentCase);
        pgLoadCaseBtn.addEventListener('click', loadSelectedCase);
        pgDeleteCaseBtn.addEventListener('click', deleteSelectedCase);
        pgRunSuiteBtn.addEventListener('click', runSavedSuite);
        pgSaveMonitorBtn.addEventListener('click', saveMonitorFromSelectedCase);
        pgRunMonitorsBtn.addEventListener('click', runDueMonitors);
        pgVendorRefreshBtn?.addEventListener('click', renderNetworkVendorRequests);
        pgAddAssertBtn.addEventListener('click', addAssertion);
        pgUseAssertTemplateBtn.addEventListener('click', applyAssertionTemplate);
        pgAssertTemplate.addEventListener('change', applyAssertionTemplate);
        pgAssertExpected.addEventListener('keydown', (e) => { if (e.key === 'Enter') addAssertion(); });
        pgAdvancedTools?.addEventListener('toggle', () => {
            renderPresetOptions();
            setPlaygroundTemplate();
        });
        pgTrailBody.addEventListener('click', (event) => {
            const button = event.target.closest('[data-trail-action]');
            if (!button) return;
            const action = button.dataset.trailAction;
            const id = button.dataset.id;
            if (action === 'pin') toggleTrailPin(id);
            if (action === 'replay') replayTrailEntry(id);
        });
        pgRedactChecks.forEach((el) => {
            el.addEventListener('change', saveShareRedactionPrefs);
        });
        pgMonitorList.addEventListener('click', async (event) => {
            const button = event.target.closest('[data-monitor-action]');
            if (!button) return;
            const action = button.dataset.monitorAction;
            const id = button.dataset.monitorId;
            if (!id) return;
            if (action === 'run') await runMonitorById(id);
            if (action === 'toggle') toggleMonitor(id);
            if (action === 'delete') deleteMonitor(id);
        });
        [pgFilterStatus, pgFilterNotary, pgFilterMode, pgFilterLatency].forEach((el) => {
            el?.addEventListener('change', renderTrail);
        });
        pgClearTrailBtn.addEventListener('click', () => {
            localStorage.removeItem(getPlaygroundAuditKey());
            renderTrail();
        });
        document.addEventListener('click', (event) => {
            const link = event.target.closest('a');
            if (!link) return;
            const href = link.getAttribute('href') || '';
            const label = (link.textContent || '').trim().toLowerCase();
            if (href === '#mcp-connect') trackEvent('nav_connect_click', { label });
            if (href === '#pricing') trackEvent('nav_pricing_click', { label });
            if (href.includes('/playground') || href.includes('/livedemo')) trackEvent('nav_playground_click', { label });
            if (link.classList.contains('install-badge')) trackEvent('install_badge_click', { href: link.getAttribute('href') || '' });
            const trackKey = link.getAttribute('data-track');
            if (trackKey) trackEvent(trackKey, { href: link.getAttribute('href') || '' });
        });
        renderPresetOptions();
        setPlaygroundTemplate();
        renderSavedCases();
        loadShareRedactionPrefs();
        renderAssertions();
        renderAssertionTemplates();
        renderMonitors();
        renderNetworkVendorRequests();
        maybeLoadSharedSnapshot();
        updatePlaygroundScopeNote();
        renderTrail();
        loadNotarySyncDates();
        runDueMonitors();
        setInterval(() => { runDueMonitors(); }, 60 * 1000);
        maybeEnterDemoMode();

        // Copy code blocks
        function copyCode(btn) {
            const pre = btn.closest('.code-block').querySelector('pre');
            const text = pre.textContent;
            navigator.clipboard.writeText(text).then(() => {
                btn.textContent = 'Copied!';
                setTimeout(() => { btn.textContent = 'Copy'; }, 2000);
            });
        }

        // Init mode from explicit route/query/hash, with deterministic root default.
        (function() {
            const initialMode = getModeFromLocation();
            setMode(initialMode, { updateHistory: true, scroll: false });
        })();

        // Keep nav variants correct when viewport crosses mobile/desktop breakpoints.
        window.addEventListener('resize', () => {
            syncNavVisibility(document.body.classList.contains('agents'));
        });

        // Theme toggle (light/dark)
        function setTheme(dark) {
            document.body.classList.toggle('dark', dark);
            document.querySelector('meta[name="theme-color"]').content = dark ? '#111111' : '#f5f5f5';
            localStorage.setItem('decide-theme', dark ? 'dark' : 'light');
            // Update canvas particle colors
            updateParticleTheme(dark);
        }

        function updateParticleTheme(dark) {
            window._particleDark = dark;
        }

        document.getElementById('themeToggle').addEventListener('click', () => {
            setTheme(!document.body.classList.contains('dark'));
        });

        // Init theme from localStorage or system preference
        (function() {
            const saved = localStorage.getItem('decide-theme');
            if (saved === 'dark') {
                setTheme(true);
            } else if (saved === 'light') {
                setTheme(false);
            } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                setTheme(true);
            }
            // Listen for system preference changes (only if no manual override)
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                if (!localStorage.getItem('decide-theme')) {
                    setTheme(e.matches);
                }
            });
        })();

        // Sign In function
        async function openSignIn() {
            if (!window.Clerk) return;
            
            try {
                trackEvent('signin_click', { mode: document.body.classList.contains('agents') ? 'agents' : 'humans' });
                await window.Clerk.openSignIn();
            } catch (error) {
                console.error('Error opening sign in:', error);
            }
        }
    </script>
</body>
</html>
